<!DOCTYPE html>
<html lang="zh-HK">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>ç”Ÿæ­»ä¹‹é–“ | Between Life and Death</title>
<link href="https://fonts.googleapis.com/css2?family=Noto+Serif+TC:wght@400;700;900&family=Noto+Sans+TC:wght@300;400;700&family=Orbitron:wght@500;700;900&family=Share+Tech+Mono&display=swap" rel="stylesheet">
<style>
:root {
    --c-void: #000000;
    --c-blood: #cc3333;
    --c-soul: #c084fc;
    --c-cyber: #00f3ff;
    --c-warning: #ff4444;
    --c-hope: #ffd700;
    --c-text: #e8e8e8;
    --c-text-dim: #b0b0b0;
    --c-text-bright: #ffffff;
    --f-serif: 'Noto Serif TC', serif;
    --f-sans: 'Noto Sans TC', sans-serif;
    --f-tech: 'Share Tech Mono', monospace;
    --f-head: 'Orbitron', sans-serif;
}

* { box-sizing: border-box; margin: 0; padding: 0; }

html, body {
    height: 100%;
    overflow-x: hidden;
    background: var(--c-void);
    color: var(--c-text);
    font-family: var(--f-sans);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   éˆé­‚ç²’å­èƒŒæ™¯ï¼ˆå…¨å±€ï¼‰
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#soul-particles {
    position: fixed;
    inset: 0;
    z-index: 0;
    pointer-events: none;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   æ¥µç°¡é¦–é åŸå‹ (Minimalist Entry Overlay)
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#minimalist-entry {
    position: fixed;
    inset: 0;
    background: var(--c-void);
    z-index: 100000;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    opacity: 1;
    transition: opacity 1.5s ease-out;
}

#minimalist-entry.fade-out {
    opacity: 0;
    pointer-events: none;
}

#minimalist-entry.exit-mode {
    animation: exitCountdown 3s ease-out forwards;
}

@keyframes exitCountdown {
    0% { opacity: 1; }
    80% { opacity: 1; }
    100% { opacity: 0; }
}

/* Shocking Death Counter - Primary Focus */
.mini-death-counter {
    text-align: center;
    margin-bottom: 60px;
    animation: pulseIn 2s ease-out;
}

@keyframes pulseIn {
    0% { transform: scale(0.8); opacity: 0; }
    50% { transform: scale(1.05); opacity: 1; }
    100% { transform: scale(1); opacity: 1; }
}

.mini-counter-label {
    font-family: var(--f-sans);
    font-size: clamp(0.9rem, 3vw, 1.1rem);
    color: var(--c-text-dim);
    letter-spacing: 4px;
    margin-bottom: 20px;
    text-transform: uppercase;
}

.mini-counter-number {
    font-family: var(--f-head);
    font-size: clamp(4rem, 15vw, 8rem);
    font-weight: 900;
    color: var(--c-warning);
    text-shadow: 
        0 0 40px rgba(255, 68, 68, 0.8),
        0 0 80px rgba(255, 68, 68, 0.4),
        0 0 120px rgba(255, 68, 68, 0.2);
    letter-spacing: 8px;
    line-height: 1;
    margin-bottom: 15px;
}

.mini-counter-desc {
    font-family: var(--f-tech);
    font-size: clamp(0.75rem, 2vw, 0.9rem);
    color: var(--c-text-dim);
    letter-spacing: 2px;
}

/* Binary Question */
.mini-question {
    text-align: center;
    margin-bottom: 50px;
    animation: fadeInUp 2.5s ease-out 0.5s both;
}

@keyframes fadeInUp {
    from { 
        opacity: 0; 
        transform: translateY(30px); 
    }
    to { 
        opacity: 1; 
        transform: translateY(0); 
    }
}

.mini-question-text {
    font-family: var(--f-serif);
    font-size: clamp(1.5rem, 5vw, 2.5rem);
    font-weight: 700;
    color: var(--c-text-bright);
    letter-spacing: 6px;
    margin-bottom: 15px;
    text-shadow: 0 0 30px rgba(255,255,255,0.3);
}

.mini-question-sub {
    font-family: var(--f-sans);
    font-size: clamp(0.85rem, 2.5vw, 1.1rem);
    color: var(--c-text-dim);
    letter-spacing: 3px;
}

/* Binary Choice Buttons */
.mini-choices {
    display: flex;
    gap: 30px;
    flex-wrap: wrap;
    justify-content: center;
    animation: fadeInUp 3s ease-out 1s both;
}

.mini-choice-btn {
    font-family: var(--f-sans);
    font-size: clamp(1.1rem, 3vw, 1.3rem);
    font-weight: 700;
    padding: 20px 50px;
    border: 2px solid;
    background: transparent;
    cursor: pointer;
    letter-spacing: 6px;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.mini-choice-btn::before {
    content: '';
    position: absolute;
    inset: 0;
    background: currentColor;
    opacity: 0;
    transition: opacity 0.3s ease;
}

.mini-choice-btn span {
    position: relative;
    z-index: 1;
}

.mini-choice-btn.negative {
    color: var(--c-cyber);
    border-color: var(--c-cyber);
}

.mini-choice-btn.negative:hover {
    box-shadow: 0 0 30px rgba(0, 243, 255, 0.5);
    transform: translateY(-2px);
}

.mini-choice-btn.negative:hover::before {
    opacity: 0.1;
}

.mini-choice-btn.positive {
    color: var(--c-hope);
    border-color: var(--c-hope);
}

.mini-choice-btn.positive:hover {
    box-shadow: 0 0 30px rgba(255, 215, 0, 0.5);
    transform: translateY(-2px);
}

.mini-choice-btn.positive:hover::before {
    opacity: 0.1;
}

/* Exit Countdown Message */
.exit-message {
    position: fixed;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
    opacity: 0;
    pointer-events: none;
    z-index: 100001;
}

.exit-message.active {
    opacity: 1;
    animation: fadeInScale 3s ease-out;
}

@keyframes fadeInScale {
    0% { transform: translate(-50%, -50%) scale(0.8); opacity: 0; }
    20% { transform: translate(-50%, -50%) scale(1.1); opacity: 1; }
    80% { transform: translate(-50%, -50%) scale(1); opacity: 1; }
    100% { transform: translate(-50%, -50%) scale(1.2); opacity: 0; }
}

.exit-message-text {
    font-family: var(--f-serif);
    font-size: clamp(2rem, 6vw, 3.5rem);
    font-weight: 900;
    color: var(--c-hope);
    letter-spacing: 8px;
    margin-bottom: 20px;
    text-shadow: 0 0 50px rgba(255, 215, 0, 0.8);
}

.exit-countdown {
    font-family: var(--f-head);
    font-size: clamp(3rem, 10vw, 5rem);
    color: var(--c-text-bright);
    text-shadow: 0 0 40px rgba(255,255,255,0.6);
}

/* Mobile Optimizations */
@media (max-width: 600px) {
    .mini-choices {
        flex-direction: column;
        gap: 20px;
        width: 100%;
        padding: 0 20px;
    }
    
    .mini-choice-btn {
        width: 100%;
        max-width: 300px;
        padding: 18px 30px;
    }
    
    .mini-counter-number {
        letter-spacing: 4px;
    }
    
    .mini-question-text {
        letter-spacing: 3px;
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   é–‹å ´ï¼šæ·±åˆ»çš„éˆé­‚æ‹·å•ï¼ˆå›ºå®šæ¨™é¡Œ + éš¨æ©Ÿå“²ç† + éš¨æ©Ÿç‰¹æ•ˆï¼‰
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#opening-overlay {
    position: fixed;
    inset: 0;
    background: var(--c-void);
    z-index: 99999;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    opacity: 1;
    transition: opacity 2s ease-out;
    overflow: hidden;
}

#opening-overlay.fade-out {
    opacity: 0;
    pointer-events: none;
}

/* é–‹å ´ç‰¹æ•ˆ Canvas */
#opening-effect {
    position: absolute;
    inset: 0;
    z-index: 1;
}

.opening-content {
    max-width: 90%;
    text-align: center;
    opacity: 0;
    animation: fadeInSlow 4s ease-out forwards;
    z-index: 10;
    position: relative;
}

@keyframes fadeInSlow {
    0% { opacity: 0; transform: translateY(20px); }
    30% { opacity: 1; transform: translateY(0); }
    100% { opacity: 1; }
}

/* å›ºå®šæ¨™é¡Œï¼šä»Šç”Ÿèˆ‡æ°¸æ†ï¼Œç”¦é†’èˆ‡æ˜æ²‰ */
.opening-fixed-title {
    font-family: var(--f-serif);
    font-size: clamp(1.8rem, 6vw, 3.5rem);
    font-weight: 900;
    color: var(--c-text-bright);
    text-shadow: 0 0 80px rgba(255,255,255,0.5), 0 0 40px rgba(255,255,255,0.3);
    margin-bottom: 15px;
    letter-spacing: 8px;
}

.opening-fixed-sub {
    font-family: var(--f-serif);
    font-size: clamp(1.2rem, 3vw, 1.8rem);
    color: var(--c-text);
    margin-bottom: 50px;
    letter-spacing: 3px;
}

.opening-divider {
    width: 120px;
    height: 2px;
    background: linear-gradient(90deg, transparent, var(--c-blood), transparent);
    margin: 0 auto 40px;
}

.opening-main {
    font-family: var(--f-serif);
    font-size: clamp(1.2rem, 3.5vw, 2rem);
    font-weight: 700;
    line-height: 2;
    color: var(--c-text-bright);
    text-shadow: 0 0 40px rgba(255,255,255,0.2);
    margin-bottom: 25px;
}

.opening-sub {
    font-family: var(--f-sans);
    font-size: clamp(0.95rem, 2vw, 1.2rem);
    color: var(--c-text-dim);
    line-height: 2;
    margin-bottom: 35px;
}

.opening-verse {
    font-family: var(--f-serif);
    font-size: clamp(0.85rem, 1.8vw, 1rem);
    color: var(--c-text-dim);
    font-style: italic;
    border-left: 2px solid var(--c-blood);
    padding-left: 20px;
    text-align: left;
    display: inline-block;
    max-width: 600px;
}

.opening-ref {
    color: var(--c-blood);
    font-size: 0.9em;
    margin-top: 8px;
    display: block;
}

.enter-hint {
    position: absolute;
    bottom: 8%;
    font-family: var(--f-tech);
    font-size: 14px;
    color: var(--c-text-dim);
    letter-spacing: 3px;
    animation: pulse 3s ease-in-out infinite;
    z-index: 10;
}

@keyframes pulse {
    0%, 100% { opacity: 0.5; }
    50% { opacity: 1; }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   æ­»äº¡åŒæ­¥è¨ˆæ•¸å™¨ï¼ˆå…¨çƒæ­»äº¡å¯¦æ™‚ä¼°ç®—ï¼‰
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#death-counter {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    height: 55px;
    background: linear-gradient(180deg, rgba(30,5,5,0.95), rgba(10,0,0,0.9));
    border-bottom: 1px solid rgba(200,50,50,0.4);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 40px;
    z-index: 1000;
    font-family: var(--f-tech);
    font-size: 14px;
}

.counter-item {
    display: flex;
    align-items: center;
    gap: 10px;
}

.counter-label {
    color: var(--c-text-dim);
}

.counter-value {
    color: var(--c-warning);
    font-size: 18px;
    font-weight: bold;
    min-width: 70px;
    text-shadow: 0 0 10px rgba(255,68,68,0.5);
}

.counter-since {
    color: var(--c-text-dim);
    font-size: 12px;
}

/* Mobile collapsible counter */
.counter-toggle {
    display: none;
}

@media (max-width: 600px) {
    #death-counter.collapsed {
        height: 40px;
        overflow: hidden;
    }
    
    #death-counter.collapsed .counter-item:not(:first-child),
    #death-counter.collapsed .counter-since {
        display: none;
    }
    
    .counter-toggle {
        display: block;
        background: transparent;
        border: none;
        color: var(--c-text-dim);
        font-size: 12px;
        cursor: pointer;
        padding: 4px;
        margin-top: 4px;
    }
    
    .counter-toggle:focus {
        outline: 2px solid var(--c-cyber);
        outline-offset: 2px;
        padding: 6px 8px;
        margin-top: 6px;
    }
    
    .counter-toggle:focus {
        outline: 3px solid var(--c-cyber);
        outline-offset: 3px;
    }
    
    .counter-item {
        margin: 6px 0;
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   Accessibility & Reduced Motion
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
    }
    
    /* Reduce particle intensity */
    #soul-particles,
    #opening-effect {
        opacity: 0.3;
    }
}

/* Focus states for keyboard navigation */
button:focus,
a:focus,
textarea:focus,
.immersive-close:focus {
    outline: 2px solid var(--c-cyber);
    outline-offset: 2px;
    outline: 3px solid var(--c-cyber);
    outline-offset: 3px;
}

button:focus-visible,
a:focus-visible,
textarea:focus-visible,
.immersive-close:focus-visible {
    outline: 3px solid var(--c-cyber);
    outline-offset: 3px;
}

button:focus:not(:focus-visible),
a:focus:not(:focus-visible),
textarea:focus:not(:focus-visible),
.immersive-close:focus:not(:focus-visible) {
    outline: none;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ä¸»é«”é–€æˆ¶
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
main {
    min-height: 100vh;
    padding: 75px 20px 40px;
    display: flex;
    flex-direction: column;
    align-items: center;
    position: relative;
    z-index: 1;
}

/* æ¨™é¡Œå€ */
.portal-header {
    text-align: center;
    margin-bottom: 60px;
    padding: 40px 20px;
}

.portal-title {
    font-family: var(--f-serif);
    font-size: clamp(2rem, 6vw, 4rem);
    font-weight: 900;
    color: var(--c-text-bright);
    text-shadow: 0 0 60px rgba(255,255,255,0.3);
    margin-bottom: 25px;
    letter-spacing: 8px;
}

.portal-subtitle {
    font-family: var(--f-sans);
    font-size: clamp(1rem, 2vw, 1.3rem);
    color: var(--c-text);
    line-height: 2;
}

/* é–€æˆ¶å…¥å£å¡ç‰‡ */
.portal-gates {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: 30px;
    max-width: 1200px;
    width: 100%;
    margin-bottom: 60px;
}

.gate-card {
    background: linear-gradient(135deg, rgba(30,25,40,0.85), rgba(15,10,25,0.9));
    border: 1px solid rgba(255,255,255,0.15);
    border-radius: 12px;
    padding: 40px 30px;
    text-align: center;
    transition: all 0.5s ease;
    cursor: pointer;
    text-decoration: none;
    position: relative;
    overflow: hidden;
    backdrop-filter: blur(5px);
}

.gate-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: -100%;
    width: 100%;
    height: 100%;
    background: linear-gradient(90deg, transparent, rgba(255,255,255,0.08), transparent);
    transition: left 0.8s ease;
}

.gate-card:hover::before {
    left: 100%;
}

.gate-card:hover {
    transform: translateY(-8px);
    border-color: var(--c-cyber);
    box-shadow: 0 20px 60px rgba(0,243,255,0.2);
}

.gate-card.macro { border-left: 4px solid var(--c-blood); }
.gate-card.micro { border-left: 4px solid var(--c-cyber); }
.gate-card.soul { border-left: 4px solid var(--c-soul); }

.gate-icon {
    font-size: 3rem;
    margin-bottom: 20px;
}

.gate-title {
    font-family: var(--f-head);
    font-size: 1.3rem;
    color: var(--c-text-bright);
    margin-bottom: 10px;
    letter-spacing: 2px;
}

.gate-subtitle {
    font-family: var(--f-serif);
    font-size: 1.2rem;
    color: var(--c-text);
    margin-bottom: 20px;
    letter-spacing: 3px;
}

.gate-desc {
    font-size: 1rem;
    color: var(--c-text-dim);
    line-height: 1.9;
}

.gate-card.macro .gate-title { color: #ffbbbb; }
.gate-card.micro .gate-title { color: #bbffff; }
.gate-card.soul .gate-title { color: #eeccff; }

/* åº•éƒ¨å“²ç† */
.portal-footer {
    text-align: center;
    padding: 40px 20px;
    border-top: 1px solid rgba(255,255,255,0.1);
    max-width: 800px;
}

.footer-quote {
    font-family: var(--f-serif);
    font-size: clamp(1rem, 2vw, 1.2rem);
    color: var(--c-text);
    line-height: 2.2;
    font-style: italic;
}

.footer-ref {
    color: var(--c-blood);
    font-size: 0.9em;
    margin-top: 15px;
    display: block;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ã€Œå¦‚æœæ˜¯ä½ ã€æ²‰æµ¸æ¨¡å¼
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#immersive-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.98);
    z-index: 99998;
    display: none;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    padding: 20px;
    opacity: 0;
    transition: opacity 1s ease;
}

#immersive-overlay.active {
    display: flex;
    opacity: 1;
}

.immersive-content {
    max-width: 700px;
    text-align: center;
}

.immersive-stage {
    display: none;
    animation: fadeInStage 1.5s ease-out forwards;
}

.immersive-stage.active {
    display: block;
}

@keyframes fadeInStage {
    0% { opacity: 0; transform: scale(0.95); }
    100% { opacity: 1; transform: scale(1); }
}

.immersive-question {
    font-family: var(--f-serif);
    font-size: clamp(1.3rem, 4vw, 2rem);
    color: var(--c-text-bright);
    line-height: 1.9;
    margin-bottom: 30px;
}

.immersive-sub {
    font-size: 1.05rem;
    color: var(--c-text);
    line-height: 2;
    margin-bottom: 30px;
}

.immersive-choices {
    display: flex;
    flex-direction: column;
    gap: 15px;
    margin-bottom: 30px;
}

.immersive-choice {
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.25);
    padding: 18px 25px;
    border-radius: 8px;
    color: var(--c-text);
    font-size: 1.05rem;
    cursor: pointer;
    transition: all 0.3s ease;
    text-align: left;
}

.immersive-choice:hover {
    background: rgba(255,255,255,0.15);
    border-color: var(--c-cyber);
    color: var(--c-text-bright);
}

.immersive-input {
    width: 100%;
    padding: 18px;
    background: rgba(255,255,255,0.08);
    border: 1px solid rgba(255,255,255,0.25);
    border-radius: 8px;
    color: var(--c-text-bright);
    font-size: 1rem;
    font-family: var(--f-sans);
    margin-bottom: 20px;
    text-align: center;
}

.immersive-input:focus {
    outline: none;
    border-color: var(--c-soul);
}

.immersive-btn {
    background: transparent;
    border: 1px solid rgba(255,255,255,0.4);
    color: var(--c-text);
    padding: 14px 35px;
    font-family: var(--f-tech);
    font-size: 13px;
    letter-spacing: 2px;
    cursor: pointer;
    transition: all 0.3s ease;
    margin: 5px;
}

.immersive-btn:hover {
    border-color: var(--c-text-bright);
    color: var(--c-text-bright);
}

.immersive-btn.primary {
    border-color: var(--c-cyber);
    color: var(--c-cyber);
}

.immersive-btn.primary:hover {
    background: var(--c-cyber);
    color: #000;
}

.immersive-close {
    position: absolute;
    top: 20px;
    right: 20px;
    background: none;
    border: none;
    color: var(--c-text-dim);
    font-size: 28px;
    cursor: pointer;
    transition: color 0.3s;
}

.immersive-close:hover {
    color: var(--c-text-bright);
}

.immersive-wisdom {
    font-family: var(--f-serif);
    font-size: 1.1rem;
    color: var(--c-text);
    line-height: 2.2;
    font-style: italic;
    border-left: 3px solid var(--c-soul);
    padding-left: 20px;
    text-align: left;
    margin: 30px 0;
}

.immersive-ref {
    color: var(--c-hope);
    font-size: 0.9em;
    display: block;
    margin-top: 10px;
    font-style: normal;
}

/* Gospel Video Stage */
.video-container {
    display: flex;
    flex-direction: column;
    gap: 30px;
    margin: 30px 0;
    max-width: 100%;
}

.video-item {
    width: 100%;
}

.video-item h3 {
    color: var(--c-hope);
    font-family: var(--f-serif);
    font-size: 1.2rem;
    margin-bottom: 15px;
    text-align: center;
}

.video-item iframe {
    width: 100%;
    height: 315px;
    border: 2px solid rgba(255, 215, 0, 0.3);
    border-radius: 8px;
    background: rgba(0, 0, 0, 0.5);
}

@media (max-width: 600px) {
    .video-item iframe {
        height: 200px;
    }
    
    .video-container {
        gap: 20px;
        margin: 20px 0;
    }
}

/* Placeholder Images */
.placeholder-section {
    position: relative;
    margin: 40px 0;
    text-align: center;
}

.placeholder-img {
    max-width: 100%;
    height: auto;
    border-radius: 8px;
    opacity: 0.7;
    border: 2px dashed rgba(255, 255, 255, 0.2);
}

.placeholder-notice {
    position: absolute;
    top: 10px;
    right: 10px;
    background: rgba(0, 0, 0, 0.8);
    color: var(--c-warning);
    padding: 8px 12px;
    border-radius: 4px;
    font-size: 11px;
    font-family: var(--f-tech);
    border: 1px solid var(--c-warning);
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   éŸ¿æ‡‰å¼
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
@media (max-width: 768px) {
    #death-counter {
        flex-direction: column;
        height: auto;
        padding: 12px;
        gap: 8px;
    }

    .counter-item {
        font-size: 13px;
    }

    .portal-gates {
        grid-template-columns: 1fr;
        display: flex;
        flex-direction: column;
    }

    /* æ‰‹æ©Ÿç‰ˆæ’åºï¼šè¨˜éŒ„å„€ â†’ IF YOU â†’ æ™‚é–“è»¸ */
    .gate-card.micro { order: 1; }
    .gate-card.soul { order: 2; }
    .gate-card.macro { order: 3; }

    .gate-card {
        padding: 30px 20px;
    }

    .opening-fixed-title {
        letter-spacing: 4px;
    }
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   èªè¨€åˆ‡æ›å™¨
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#language-switcher {
   Language Switcher
   â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.lang-switcher {
    position: fixed;
    top: 20px;
    right: 20px;
    z-index: 10000;
    display: flex;
    gap: 8px;
    background: rgba(0, 0, 0, 0.7);
    padding: 8px 12px;
    border-radius: 8px;
    border: 1px solid rgba(0, 243, 255, 0.3);
    border: 1px solid rgba(255, 255, 255, 0.1);
    backdrop-filter: blur(10px);
}

.lang-btn {
    font-family: var(--f-tech);
    font-size: 12px;
    padding: 6px 12px;
    background: rgba(255, 255, 255, 0.05);
    color: var(--c-text-dim);
    border: 1px solid rgba(255, 255, 255, 0.1);
    border-radius: 4px;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
}

.lang-btn:hover {
    background: rgba(0, 243, 255, 0.1);
    color: var(--c-cyber);
    border-color: var(--c-cyber);
    background: transparent;
    border: 1px solid rgba(255, 255, 255, 0.2);
    color: var(--c-text-dim);
    padding: 6px 12px;
    border-radius: 4px;
    cursor: pointer;
    font-family: var(--f-sans);
    font-size: 12px;
    transition: all 0.3s ease;
}

.lang-btn:hover {
    border-color: var(--c-cyber);
    color: var(--c-cyber);
    background: rgba(0, 243, 255, 0.1);
    background: rgba(0, 243, 255, 0.15);
    transform: translateY(-1px);
}

.lang-btn.active {
    background: var(--c-cyber);
    color: var(--c-void);
    border-color: var(--c-cyber);
    font-weight: 600;
    font-weight: bold;
}

@media (max-width: 768px) {
    #language-switcher {
}

.lang-btn:focus {
    outline: 2px solid var(--c-cyber);
    outline-offset: 2px;
    outline-offset: 3px;
}

.lang-btn:focus:not(:focus-visible) {
    outline: none;
}

[data-lang] {
    display: none;
}

[data-lang].active {
    display: inline;
}

div[data-lang].active, 
button[data-lang].active,
a[data-lang].active {
    display: block;
}

/* Reduced motion support */
@media (prefers-reduced-motion: reduce) {
    .lang-btn {
        transition: none;
    }
}

@media (max-width: 600px) {
    .lang-switcher {
        top: 10px;
        right: 10px;
        padding: 6px 8px;
        gap: 6px;
    }
    
    .lang-btn {
        font-size: 10px;
        padding: 4px 8px;
        padding: 4px 8px;
        font-size: 11px;
    }
}

/* Navigation Bar Styles */
.main-nav {
    background-color: #1a1a1a;
    border-bottom: 2px solid #333;
    padding: 1rem 2rem;
    position: sticky;
    top: 0;
    z-index: 1000;
    box-shadow: 0 4px 6px rgba(0,0,0,0.3);
}

.nav-container {
    max-width: 1200px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.nav-logo {
    font-size: 1.5rem;
    font-weight: bold;
    color: #fff;
    text-decoration: none;
    letter-spacing: 1px;
}

.nav-logo span {
    color: #e74c3c;
}

.nav-links {
    display: flex;
    gap: 20px;
    list-style: none;
    margin: 0;
    padding: 0;
}

.nav-links a {
    color: #ccc;
    text-decoration: none;
    font-size: 1rem;
    transition: color 0.3s ease;
    padding: 5px 10px;
    border-radius: 4px;
}

.nav-links a:hover, .nav-links a.active {
    color: #fff;
    background-color: #333;
}

@media (max-width: 768px) {
    .nav-container {
        flex-direction: column;
        gap: 10px;
    }
    .nav-links {
        gap: 10px;
        font-size: 0.9rem;
    }
}
</style>
</head>
<body>

<nav class="main-nav">
    <div class="nav-container">
        <a href="index.html" class="nav-logo">ç”Ÿæ­»ä¹‹é–“ <span>LIFE</span></a>
        <ul class="nav-links">
            <li><a href="index.html" class="active">é¦–é  Home</a></li>
            <li><a href="monitor.html">ç”Ÿæ­»è¨˜éŒ„å„€ Monitor</a></li>
            <li><a href="mission-briefing.html">ä»»å‹™ç¸½è¦½ Missions</a></li>
        </ul>
    </div>
</nav>

<!-- Language Switcher -->
<div class="lang-switcher">
    <button class="lang-btn active" data-lang-switch="zh-TW" onclick="switchLanguage('zh-TW')" aria-label="åˆ‡æ›è‡³ç¹é«”ä¸­æ–‡">ç¹</button>
    <button class="lang-btn" data-lang-switch="zh-CN" onclick="switchLanguage('zh-CN')" aria-label="åˆ‡æ¢è‡³ç®€ä½“ä¸­æ–‡">ç®€</button>
    <button class="lang-btn" data-lang-switch="en" onclick="switchLanguage('en')" aria-label="Switch to English">EN</button>
</div>

    <button class="lang-btn active" data-lang-switch="zh-TW" onclick="switchLanguage('zh-TW')" aria-label="åˆ‡æ›è‡³ç¹é«”ä¸­æ–‡">ç¹é«”</button>
    <button class="lang-btn" data-lang-switch="zh-CN" onclick="switchLanguage('zh-CN')" aria-label="åˆ‡æ¢è‡³ç®€ä½“ä¸­æ–‡">ç®€ä½“</button>
    <button class="lang-btn" data-lang-switch="en" onclick="switchLanguage('en')" aria-label="Switch to English">EN</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     èªè¨€åˆ‡æ›å™¨
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="language-switcher">
    <button class="lang-btn active" data-lang="zh-TW" onclick="switchLanguage('zh-TW')">ç¹</button>
    <button class="lang-btn" data-lang="zh-CN" onclick="switchLanguage('zh-CN')">ç®€</button>
    <button class="lang-btn" data-lang="en" onclick="switchLanguage('en')">EN</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     éˆé­‚ç²’å­èƒŒæ™¯
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<canvas id="soul-particles"></canvas>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     æ¥µç°¡é¦–é åŸå‹ - Minimalist Entry Overlay
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="minimalist-entry">
    <!-- Shocking Death Counter - Primary Visual Focus -->
    <div class="mini-death-counter" role="status" aria-label="å…¨çƒæ­»äº¡çµ±è¨ˆ">
        <div class="mini-counter-label">æ­¤åˆ»èµ·å…¨çƒå·²æœ‰</div>
        <div class="mini-counter-number" id="mini-death-count" aria-live="polite">0</div>
        <div class="mini-counter-desc">äººé›¢ä¸– / Deaths Since You Arrived</div>
    </div>
    
    <!-- Binary Question -->
    <div class="mini-question">
        <div class="mini-question-text">ä½ æº–å‚™å¥½äº†å—ï¼Ÿ</div>
        <div class="mini-question-sub">Are You Ready?</div>
    </div>
    
    <!-- Two Choice Buttons with Reverse Psychology -->
    <div class="mini-choices">
        <button class="mini-choice-btn negative" onclick="handleMinimalistChoice('no')" aria-label="ä¸ï¼Œå‘Šè¨´æˆ‘æ›´å¤š">
            <span>ä¸ãƒ»NO</span>
        </button>
        <button class="mini-choice-btn positive" onclick="handleMinimalistChoice('yes')" aria-label="æ˜¯çš„ï¼Œæˆ‘æº–å‚™å¥½äº†">
            <span>æ˜¯ãƒ»YES</span>
        </button>
    </div>
</div>

<!-- Exit Message for "Yes" Response -->
<div class="exit-message" id="exit-message">
    <div class="exit-message-text">é‚£å°±å»ç”Ÿæ´»å§</div>
    <div class="exit-countdown" id="exit-countdown">3</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     é–‹å ´ï¼šå›ºå®šæ¨™é¡Œã€Œä»Šç”Ÿèˆ‡æ°¸æ†ï¼Œç”¦é†’èˆ‡æ˜æ²‰ã€+ éš¨æ©Ÿå“²ç† + éš¨æ©Ÿç‰¹æ•ˆ
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="opening-overlay">
    <canvas id="opening-effect"></canvas>
    <div class="opening-content">
        <div class="opening-fixed-title" data-i18n="opening-fixed-title">ã€ä»Šç”Ÿèˆ‡æ°¸æ†ï¼Œç”¦é†’èˆ‡æ˜æ²‰ã€</div>
        <div class="opening-fixed-sub" data-i18n="opening-fixed-sub">ç”Ÿæ­»â€§åªåœ¨ä¸€ç·šä¹‹å·®</div>
        <div class="opening-divider"></div>
        <div class="opening-main" id="opening-main"></div>
        <div class="opening-sub" id="opening-sub"></div>
        <div class="opening-verse" id="opening-verse"></div>
    </div>
    <div class="enter-hint" data-i18n="enter-hint">[ é» æ“Š é€² å…¥ ]</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     æ­»äº¡åŒæ­¥è¨ˆæ•¸å™¨
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="death-counter" role="region" aria-label="å…¨çƒæ­»äº¡çµ±è¨ˆ">
    <div class="counter-item">
        <span class="counter-label" data-i18n="counter-label-1">ä½ é€²å…¥å¾Œï¼Œå…¨çƒå·²æœ‰</span>
        <span class="counter-value" id="death-since-entry">0</span>
        <span class="counter-label" data-i18n="counter-unit-1">äººæ­»äº¡</span>
    </div>
    <div class="counter-item">
        <span class="counter-label" data-i18n="counter-label-2">ä»Šæ—¥å…¨çƒç´„</span>
        <span class="counter-value" id="death-today">0</span>
        <span class="counter-label" data-i18n="counter-unit-2">äººé›¢ä¸–</span>
    </div>
    <div class="counter-since" data-i18n="counter-since">ï¼ˆæ¯ç§’ç´„ 1.8 äººãƒ»WHO å…¨çƒæ­»äº¡ç‡ä¼°ç®—ï¼‰</div>
        <span class="counter-label">ä½ é€²å…¥å¾Œï¼Œå…¨çƒå·²æœ‰</span>
        <span class="counter-value" id="death-since-entry" aria-live="polite">0</span>
        <span class="counter-label">äººæ­»äº¡</span>
    </div>
    <div class="counter-item">
        <span class="counter-label">ä»Šæ—¥å…¨çƒç´„</span>
        <span class="counter-value" id="death-today" aria-live="polite">0</span>
        <span class="counter-label">äººé›¢ä¸–</span>
    </div>
    <div class="counter-since">ï¼ˆæ¯ç§’ç´„ 1.8 äººãƒ»WHO å…¨çƒæ­»äº¡ç‡ä¼°ç®—ï¼‰</div>
    <button class="counter-toggle" onclick="toggleCounter()" aria-label="å±•é–‹æˆ–æ”¶åˆæ­»äº¡è¨ˆæ•¸å™¨">â–¼</button>
    <button class="counter-toggle" onclick="toggleCounter()" aria-label="å±•é–‹æ­»äº¡è¨ˆæ•¸å™¨" aria-expanded="false">â–¼</button>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ä¸»é«”é–€æˆ¶
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<main>
    <div class="portal-header">
        <h1 class="portal-title" data-i18n="portal-title">ç”Ÿ æ­» ä¹‹ é–“</h1>
        <p class="portal-subtitle">
            <span data-i18n="portal-subtitle-1">æ¯ä¸€å¤©ï¼Œå…¨çƒç´„æœ‰ 15 è¬äººé›¢é–‹é€™å€‹ä¸–ç•Œ</span><br>
            <span data-i18n="portal-subtitle-2">ä»–å€‘ä¹‹ä¸­ï¼Œæœ‰å¤šå°‘äººé å‚™å¥½äº†ï¼Ÿ</span><br>
            <span data-i18n="portal-subtitle-3">ä½ å‘¢ï¼Ÿ</span>
        </p>
    </div>

    <div class="portal-gates">
        <!-- å®è§€ï¼šä¸ƒç½å¹´æ™‚é–“è»¸ -->
        <a href="timeline.html" class="gate-card macro">
            <div class="gate-icon">ğŸ“œ</div>
            <div class="gate-title" data-i18n="gate-title-1">THE TRIBULATION</div>
            <div class="gate-subtitle" data-i18n="gate-subtitle-1">ä¸ƒ ç½ å¹´ æ™‚ é–“ è»¸</div>
            <div class="gate-desc">
                <span data-i18n="gate-desc-1-1">2019 ç˜Ÿç–« â†’ 2027 å¹è§’ç¯€</span><br>
                <span data-i18n="gate-desc-1-2">å››é¦¬ã€ä¸ƒå°ã€ä¸ƒè™Ÿ</span><br>
                <span data-i18n="gate-desc-1-3">å®è§€é è¨€èˆ‡ç¾å¯¦çš„å°ç…§</span>
            </div>
        </a>

        <!-- å¾®è§€ï¼šç”Ÿæ­»è¨˜éŒ„å„€ -->
        <a href="monitor.html" class="gate-card micro">
            <div class="gate-icon">â˜ ï¸</div>
            <div class="gate-title" data-i18n="gate-title-2">VITAL LIFE MONITOR</div>
            <div class="gate-subtitle" data-i18n="gate-subtitle-2">ç”Ÿ æ­» è¨˜ éŒ„ å„€</div>
            <div class="gate-desc">
                <span data-i18n="gate-desc-2-1">æ¯ä¸€æ¢æ–°èï¼Œéƒ½æ˜¯ä¸€å€‹å®Œæ•´äººç”Ÿçš„çµ‚çµ</span><br>
                <span data-i18n="gate-desc-2-2">ä»Šå¤©çš„é ­æ¢ï¼Œæ˜å¤©å¯èƒ½æ˜¯ä½ </span><br>
                <span data-i18n="gate-desc-2-3">å€‹é«”æ­»äº¡äº‹ä»¶è¿½è¹¤</span>
            </div>
        </a>

        <!-- éˆé­‚ï¼šå¦‚æœæ˜¯ä½  -->
        <div class="gate-card soul" onclick="startImmersive()">
            <div class="gate-icon">ğŸ’­</div>
            <div class="gate-title" data-i18n="gate-title-3">IF IT WERE YOU</div>
            <div class="gate-subtitle" data-i18n="gate-subtitle-3">å¦‚ æœ æ˜¯ ä½ </div>
            <div class="gate-desc">
                <span data-i18n="gate-desc-3-1">çµ¦è‡ªå·± 3 åˆ†é˜</span><br>
                <span data-i18n="gate-desc-3-2">èªçœŸæ€è€ƒä¸€å€‹ä½ ä¸€ç›´é€ƒé¿çš„å•é¡Œ</span><br>
                <span data-i18n="gate-desc-3-3">éˆé­‚çš„å»è™•</span>
            </div>
        </div>
    </div>

    <div class="portal-footer">
        <div class="footer-quote">
            <span data-i18n="footer-quote-1">ã€Œäººè‹¥è³ºå¾—å…¨ä¸–ç•Œï¼Œè³ ä¸Šè‡ªå·±çš„ç”Ÿå‘½ï¼Œæœ‰ç”šéº¼ç›Šè™•å‘¢ï¼Ÿ</span><br>
            <span data-i18n="footer-quote-2">äººé‚„èƒ½æ‹¿ç”šéº¼æ›ç”Ÿå‘½å‘¢ï¼Ÿã€</span>
            <span class="footer-ref" data-i18n="footer-ref">â€” é¦¬å¤ªç¦éŸ³ 16:26</span>
        </div>
    </div>
</main>

<!-- Placeholder Image Section -->
<!-- Placeholder Image Section
     Source: Unsplash (https://unsplash.com/photos/L7en7Lb-Ovc)
     TODO: Replace with owner's choice of image that represents spirituality/theology
     Current placeholder is free to use via Unsplash License -->
<div class="placeholder-section" style="position: relative; z-index: 1; padding: 20px;">
    <img 
        src="https://images.unsplash.com/photo-1519834785169-98be25ec3f84?w=1200&h=400&fit=crop" 
        alt="Placeholder - Sky and clouds represent spirituality"
        class="placeholder-img"
        loading="lazy"
    />
    <div class="placeholder-notice">PLACEHOLDER IMAGE - Replace with owner's choice</div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
     ã€Œå¦‚æœæ˜¯ä½ ã€æ²‰æµ¸æ¨¡å¼
     â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="immersive-overlay">
    <button class="immersive-close" onclick="closeImmersive()">Ã—</button>
    <div class="immersive-content">

        <!-- éšæ®µ 1ï¼šç”Ÿå‘½çš„è‹¦ -->
        <div class="immersive-stage" id="stage-1">
            <div class="immersive-question">
                ä½ æœ‰æ²’æœ‰æƒ³é<br>
                æ´»è‘—ï¼Œåˆ°åº•æ˜¯ç‚ºäº†ä»€éº¼ï¼Ÿ
            </div>
            <div class="immersive-sub">
                å·¥ä½œã€è³ºéŒ¢ã€ä¾›æ¨“ã€é¤Šå®¶<br>
                ç„¶å¾Œå‘¢ï¼Ÿ<br>
                ç„¶å¾Œæœ‰ä¸€å¤©ï¼Œä½ ä¹Ÿæœƒæˆç‚ºæ–°èè£¡çš„ä¸€å€‹æ•¸å­—
            </div>
            <button class="immersive-btn primary" onclick="nextStage(2)">ç¹¼ çºŒ</button>
        </div>

        <!-- éšæ®µ 2ï¼šæ­»äº¡çš„ææ‡¼ -->
        <div class="immersive-stage" id="stage-2">
            <div class="immersive-question">
                å¦‚æœä»Šæ™šä½ åœ¨ç¡å¤¢ä¸­é›¢é–‹<br>
                ä½ æœ€æ”¾ä¸ä¸‹çš„æ˜¯ä»€éº¼ï¼Ÿ
            </div>
            <textarea class="immersive-input" id="input-regret" placeholder="å¯«ä¸‹ä¾†ï¼Œåªæœ‰ä½ è‡ªå·±çœ‹å¾—åˆ°..." rows="3"></textarea>
            <div class="immersive-sub">
                å¤§å¤šæ•¸äººå¾ä¾†æ²’æœ‰èªçœŸæƒ³éé€™å€‹å•é¡Œ<br>
                ç›´åˆ°ä¾†ä¸åŠæƒ³çš„é‚£ä¸€å¤©
            </div>
            <button class="immersive-btn" onclick="nextStage(1)">è¿” å›</button>
            <button class="immersive-btn primary" onclick="nextStage(3)">ç¹¼ çºŒ</button>
        </div>

        <!-- éšæ®µ 3ï¼šéˆé­‚çš„å»è™• -->
        <div class="immersive-stage" id="stage-3">
            <div class="immersive-question">
                ä½ ç›¸ä¿¡æ­»å¾Œ<br>
                é‚„æœ‰ã€Œä½ ã€å—ï¼Ÿ
            </div>
            <div class="immersive-choices">
                <div class="immersive-choice" onclick="selectBelief('nothing')">
                    ä»€éº¼éƒ½æ²’æœ‰ï¼Œäººæ­»å¦‚ç‡ˆæ»…
                </div>
                <div class="immersive-choice" onclick="selectBelief('reincarnation')">
                    è¼ªè¿´è½‰ä¸–ï¼Œç¹¼çºŒä¸‹ä¸€æ®µæ—…ç¨‹
                </div>
                <div class="immersive-choice" onclick="selectBelief('heaven-hell')">
                    å¤©å ‚æˆ–åœ°ç„ï¼Œéˆé­‚æ°¸å­˜
                </div>
                <div class="immersive-choice" onclick="selectBelief('unknown')">
                    ä¸çŸ¥é“ï¼Œå¾ä¾†æ²’èªçœŸæƒ³é
                </div>
            </div>
            <button class="immersive-btn" onclick="nextStage(2)">è¿” å›</button>
        </div>

        <!-- éšæ®µ 4ï¼šä¸åŒå›æ‡‰ - è™›ç„¡ -->
        <div class="immersive-stage" id="stage-nothing">
            <div class="immersive-question">
                å¦‚æœæ­»å¾Œä»€éº¼éƒ½æ²’æœ‰<br>
                é‚£ä½ ç¾åœ¨çš„ä¸€åˆ‡æ™æ‰ï¼Œæ„ç¾©ä½•åœ¨ï¼Ÿ
            </div>
            <div class="immersive-sub">
                å¦‚æœçµ‚é»æ˜¯è™›ç„¡<br>
                ç‚ºä»€éº¼ä½ é‚„æœƒææ‡¼æ­»äº¡ï¼Ÿ<br>
                ç‚ºä»€éº¼ä½ é‚„æœƒåœ¨ä¹è¢«è¨˜ä½ï¼Ÿ<br><br>
                ä¹Ÿè¨±ï¼Œä½ å…§å¿ƒæ·±è™•çŸ¥é“<br>
                äº‹æƒ…æ²’é‚£éº¼ç°¡å–®
            </div>
            <button class="immersive-btn primary" onclick="nextStage(5)">ç¹¼ çºŒ</button>
        </div>

        <!-- éšæ®µ 4ï¼šä¸åŒå›æ‡‰ - è¼ªè¿´ -->
        <div class="immersive-stage" id="stage-reincarnation">
            <div class="immersive-question">
                å¦‚æœæœ‰è¼ªè¿´<br>
                ä½ é€™ä¸€ä¸–åšäº†ä»€éº¼ï¼Œå€¼å¾—ä¸‹ä¸€ä¸–æ›´å¥½ï¼Ÿ
            </div>
            <div class="immersive-sub">
                è¼ªè¿´çš„ç›¡é ­æ˜¯ä»€éº¼ï¼Ÿ<br>
                æ°¸é çš„å¾ªç’°ï¼Œé‚„æ˜¯æœ€çµ‚çš„è§£è„«ï¼Ÿ<br>
                å¦‚æœé€£è§£è„«çš„æ–¹æ³•éƒ½ä¸ç¢ºå®š<br>
                é€™ä¸æ˜¯å¸Œæœ›ï¼Œé€™æ˜¯è³­åš
            </div>
            <button class="immersive-btn primary" onclick="nextStage(5)">ç¹¼ çºŒ</button>
        </div>

        <!-- éšæ®µ 4ï¼šä¸åŒå›æ‡‰ - å¤©å ‚åœ°ç„ -->
        <div class="immersive-stage" id="stage-heaven-hell">
            <div class="immersive-question">
                å¦‚æœçœŸçš„æœ‰å¤©å ‚å’Œåœ°ç„<br>
                ä½ æ†‘ä»€éº¼å»å¤©å ‚ï¼Ÿ
            </div>
            <div class="immersive-sub">
                åšå¥½äººï¼Ÿåšå–„äº‹ï¼Ÿ<br>
                å¤šå°‘æ‰ç®—ã€Œå¤ ã€ï¼Ÿ<br>
                èª°ä¾†å®šæ¨™æº–ï¼Ÿ<br><br>
                å¦‚æœæ¨™æº–æ˜¯ã€Œå®Œç¾ã€<br>
                ä½ æœ‰æŠŠæ¡å—ï¼Ÿ
            </div>
            <button class="immersive-btn primary" onclick="nextStage(5)">ç¹¼ çºŒ</button>
        </div>

        <!-- éšæ®µ 4ï¼šä¸åŒå›æ‡‰ - ä¸çŸ¥é“ -->
        <div class="immersive-stage" id="stage-unknown">
            <div class="immersive-question">
                ä½ å¾ä¾†æ²’èªçœŸæƒ³é<br>
                ä½†é€™ä¸ä»£è¡¨å•é¡Œä¸å­˜åœ¨
            </div>
            <div class="immersive-sub">
                ä½ å¯ä»¥ä¸æƒ³<br>
                ä½†ä½ é€ƒä¸é<br><br>
                æ­»äº¡æ˜¯å”¯ä¸€ç¢ºå®šæœƒç™¼ç”Ÿçš„äº‹<br>
                è€Œä½ å°å®ƒä¸€ç„¡æ‰€çŸ¥<br><br>
                é€™ä¸å¥‡æ€ªå—ï¼Ÿ
            </div>
            <button class="immersive-btn primary" onclick="nextStage(5)">ç¹¼ çºŒ</button>
        </div>

        <!-- éšæ®µ 5ï¼šå…±æƒ…èˆ‡è½‰æŠ˜ -->
        <div class="immersive-stage" id="stage-5">
            <div class="immersive-question">
                å…¶å¯¦ï¼Œæ¯å€‹äººéƒ½ä¸€æ¨£
            </div>
            <div class="immersive-sub">
                æˆ‘å€‘éƒ½æ€•æ­»<br>
                æˆ‘å€‘éƒ½ä¸çŸ¥é“æ˜å¤©æœƒç™¼ç”Ÿä»€éº¼<br>
                æˆ‘å€‘éƒ½åœ¨å¿™ç¢Œä¸­é€ƒé¿é€™å€‹å•é¡Œ<br><br>
                ä½†é€ƒé¿ä¸æœƒè®“å•é¡Œæ¶ˆå¤±<br>
                åªæœƒè®“ä½ åœ¨é‚£ä¸€å¤©ä¾†è‡¨æ™‚ï¼Œæ›´åŠ æªæ‰‹ä¸åŠ
            </div>
            <div class="immersive-wisdom">
                ã€Œå…¶å¯¦æ˜å¤©å¦‚ä½•ï¼Œä½ å€‘é‚„ä¸çŸ¥é“ã€‚<br>
                ä½ å€‘çš„ç”Ÿå‘½æ˜¯ç”šéº¼å‘¢ï¼Ÿ<br>
                ä½ å€‘åŸä¾†æ˜¯ä¸€ç‰‡é›²éœ§ï¼Œå‡ºç¾å°‘æ™‚å°±ä¸è¦‹äº†ã€‚ã€
                <span class="immersive-ref">â€” é›…å„æ›¸ 4:14</span>
            </div>
            <button class="immersive-btn primary" onclick="nextStage(6)">ç¹¼ çºŒ</button>
        </div>

        <!-- éšæ®µ 6ï¼šä¸€ç·šå¸Œæœ› -->
        <div class="immersive-stage" id="stage-6">
            <div class="immersive-question">
                å¦‚æœæœ‰ä¸€æ¢è·¯<br>
                å¯ä»¥è®“ä½ ä¸å†ææ‡¼æ­»äº¡å‘¢ï¼Ÿ
            </div>
            <div class="immersive-sub">
                ä¸æ˜¯å› ç‚ºæ­»å¾Œä»€éº¼éƒ½æ²’æœ‰<br>
                è€Œæ˜¯å› ç‚ºä½ çŸ¥é“è‡ªå·±æœƒå»å“ªè£¡<br><br>
                ä¸æ˜¯å› ç‚ºä½ å¤ å¥½<br>
                è€Œæ˜¯å› ç‚ºæœ‰äººæ›¿ä½ ä»˜äº†ä»£åƒ¹
            </div>
            <div class="immersive-wisdom">
                ã€Œç¥æ„›ä¸–äººï¼Œç”šè‡³å°‡ç¥‚çš„ç¨ç”Ÿå­è³œçµ¦ä»–å€‘<br>
                å«ä¸€åˆ‡ä¿¡ç¥‚çš„ï¼Œä¸è‡´æ»…äº¡ï¼Œåå¾—æ°¸ç”Ÿã€‚ã€
                <span class="immersive-ref">â€” ç´„ç¿°ç¦éŸ³ 3:16</span>
            </div>
            <button class="immersive-btn primary" onclick="nextStage(7)">æˆ‘æƒ³çŸ¥é“æ›´å¤š</button>
            <button class="immersive-btn" onclick="closeImmersive()">è®“æˆ‘å†æƒ³æƒ³</button>
        </div>

        <!-- éšæ®µ 7ï¼šç¦éŸ³ -->
        <div class="immersive-stage" id="stage-7">
            <div class="immersive-question">
                é€™ä¸æ˜¯å®—æ•™ï¼Œé€™æ˜¯é—œä¿‚
            </div>
            <div class="immersive-sub">
                2000 å¹´å‰ï¼Œæœ‰ä¸€å€‹äºº<br>
                ç¥‚æ²’æœ‰çŠ¯éä»»ä½•éŒ¯ï¼Œå»è¢«é‡˜æ­»åœ¨åå­—æ¶ä¸Š<br>
                ç¥‚èªªï¼šé€™æ˜¯ç‚ºäº†ä½ <br><br>
                å› ç‚ºä½ æˆ‘éƒ½é”ä¸åˆ°ã€Œå®Œç¾ã€çš„æ¨™æº–<br>
                æ‰€ä»¥ç¥‚ä¾†ï¼Œæ›¿æˆ‘å€‘æ‰¿å—äº†å¾Œæœ<br><br>
                ç¥‚çš„åå­—å«è€¶ç©Œ<br>
                ç¥‚æ­»äº†ï¼Œä½†ä¸‰å¤©å¾Œå¾©æ´»äº†<br>
                ç¥‚èªªï¼šã€Œä¿¡æˆ‘çš„äººï¼Œé›–ç„¶æ­»äº†ï¼Œä¹Ÿå¿…å¾©æ´»ã€
            </div>
            <div class="immersive-wisdom">
                ã€Œæˆ‘å°±æ˜¯é“è·¯ã€çœŸç†ã€ç”Ÿå‘½<br>
                è‹¥ä¸è—‰è‘—æˆ‘ï¼Œæ²’æœ‰äººèƒ½åˆ°çˆ¶é‚£è£¡å»ã€‚ã€
                <span class="immersive-ref">â€” ç´„ç¿°ç¦éŸ³ 14:6</span>
            </div>
            <button class="immersive-btn primary" onclick="nextStage(8)">æˆ‘æƒ³æ¥å—</button>
            <button class="immersive-btn" onclick="closeImmersive()">è®“æˆ‘å†æƒ³æƒ³</button>
        </div>

        <!-- éšæ®µ 8ï¼šæ±ºå¿—ç¦±å‘Š -->
        <div class="immersive-stage" id="stage-8">
            <div class="immersive-question">
                ä½ å¯ä»¥é€™æ¨£ç¦±å‘Š
            </div>
            <div class="immersive-wisdom" style="border-left-color: var(--c-hope);">
                ã€Œä¸»è€¶ç©Œï¼Œæˆ‘æ‰¿èªæˆ‘æ˜¯ä¸€å€‹ç½ªäºº<br><br>
                æˆ‘ç„¡æ³•é è‡ªå·±é€²åˆ°ä½ çš„åœ‹åº¦è£¡<br><br>
                æˆ‘ç›¸ä¿¡ç¥¢ç‚ºæˆ‘æ›¾é‡˜æ­»åœ¨åå­—æ¶ä¸Š<br>
                æ“”ç•¶äº†æˆ‘çš„ç½ª<br><br>
                æˆ‘ç›¸ä¿¡ç¥¢å·²å¾æ­»è£¡å¾©æ´»<br><br>
                æˆ‘é¡˜æ„æ‰“é–‹æˆ‘çš„å¿ƒ<br>
                æ±‚ç¥¢é€²å…¥æˆ‘çš„ç”Ÿå‘½å’Œå¿ƒè£¡<br>
                æˆç‚ºæˆ‘çš„æ•‘è´–ä¸»<br><br>
                å¸¶é ˜æˆ‘èµ°åœ¨ä½ æ°¸ç”Ÿçš„é“è·¯ä¸Š<br><br>
                å¥‰ä¸»è€¶ç©ŒåŸºç£çš„åç¦±å‘Šï¼Œé˜¿å€‘ã€‚ã€
            </div>
            <div class="immersive-sub">
                å¦‚æœä½ çœŸå¿ƒé€™æ¨£ç¦±å‘Šäº†<br>
                ä½ å·²ç¶“æˆç‚º ç¥çš„å…’å¥³<br>
                æ­»äº¡ä¸å†æ˜¯çµ‚é»ï¼Œè€Œæ˜¯å›å®¶çš„é–€<br><br>
                é¡˜æˆ‘å€‘åœ¨å¤©å®¶è£¡ç›¸è¦‹<br>
                é¡˜ä¸»ç¥ç¦æ‚¨
            </div>
            <button class="immersive-btn primary" onclick="nextStage(9)" aria-label="é˜¿å€‘ï¼Œé€²å…¥ä¸‹ä¸€æ­¥">é˜¿ å€‘</button>
        </div>

        <!-- éšæ®µ 9ï¼šç¦éŸ³è¦–é » -->
        <div class="immersive-stage" id="stage-9">
            <div class="immersive-question">
                é¡˜é€™äº›è¦–é »èƒ½å¹«åŠ©æ‚¨æ›´æ·±èªè­˜ç¦éŸ³
            </div>
            <div class="immersive-sub">
                è‹¥æƒ³é€²ä¸€æ­¥äº†è§£ï¼Œæ­¡è¿è§€çœ‹ä»¥ä¸‹ç¦éŸ³ä¿¡æ¯
            </div>
            
            <div class="video-container">
                <div class="video-item">
                    <h3>äº”è‰²çš„ç¦éŸ³ (ç²µèª)</h3>
                    <iframe 
                        src="https://e.pcloud.link/publink/show?code=XZe9REZXgIOJH7229yC2Sed3eDQdmqR62jX" 
                        frameborder="0" 
                        allowfullscreen
                        loading="lazy"
                        title="äº”è‰²çš„ç¦éŸ³ - ç²µèªç¦éŸ³è¦–é »"
                        aria-label="äº”è‰²çš„ç¦éŸ³ç²µèªç‰ˆè¦–é »">
                        aria-label="äº”è‰²çš„ç¦éŸ³ç²µèªç‰ˆè¦–é » - é»æ“Šæ’­æ”¾">
                    </iframe>
                </div>
                
                <div class="video-item">
                    <h3>ç¦éŸ³æ©‹ (åœ‹èª)</h3>
                    <iframe 
                        src="https://e.pcloud.link/publink/show?code=XZnHDNZwlvsOG27VGVYCpQrC8xTIylamRK7" 
                        frameborder="0" 
                        allowfullscreen
                        loading="lazy"
                        title="ç¦éŸ³æ©‹ - åœ‹èªç¦éŸ³è¦–é »"
                        aria-label="ç¦éŸ³æ©‹åœ‹èªç‰ˆè¦–é »">
                        aria-label="ç¦éŸ³æ©‹åœ‹èªç‰ˆè¦–é » - é»æ“Šæ’­æ”¾">
                    </iframe>
                </div>
            </div>
            
            <div style="display: flex; gap: 10px; justify-content: center; flex-wrap: wrap; margin-top: 20px;">
                <button class="immersive-btn primary" onclick="returnToPortal()" aria-label="è¿”å›ä¸»é ">è¿”å›ä¸»é </button>
                <button class="immersive-btn" onclick="nextStage(3)" aria-label="é‡æ–°é–‹å§‹éˆæ€§æ¢ç´¢">é‡æ–°æ¢ç´¢</button>
                <button class="immersive-btn primary" onclick="returnToPortal()" aria-label="è¿”å›ç¶²ç«™ä¸»é ">è¿”å›ä¸»é </button>
                <button class="immersive-btn" onclick="nextStage(3)" aria-label="é‡æ–°é–‹å§‹éˆæ€§æ¢ç´¢æ—…ç¨‹">é‡æ–°é–‹å§‹æ¢ç´¢</button>
            </div>
        </div>

    </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// éˆé­‚ç²’å­èƒŒæ™¯
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const soulCanvas = document.getElementById('soul-particles');
const soulCtx = soulCanvas.getContext('2d');
let soulParticles = [];

function initSoulParticles() {
    soulCanvas.width = window.innerWidth;
    soulCanvas.height = window.innerHeight;

    soulParticles = [];
    const reductionFactor = window.particleReductionFactor || 1;
    const baseCount = Math.floor((soulCanvas.width * soulCanvas.height) / 15000);
    const count = Math.floor(baseCount * reductionFactor);

    for (let i = 0; i < count; i++) {
        soulParticles.push({
            x: Math.random() * soulCanvas.width,
            y: Math.random() * soulCanvas.height,
            size: Math.random() * 2.5 + 1,
            speedY: -(Math.random() * 0.5 + 0.2),
            opacity: Math.random() * 0.6 + 0.2,
            hue: Math.random() > 0.7 ? 270 : 200 // ç´«è‰²æˆ–é’è‰²
        });
    }
}

function animateSoulParticles() {
    soulCtx.clearRect(0, 0, soulCanvas.width, soulCanvas.height);

    soulParticles.forEach(p => {
        p.y += p.speedY;
        p.opacity += (Math.random() - 0.5) * 0.02;
        p.opacity = Math.max(0.1, Math.min(0.8, p.opacity));

        if (p.y < -10) {
            p.y = soulCanvas.height + 10;
            p.x = Math.random() * soulCanvas.width;
        }

        soulCtx.beginPath();
        soulCtx.arc(p.x, p.y, p.size, 0, Math.PI * 2);
        soulCtx.fillStyle = `hsla(${p.hue}, 80%, 70%, ${p.opacity})`;
        soulCtx.fill();

        // å…‰æšˆ
        soulCtx.beginPath();
        soulCtx.arc(p.x, p.y, p.size * 3, 0, Math.PI * 2);
        soulCtx.fillStyle = `hsla(${p.hue}, 80%, 70%, ${p.opacity * 0.15})`;
        soulCtx.fill();
    });

    requestAnimationFrame(animateSoulParticles);
}

initSoulParticles();
animateSoulParticles();
window.addEventListener('resize', initSoulParticles);

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// æ¥µç°¡é¦–é åŸå‹ - Minimalist Entry Logic
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let miniEntryTime = null;
let miniCounterInterval = null;
// WHO global mortality estimate (2020): ~58 million deaths/year â‰ˆ 1.8 deaths/second
const MINI_DEATHS_PER_SECOND = 1.8;

// Start mini death counter immediately on page load
function startMiniCounter() {
    miniEntryTime = Date.now();
    
    function updateMiniCounter() {
        if (!miniEntryTime) return;
        
        const elapsed = (Date.now() - miniEntryTime) / 1000;
        const deathCount = Math.floor(elapsed * MINI_DEATHS_PER_SECOND);
        
        const counterEl = document.getElementById('mini-death-count');
        if (counterEl) {
            counterEl.textContent = deathCount.toLocaleString();
        }
    }
    
    // Update every 500ms for smooth animation
    miniCounterInterval = setInterval(updateMiniCounter, 500);
    updateMiniCounter(); // Initial update
}

// Handle user choice (Reverse Psychology)
function handleMinimalistChoice(choice) {
    const entryOverlay = document.getElementById('minimalist-entry');
    
    if (choice === 'yes') {
        // User says "Yes, I'm ready" - Show exit countdown and close
        const exitMessage = document.getElementById('exit-message');
        const countdownEl = document.getElementById('exit-countdown');
        
        exitMessage.classList.add('active');
        entryOverlay.classList.add('exit-mode');
        
        let countdown = 3;
        countdownEl.textContent = countdown;
        
        const countdownInterval = setInterval(() => {
            countdown--;
            if (countdown > 0) {
                countdownEl.textContent = countdown;
            } else {
                clearInterval(countdownInterval);
                clearInterval(miniCounterInterval);
                
                // Fade out and show final message
                setTimeout(() => {
                    // Create a final farewell overlay
                    const farewellOverlay = document.createElement('div');
                    farewellOverlay.style.cssText = 'position:fixed;inset:0;display:flex;align-items:center;justify-content:center;background:#000;color:#ffd700;font-family:serif;font-size:2rem;text-align:center;letter-spacing:4px;padding:20px;z-index:100002;';
                    farewellOverlay.innerHTML = 'é¡˜ä½ é¤˜ç”Ÿå¹³å®‰<br>Peace Be With You';
                    document.body.appendChild(farewellOverlay);
                    
                    // Try to close if window was opened by script
                    if (window.opener) {
                        setTimeout(() => window.close(), 2000);
                    }
                }, 3000);
            }
        }, 1000);
        
    } else {
        // User says "No" - Enter main site content
        clearInterval(miniCounterInterval);
        entryOverlay.classList.add('fade-out');
        
        // Remove from DOM after transition
        setTimeout(() => {
            entryOverlay.style.display = 'none';
        }, 1500);
    }
}

// Initialize mini counter on load
startMiniCounter();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// é–‹å ´ç‰¹æ•ˆï¼šå¿ƒé›»åœ–ï¼ˆç†’å…‰ç´…/è—/ç¶ ï¼Œ60ç§’æ›è‰²ï¼‰
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const effectCanvas = document.getElementById('opening-effect');
const effectCtx = effectCanvas.getContext('2d');
let effectParticles = [];

// å¿ƒé›»åœ–é¡è‰²ï¼šç†’å…‰ç´…/è—/ç¶ 
const ecgColors = [
    { stroke: 'rgba(255, 50, 50, 0.9)', shadow: '#ff3333', name: 'ç´…' },
    { stroke: 'rgba(50, 150, 255, 0.9)', shadow: '#3399ff', name: 'è—' },
    { stroke: 'rgba(50, 255, 100, 0.9)', shadow: '#33ff66', name: 'ç¶ ' }
];
let ecgColorIndex = 0;
let ecgColorStartTime = Date.now();

function initEffect() {
    effectCanvas.width = window.innerWidth;
    effectCanvas.height = window.innerHeight;
    effectParticles = [];
    initECGEffect();
}

// å¿ƒé›»åœ–
let ecgX = 0;
let ecgHistory = [];
function initECGEffect() {
    ecgX = 0;
    ecgHistory = [];
}

function drawECG() {
    effectCtx.fillStyle = 'rgba(0,0,0,0.05)';
    effectCtx.fillRect(0, 0, effectCanvas.width, effectCanvas.height);

    // æ¯60ç§’æ›è‰²
    if (Date.now() - ecgColorStartTime > 60000) {
        ecgColorIndex = (ecgColorIndex + 1) % ecgColors.length;
        ecgColorStartTime = Date.now();
    }

    const centerY = effectCanvas.height / 2;
    const now = Date.now() / 1000;

    // è¨ˆç®—å¿ƒé›»åœ–å€¼
    let y = centerY;
    const cycle = now % 1.2;
    if (cycle < 0.1) {
        y = centerY;
    } else if (cycle < 0.15) {
        y = centerY - 20;
    } else if (cycle < 0.2) {
        y = centerY + 10;
    } else if (cycle < 0.35) {
        y = centerY - (cycle - 0.2) * 800;
    } else if (cycle < 0.5) {
        y = centerY + (0.5 - cycle) * 800 - 120;
    } else {
        y = centerY;
    }

    ecgHistory.push({ x: ecgX, y: y + (Math.random() - 0.5) * 5 });
    ecgX += 3;

    if (ecgX > effectCanvas.width) {
        ecgX = 0;
        ecgHistory = [];
    }

    // ç¹ªè£½ï¼ˆä½¿ç”¨ç•¶å‰é¡è‰²ï¼‰
    const currentColor = ecgColors[ecgColorIndex];
    effectCtx.strokeStyle = currentColor.stroke;
    effectCtx.lineWidth = 2;
    effectCtx.shadowColor = currentColor.shadow;
    effectCtx.shadowBlur = 15;
    effectCtx.beginPath();

    ecgHistory.forEach((p, i) => {
        if (i === 0) effectCtx.moveTo(p.x, p.y);
        else effectCtx.lineTo(p.x, p.y);
    });
    effectCtx.stroke();
    effectCtx.shadowBlur = 0;
}

// åªä½¿ç”¨å¿ƒé›»åœ–æ•ˆæœï¼Œå·²ç§»é™¤è Ÿç‡­/æ°´æ³¢ç´‹/æ•¸ç¢¼é›¨/æ˜Ÿå¡µ
function animateEffect() {
    drawECG();
    if (document.getElementById('opening-overlay').style.display !== 'none') {
        requestAnimationFrame(animateEffect);
    }
}

initEffect();
animateEffect();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// é–‹å ´ï¼šéš¨æ©Ÿå“²ç†èªå¥
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const openingMessages = [
    {
        main: "åªè¦ï¼Œä¸€æ¯å°šå­˜ï¼Œè¬äº‹å¯æœŸ<br>è‹¥ç„¶ï¼Œä¸€æ¯å·²æ–·ï¼Œè¬äº‹çš†ç©º",
        sub: "æ¯ä¸€å¤©é†’ä¾†ï¼Œéƒ½æ˜¯å€Ÿä¾†çš„æ™‚é–“<br>ä½ æ‰“ç®—æ€æ¨£ä½¿ç”¨ï¼Ÿ",
        verse: "ä½ å€‘è¦è¬¹æ…è¡Œäº‹ï¼Œä¸è¦åƒæ„šæ˜§äººï¼Œç•¶åƒæ™ºæ…§äººã€‚è¦æ„›æƒœå…‰é™°ï¼Œå› ç‚ºç¾ä»Šçš„ä¸–ä»£é‚ªæƒ¡ã€‚",
        ref: "â€” ä»¥å¼—æ‰€æ›¸ 5:15-16"
    },
    {
        main: "äººï¼Œæœ‰å¤šå°‘å¤©ï¼Ÿ<br>å¯æ­æ™ºæ…§äººæ­»äº¡ï¼Œèˆ‡æ„šæ˜§äººç„¡ç•°",
        sub: "ä½ è¨ˆåŠƒäº†æ˜å¤©ï¼Œå»ä¸çŸ¥é“æ˜å¤©æœƒä¸æœƒä¾†<br>ä½ è¿½æ±‚æˆåŠŸï¼Œå»å¯èƒ½åœ¨æˆåŠŸå‰é›¢é–‹",
        verse: "å…¶å¯¦æ˜å¤©å¦‚ä½•ï¼Œä½ å€‘é‚„ä¸çŸ¥é“ã€‚ä½ å€‘çš„ç”Ÿå‘½æ˜¯ç”šéº¼å‘¢ï¼Ÿä½ å€‘åŸä¾†æ˜¯ä¸€ç‰‡é›²éœ§ï¼Œå‡ºç¾å°‘æ™‚å°±ä¸è¦‹äº†ã€‚",
        ref: "â€” é›…å„æ›¸ 4:14"
    },
    {
        main: "ä½ è¦ä¿å®ˆä½ å¿ƒï¼Œå‹éä¿å®ˆä¸€åˆ‡<br>å› ç‚ºä¸€ç”Ÿçš„æœæ•ˆæ˜¯ç”±å¿ƒç™¼å‡º",
        sub: "ä½ è¿½æ±‚çš„ä¸€åˆ‡<br>æˆ¿å­ã€è»Šå­ã€åœ°ä½ã€åè²<br>æ­»å¾Œèƒ½å¸¶èµ°ä»€éº¼ï¼Ÿ",
        verse: "äººé‚„èƒ½æ‹¿ç”šéº¼æ›ç”Ÿå‘½å‘¢ï¼Ÿ",
        ref: "â€” é¦¬å¤ªç¦éŸ³ 16:26"
    },
    {
        main: "æˆ‘å€‘ä¸€ç”Ÿçš„å¹´æ—¥æ˜¯ä¸ƒåæ­²<br>è‹¥æ˜¯å¼·å£¯å¯åˆ°å…«åæ­²<br>ä½†å…¶ä¸­æ‰€çŸœèª‡çš„ä¸éæ˜¯å‹è‹¦æ„ç…©",
        sub: "è½‰çœ¼æˆç©ºï¼Œæˆ‘å€‘ä¾¿å¦‚é£›è€Œå»<br>ä½ å¯ä»¥æ§åˆ¶å¾ˆå¤šäº‹<br>ä½†ä½ ç„¡æ³•æ§åˆ¶ä»€éº¼æ™‚å€™é›¢é–‹é€™å€‹ä¸–ç•Œ",
        verse: "ç„¡äººæœ‰æ¬ŠåŠ›æŒç®¡ç”Ÿå‘½ï¼Œå°‡ç”Ÿå‘½ç•™ä½ï¼›ä¹Ÿç„¡äººæœ‰æ¬ŠåŠ›æŒç®¡æ­»æœŸã€‚é€™å ´çˆ­æˆ°ï¼Œç„¡äººèƒ½å…ã€‚",
        ref: "â€” å‚³é“æ›¸ 8:8"
    },
    {
        main: "ä½ ä½¿æˆ‘çš„å¹´æ—¥çª„å¦‚æ‰‹æŒ<br>æˆ‘ä¸€ç”Ÿçš„å¹´æ•¸ï¼Œåœ¨ä½ é¢å‰å¦‚åŒç„¡æœ‰",
        sub: "å„äººæœ€ç©©å¦¥çš„æ™‚å€™ï¼ŒçœŸæ˜¯å…¨ç„¶è™›å¹»<br>ä»Šå¤©çš„æ–°èæ˜¯åˆ¥äººï¼Œæ˜å¤©å¯èƒ½æ˜¯ä½ ",
        verse: "æŒ‰è‘—å®šå‘½ï¼Œäººäººéƒ½æœ‰ä¸€æ­»ï¼Œæ­»å¾Œä¸”æœ‰å¯©åˆ¤ã€‚",
        ref: "â€” å¸Œä¼¯ä¾†æ›¸ 9:27"
    },
    {
        main: "ç”Ÿæ­»ï¼Œåˆ°åº•æ˜¯ç”šéº¼ï¼Ÿ<br>å¾ä½•è€Œä¾†ï¼Œå¾€é‚£è€Œå»ï¼Ÿ",
        sub: "ä¸€ä»£éå»ï¼Œä¸€ä»£åˆä¾†ï¼Œåœ°å»æ°¸é é•·å­˜<br>æ™‚é–“å¯æ·¡å¿˜ä¸€åˆ‡ï¼Œä¹ŸåŒ…æ‹¬ä½ å’Œæˆ‘",
        verse: "å› ç‚ºç”Ÿè€…éƒ½å¿…å¾€é‚£è£¡å»ï¼Œæ­»è€…å»ä¸èƒ½å›åˆ°é€™è£¡ä¾†ã€‚",
        ref: "â€” å‚³é“æ›¸"
    },
    {
        main: "æ­»äº¡ï¼Œæ­£éœæ‚„æ‚„åœ°<br>åœ¨æ™‚ä»£å·¨è¼ªè£¡ä¸æ–·åŠ é€Ÿ",
        sub: "ç›¸ä¿¡æ­»äº¡ï¼Œå°‡æ˜¯å»è€Œä¸è¿”çš„è·¯<br>éƒ½æ‡‰ç•¶è¢«ç•æ‡¼",
        verse: "æ‡·è‘—æ‚²å‚·èˆ‡æ•¬ç•çš„å¿ƒï¼Œéœé»˜åœ°è¨˜éŒ„ã€‚é¡˜é€è€…å®‰æ¯ï¼Œé¡˜ç”Ÿè€…æ¯æ‡·ã€‚",
        ref: ""
    }
];

// å¾ localStorage ç²å–å·²é¡¯ç¤ºçš„ç´¢å¼•ï¼Œç¢ºä¿ä¸é‡è¤‡
function getNextOpening() {
    let shown = JSON.parse(localStorage.getItem('shownOpenings') || '[]');

    if (shown.length >= openingMessages.length) {
        shown = [];
    }

    const available = [];
    for (let i = 0; i < openingMessages.length; i++) {
        if (!shown.includes(i)) {
            available.push(i);
        }
    }

    const index = available[Math.floor(Math.random() * available.length)];
    shown.push(index);
    localStorage.setItem('shownOpenings', JSON.stringify(shown));

    return openingMessages[index];
}

// é¡¯ç¤ºé–‹å ´
const opening = getNextOpening();
document.getElementById('opening-main').innerHTML = opening.main;
document.getElementById('opening-sub').innerHTML = opening.sub;
if (opening.ref) {
    document.getElementById('opening-verse').innerHTML = `${opening.verse}<span class="opening-ref">${opening.ref}</span>`;
} else {
    document.getElementById('opening-verse').innerHTML = opening.verse;
}

// é»æ“Šé€²å…¥
document.getElementById('opening-overlay').addEventListener('click', function() {
    this.classList.add('fade-out');
    setTimeout(() => this.style.display = 'none', 2000);
    startDeathCounter();
});

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// æ­»äº¡åŒæ­¥è¨ˆæ•¸å™¨
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let entryTime = null;
const DEATHS_PER_SECOND = 1.8; // WHO ä¼°ç®—ï¼šæ¯å¹´ç´„ 5680 è¬äººæ­»äº¡ Ã· 31536000 ç§’ â‰ˆ 1.8

function startDeathCounter() {
    entryTime = Date.now();
    updateDeathCounter();
    setInterval(updateDeathCounter, 500);
}

function updateDeathCounter() {
    if (!entryTime) return;

    const elapsed = (Date.now() - entryTime) / 1000;
    const deathsSinceEntry = Math.floor(elapsed * DEATHS_PER_SECOND);

    // ä»Šæ—¥æ­»äº¡ä¼°ç®—
    const now = new Date();
    const startOfDay = new Date(now.getFullYear(), now.getMonth(), now.getDate());
    const secondsToday = (now - startOfDay) / 1000;
    const deathsToday = Math.floor(secondsToday * DEATHS_PER_SECOND);

    document.getElementById('death-since-entry').textContent = deathsSinceEntry.toLocaleString();
    document.getElementById('death-today').textContent = deathsToday.toLocaleString();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// ã€Œå¦‚æœæ˜¯ä½ ã€æ²‰æµ¸æ¨¡å¼
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let currentStage = 1;

function startImmersive() {
    currentStage = 1;
    document.getElementById('immersive-overlay').classList.add('active');
    showStage(1);
}

function closeImmersive() {
    document.getElementById('immersive-overlay').classList.remove('active');
    document.querySelectorAll('.immersive-stage').forEach(s => s.classList.remove('active'));
}

function nextStage(num) {
    showStage(num);
}

function showStage(num) {
    document.querySelectorAll('.immersive-stage').forEach(s => s.classList.remove('active'));
    const stage = document.getElementById('stage-' + num);
    if (stage) {
        stage.classList.add('active');
    }
}

function selectBelief(belief) {
    showStage(belief);
}

// Toggle counter on mobile
function toggleCounter() {
    const counter = document.getElementById('death-counter');
    const toggle = document.querySelector('.counter-toggle');
    counter.classList.toggle('collapsed');
    if (counter.classList.contains('collapsed')) {
        toggle.textContent = 'â–¼';
        toggle.setAttribute('aria-label', 'å±•é–‹æ­»äº¡è¨ˆæ•¸å™¨');
        toggle.setAttribute('aria-expanded', 'false');
    } else {
        toggle.textContent = 'â–²';
        toggle.setAttribute('aria-label', 'æ”¶åˆæ­»äº¡è¨ˆæ•¸å™¨');
        toggle.setAttribute('aria-expanded', 'true');
    }
}

// Return to portal from video stage
function returnToPortal() {
    closeImmersive();
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

// Language switching system
let currentLang = 'zh-TW';

// Translation dictionary for key UI elements (button text)
const buttonTranslations = {
    'zh-TW': {
        'continue': 'ç¹¼ çºŒ',
        'back': 'è¿” å›',
        'amen': 'é˜¿ å€‘',
        'learnMore': 'æˆ‘æƒ³çŸ¥é“æ›´å¤š',
        'thinkMore': 'è®“æˆ‘å†æƒ³æƒ³',
        'accept': 'æˆ‘æƒ³æ¥å—',
        'returnPortal': 'è¿”å›ä¸»é ',
        'restartExplore': 'é‡æ–°æ¢ç´¢'
    },
    'zh-CN': {
        'continue': 'ç»§ ç»­',
        'back': 'è¿” å›',
        'amen': 'é˜¿ ä»¬',
        'learnMore': 'æˆ‘æƒ³çŸ¥é“æ›´å¤š',
        'thinkMore': 'è®©æˆ‘å†æƒ³æƒ³',
        'accept': 'æˆ‘æƒ³æ¥å—',
        'returnPortal': 'è¿”å›ä¸»é¡µ',
        'restartExplore': 'é‡æ–°æ¢ç´¢'
    },
    'en': {
        'continue': 'Continue',
        'back': 'Back',
        'amen': 'Amen',
        'learnMore': 'I want to learn more',
        'thinkMore': 'Let me think',
        'accept': 'I want to accept',
        'returnPortal': 'Return to Portal',
        'restartExplore': 'Restart Exploration'
    }
};

function switchLanguage(lang) {
    currentLang = lang;
    
    // Update button states
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-lang-switch') === lang) {
            btn.classList.add('active');
        }
    });
    
    // Hide all lang elements
    document.querySelectorAll('[data-lang]').forEach(el => {
        el.classList.remove('active');
    });
    
    // Show selected lang elements
    document.querySelectorAll(`[data-lang="${lang}"]`).forEach(el => {
        el.classList.add('active');
    });
    
    // Update button text using data-i18n attributes
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (buttonTranslations[lang] && buttonTranslations[lang][key]) {
            el.textContent = buttonTranslations[lang][key];
        }
    });
    
    // Store preference
    localStorage.setItem('preferred-lang', lang);
}

// Load saved language preference
document.addEventListener('DOMContentLoaded', function() {
    const savedLang = localStorage.getItem('preferred-lang');
    if (savedLang && ['zh-TW', 'zh-CN', 'en'].includes(savedLang)) {
        switchLanguage(savedLang);
    }
    
    // Initialize collapsed counter on mobile
    if (window.innerWidth <= 600) {
        document.getElementById('death-counter')?.classList.add('collapsed');
    }
});

// Handle window resize for mobile counter
window.addEventListener('resize', function() {
    const counter = document.getElementById('death-counter');
    if (!counter) return;
    
    if (window.innerWidth <= 600 && !counter.classList.contains('collapsed')) {
        counter.classList.add('collapsed');
    } else if (window.innerWidth > 600 && counter.classList.contains('collapsed')) {
        counter.classList.remove('collapsed');
    }
});

// Reduce particle count on mobile or when reduced motion preferred
const isReducedMotion = window.matchMedia('(prefers-reduced-motion: reduce)').matches;
const isMobile = window.innerWidth <= 768;

if (isReducedMotion || isMobile) {
    // This will be used in particle initialization below
    window.particleReductionFactor = isReducedMotion ? 0.3 : (isMobile ? 0.5 : 1);
    window.particleReductionFactor = isReducedMotion ? 0.24 : (isMobile ? 0.4 : 1);
}

</script>


<script>
/**
 * Iframe å…ƒç´ é«˜äº®æ³¨å…¥è„šæœ¬
 * éœ€è¦åœ¨ç›®æ ‡ç½‘ç«™ä¸­å¼•å…¥æ­¤è„šæœ¬æ¥æ”¯æŒè·¨åŸŸ iframe é«˜äº®åŠŸèƒ½
 *
 * ä½¿ç”¨æ–¹æ³•ï¼š
 * 1. å°†æ­¤è„šæœ¬æ·»åŠ åˆ°ç›®æ ‡ç½‘ç«™çš„ HTML ä¸­
 * 2. æˆ–é€šè¿‡æµè§ˆå™¨æ‰©å±•ã€ç”¨æˆ·è„šæœ¬ç­‰æ–¹å¼æ³¨å…¥
 */

(function () {
  "use strict";

  // æ£€æŸ¥æ˜¯å¦åœ¨ iframe ä¸­
  if (window.self === window.top) {
    return; // ä¸åœ¨ iframe ä¸­ï¼Œä¸æ‰§è¡Œ
  }

  // æ£€æŸ¥æ˜¯å¦å·²ç»åˆå§‹åŒ–è¿‡
  if (window.__iframeHighlightInitialized) {
    return;
  }
  window.__iframeHighlightInitialized = true;
  console.log("Iframe é«˜äº®è„šæœ¬å·²åŠ è½½");

  // åˆ›å»ºé«˜äº®è¦†ç›–å±‚
  var overlay = document.createElement("div");
  overlay.id = "iframe-highlight-overlay";
  overlay.style.cssText = "\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    pointer-events: none;\n    z-index: 999999;\n    overflow: hidden;\n  ";

  // åˆ›å»ºæ‚¬åœé«˜äº®æ¡†ï¼ˆè™šçº¿è¾¹æ¡†ï¼‰
  var highlightBox = document.createElement("div");
  highlightBox.id = "iframe-highlight-box";
  highlightBox.style.cssText = "\n    position: absolute;\n    border: 2px dashed #007AFF;\n    background: rgba(0, 122, 255, 0.08);\n    pointer-events: none;\n    display: none;\n    transition: all 0.1s ease;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);\n    border-radius: 2px;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹çš„å¸¸é©»é«˜äº®æ¡†ï¼ˆå®çº¿è¾¹æ¡†ï¼‰
  var selectedBox = document.createElement("div");
  selectedBox.id = "iframe-selected-box";
  selectedBox.style.cssText = "\n    position: absolute;\n    border: 2px solid #007AFF;\n    pointer-events: none;\n    display: none;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 107, 53, 0.4);\n    border-radius: 2px;\n    z-index: 1000000;\n  ";

  // åˆ›å»ºæ‚¬åœæ ‡ç­¾æ˜¾ç¤º
  var tagLabel = document.createElement("div");
  tagLabel.id = "iframe-tag-label";
  tagLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 2px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000001;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    font-weight: 500;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹æ ‡ç­¾
  var selectedLabel = document.createElement("div");
  selectedLabel.id = "iframe-selected-label";
  selectedLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 3px 8px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 3px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000002;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);\n    font-weight: 600;\n  ";
  overlay.appendChild(highlightBox);
  overlay.appendChild(selectedBox);
  overlay.appendChild(tagLabel);
  overlay.appendChild(selectedLabel);
  document.body.appendChild(overlay);

  // å­˜å‚¨å½“å‰é€‰ä¸­çš„å…ƒç´ 
  var selectedElement = null;
  var highlightEnabled = false;

  // æ›´æ–°é€‰ä¸­å…ƒç´ çš„é«˜äº®æ˜¾ç¤º
  function updateSelectedHighlight(element) {
    console.log("updateSelectedHighlight called with:", element);
    if (!element) {
      selectedBox.style.display = "none";
      selectedLabel.style.display = "none";
      selectedElement = null;
      console.log("Cleared selected highlight");
      return;
    }
    selectedElement = element;
    var rect = element.getBoundingClientRect();
    console.log("Selected element rect:", rect);

    // æ›´æ–°é€‰ä¸­é«˜äº®æ¡†ä½ç½®
    selectedBox.style.display = "block";
    selectedBox.style.left = "".concat(rect.left - 2, "px");
    selectedBox.style.top = "".concat(rect.top - 2, "px");
    selectedBox.style.width = "".concat(rect.width + 4, "px");
    selectedBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°é€‰ä¸­æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    selectedLabel.style.display = "block";
    selectedLabel.textContent = "\u2713 <".concat(element.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 28;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 5) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    var labelWidth = selectedLabel.offsetWidth || 100; // é¢„ä¼°å®½åº¦
    if (labelLeft + labelWidth > window.innerWidth - 10) {
      labelLeft = window.innerWidth - labelWidth - 10;
    }
    selectedLabel.style.left = "".concat(Math.max(5, labelLeft), "px");
    selectedLabel.style.top = "".concat(labelTop, "px");
    console.log("Selected highlight positioned at:", {
      left: selectedBox.style.left,
      top: selectedBox.style.top,
      width: selectedBox.style.width,
      height: selectedBox.style.height
    });
  }
  function getElementSelector(element) {
    if (!(element instanceof Element)) throw new Error('Argument must be a DOM element');
    var segments = [];
    var current = element;
    while (current !== document.documentElement) {
      var selector = '';
      // ä¼˜å…ˆæ£€æŸ¥å”¯ä¸€ID
      if (current.id && document.querySelectorAll("#".concat(current.id)).length === 1) {
        segments.unshift("#".concat(current.id));
        break; // IDå”¯ä¸€ï¼Œæ— éœ€ç»§ç»­å‘ä¸Š
      }

      // ç”Ÿæˆç±»åé€‰æ‹©å™¨ï¼ˆå–ç¬¬ä¸€ä¸ªæœ‰æ•ˆç±»åï¼‰
      var classes = Array.from(current.classList).filter(function (c) {
        return !c.startsWith('js-');
      });
      var className = classes.length > 0 ? ".".concat(classes[0]) : '';

      // ç”Ÿæˆä½ç½®ç´¢å¼•ï¼ˆnth-childï¼‰
      var tag = current.tagName.toLowerCase();
      if (!className) {
        var siblings = Array.from(current.parentNode.children);
        var index = siblings.findIndex(function (el) {
          return el === current;
        }) + 1;
        selector = "".concat(tag, ":nth-child(").concat(index, ")");
      } else {
        selector = className;
      }
      segments.unshift(selector);
      current = current.parentElement;
    }

    // å¤„ç†æ ¹å…ƒç´ 
    if (current === document.documentElement) {
      segments.unshift('html');
    }
    return segments.join(' > ');
  }

  // è·å–å…ƒç´ æ–‡æœ¬å†…å®¹
  function getElementText(element) {
    var _element$textContent;
    if (element.tagName === "INPUT") {
      return element.value || element.placeholder || "";
    }
    if (element.tagName === "TEXTAREA") {
      return element.value || element.placeholder || "";
    }
    var text = ((_element$textContent = element.textContent) === null || _element$textContent === void 0 ? void 0 : _element$textContent.trim()) || "";
    return text.length > 50 ? text.substring(0, 50) + "..." : text;
  }

  // è·å–å…ƒç´ å±æ€§ä¿¡æ¯
  function getElementAttributes(element) {
    var attrs = {};
    for (var i = 0; i < element.attributes.length; i++) {
      var attr = element.attributes[i];
      attrs[attr.name] = attr.value;
    }
    return attrs;
  }

  // é¼ æ ‡æ‚¬åœäº‹ä»¶å¤„ç†
  function handleMouseOver(e) {
    if (!highlightEnabled) return;
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…é«˜äº® html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // å¦‚æœæ˜¯å·²é€‰ä¸­çš„å…ƒç´ ï¼Œä¸æ˜¾ç¤ºæ‚¬åœé«˜äº®
    if (target === selectedElement) {
      highlightBox.style.display = "none";
      tagLabel.style.display = "none";
      return;
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);

    // æ›´æ–°æ‚¬åœé«˜äº®æ¡†ä½ç½®
    highlightBox.style.display = "block";
    highlightBox.style.left = "".concat(rect.left - 2, "px");
    highlightBox.style.top = "".concat(rect.top - 2, "px");
    highlightBox.style.width = "".concat(rect.width + 4, "px");
    highlightBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    tagLabel.style.display = "block";
    tagLabel.textContent = "<".concat(target.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 22;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 0) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    if (labelLeft + tagLabel.offsetWidth > window.innerWidth) {
      labelLeft = window.innerWidth - tagLabel.offsetWidth - 5;
    }
    tagLabel.style.left = "".concat(Math.max(0, labelLeft), "px");
    tagLabel.style.top = "".concat(labelTop, "px");

    // å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // é¼ æ ‡ç¦»å¼€äº‹ä»¶å¤„ç†
  function handleMouseOut(e) {
    if (!highlightEnabled) return;
    var relatedTarget = e.relatedTarget;

    // å¦‚æœé¼ æ ‡ç§»åŠ¨åˆ°é«˜äº®ç›¸å…³å…ƒç´ ä¸Šï¼Œä¸éšè—é«˜äº®
    if (relatedTarget && (relatedTarget === highlightBox || relatedTarget === tagLabel || relatedTarget === overlay || relatedTarget === selectedBox || relatedTarget === selectedLabel)) {
      return;
    }
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: null,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç‚¹å‡»äº‹ä»¶å¤„ç†
  function handleClick(e) {
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…å¤„ç† html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // æ£€æŸ¥æ˜¯å¦æ˜¯äº¤äº’å…ƒç´ ï¼Œè¿™äº›å…ƒç´ éœ€è¦ä¿ç•™é»˜è®¤è¡Œä¸º
    var isInteractiveElement = ['input', 'textarea', 'select', 'button', 'a'].includes(target.tagName.toLowerCase());

    // å¦‚æœé«˜äº®åŠŸèƒ½å¯ç”¨ï¼Œå¯¹äºéäº¤äº’å…ƒç´ é˜»æ­¢é»˜è®¤è¡Œä¸ºå’Œäº‹ä»¶ä¼ æ’­
    if (highlightEnabled) {
      e.preventDefault();
      e.stopPropagation();
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);
    console.log("Element clicked:", {
      tagName: target.tagName,
      selector: selector,
      rect: rect
    });

    // ç«‹å³æ›´æ–°é€‰ä¸­é«˜äº®
    updateSelectedHighlight(target);

    // éšè—æ‚¬åœé«˜äº®ï¼Œå› ä¸ºç°åœ¨æ˜¯é€‰ä¸­çŠ¶æ€
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-click",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç›‘å¬æ¥è‡ªçˆ¶çª—å£çš„æ¶ˆæ¯
  function handleParentMessage(event) {
    console.log("Received message from parent:", event.data);
    if (event.data.type === "iframe-highlight-toggle") {
      var enabled = event.data.enabled;
      console.log("Highlight toggle:", enabled);
      if (enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "enable-iframe-highlight") {
      console.log("Enable iframe highlight");
      enableHighlight();
    } else if (event.data.type === "disable-iframe-highlight") {
      console.log("Disable iframe highlight");
      disableHighlight();
    } else if (event.data.type === "toggle-iframe-highlight") {
      var _enabled = event.data.enabled !== undefined ? event.data.enabled : !highlightEnabled;
      console.log("Toggle iframe highlight to:", _enabled);
      if (_enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "update-selected-element") {
      var selector = event.data.selector;
      console.log("Update selected element with selector:", selector);
      if (selector) {
        try {
          var element = document.querySelector(selector);
          console.log("Found element by selector:", element);
          updateSelectedHighlight(element);
        } catch (error) {
          console.warn("Failed to select element:", error);
          updateSelectedHighlight(null);
        }
      } else {
        updateSelectedHighlight(null);
      }
    } else if (event.data.type === "clear-selected-element") {
      console.log("Clear selected element");
      updateSelectedHighlight(null);
    }
  }

  // å¯ç”¨é«˜äº®åŠŸèƒ½
  function enableHighlight() {
    console.log("Enabling highlight");
    document.addEventListener("mouseover", handleMouseOver, true);
    document.addEventListener("mouseout", handleMouseOut, true);
    document.addEventListener("click", handleClick, true);
    highlightEnabled = true;
    overlay.style.display = "block";
  }

  // ç¦ç”¨é«˜äº®åŠŸèƒ½
  function disableHighlight() {
    console.log("Disabling highlight");
    highlightEnabled = false;
    // ä¿æŒäº‹ä»¶ç›‘å¬å™¨ï¼Œä½†é€šè¿‡ highlightEnabled å˜é‡æ§åˆ¶è¡Œä¸º
    // è¿™æ ·å¯ä»¥ä¿ç•™é€‰ä¸­çŠ¶æ€çš„æ˜¾ç¤º
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    // ä¸éšè— selectedBox å’Œ selectedLabelï¼Œä¿ç•™é€‰ä¸­çŠ¶æ€
  }

  // å®Œå…¨ç¦ç”¨é«˜äº®åŠŸèƒ½ï¼ˆç§»é™¤æ‰€æœ‰ç›‘å¬å™¨ï¼‰
  function fullyDisableHighlight() {
    console.log("Fully disabling highlight");
    highlightEnabled = false;
    document.removeEventListener("mouseover", handleMouseOver, true);
    document.removeEventListener("mouseout", handleMouseOut, true);
    document.removeEventListener("click", handleClick, true);
    overlay.style.display = "none";
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    selectedBox.style.display = "none";
    selectedLabel.style.display = "none";
  }

  // æ·»åŠ äº‹ä»¶ç›‘å¬
  enableHighlight();
  window.addEventListener("message", handleParentMessage);

  // æš´éœ²å…¨å±€å‡½æ•°ä¾›å¤–éƒ¨è°ƒç”¨
  window.__iframeHighlightControl = {
    enable: enableHighlight,
    disable: disableHighlight,
    fullyDisable: fullyDisableHighlight,
    isEnabled: function isEnabled() {
      return highlightEnabled;
    },
    getSelectedElement: function getSelectedElement() {
      return selectedElement;
    },
    updateSelected: updateSelectedHighlight,
    // é€šè¿‡æ¶ˆæ¯å‘é€å¼€å…³æ§åˆ¶
    sendToggleMessage: function sendToggleMessage(enabled) {
      window.parent.postMessage({
        type: 'iframe-highlight-status',
        enabled: enabled || highlightEnabled,
        source: 'iframe-highlight-injector'
      }, '*');
    }
  };

  // é€šçŸ¥çˆ¶çª—å£è„šæœ¬å·²åŠ è½½
  try {
    window.parent.postMessage({
      type: "iframe-highlight-ready",
      data: {
        url: window.location.href,
        userAgent: navigator.userAgent,
        timestamp: Date.now()
      },
      source: "iframe-highlight-injector"
    }, "*");
  } catch (error) {
    console.warn("æ— æ³•å‘é€å°±ç»ªæ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
  }

  // æ¸…ç†å‡½æ•°
  window.__iframeHighlightCleanup = function () {
    fullyDisableHighlight();
    window.removeEventListener("message", handleParentMessage);
    if (overlay.parentElement) {
      overlay.parentElement.removeChild(overlay);
    }
    delete window.__iframeHighlightInitialized;
    delete window.__iframeHighlightCleanup;
  };
})();

</script>

<script>
/**
 * Iframe å…ƒç´ é«˜äº®æ³¨å…¥è„šæœ¬
 * éœ€è¦åœ¨ç›®æ ‡ç½‘ç«™ä¸­å¼•å…¥æ­¤è„šæœ¬æ¥æ”¯æŒè·¨åŸŸ iframe é«˜äº®åŠŸèƒ½
 *
 * ä½¿ç”¨æ–¹æ³•ï¼š
 * 1. å°†æ­¤è„šæœ¬æ·»åŠ åˆ°ç›®æ ‡ç½‘ç«™çš„ HTML ä¸­
 * 2. æˆ–é€šè¿‡æµè§ˆå™¨æ‰©å±•ã€ç”¨æˆ·è„šæœ¬ç­‰æ–¹å¼æ³¨å…¥
 */

(function () {
  "use strict";

  // æ£€æŸ¥æ˜¯å¦åœ¨ iframe ä¸­
  if (window.self === window.top) {
    return; // ä¸åœ¨ iframe ä¸­ï¼Œä¸æ‰§è¡Œ
  }

  // æ£€æŸ¥æ˜¯å¦å·²ç»åˆå§‹åŒ–è¿‡
  if (window.__iframeHighlightInitialized) {
    return;
  }
  window.__iframeHighlightInitialized = true;
  console.log("Iframe é«˜äº®è„šæœ¬å·²åŠ è½½");

  // åˆ›å»ºé«˜äº®è¦†ç›–å±‚
  var overlay = document.createElement("div");
  overlay.id = "iframe-highlight-overlay";
  overlay.style.cssText = "\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    pointer-events: none;\n    z-index: 999999;\n    overflow: hidden;\n  ";

  // åˆ›å»ºæ‚¬åœé«˜äº®æ¡†ï¼ˆè™šçº¿è¾¹æ¡†ï¼‰
  var highlightBox = document.createElement("div");
  highlightBox.id = "iframe-highlight-box";
  highlightBox.style.cssText = "\n    position: absolute;\n    border: 2px dashed #007AFF;\n    background: rgba(0, 122, 255, 0.08);\n    pointer-events: none;\n    display: none;\n    transition: all 0.1s ease;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);\n    border-radius: 2px;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹çš„å¸¸é©»é«˜äº®æ¡†ï¼ˆå®çº¿è¾¹æ¡†ï¼‰
  var selectedBox = document.createElement("div");
  selectedBox.id = "iframe-selected-box";
  selectedBox.style.cssText = "\n    position: absolute;\n    border: 2px solid #007AFF;\n    pointer-events: none;\n    display: none;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 107, 53, 0.4);\n    border-radius: 2px;\n    z-index: 1000000;\n  ";

  // åˆ›å»ºæ‚¬åœæ ‡ç­¾æ˜¾ç¤º
  var tagLabel = document.createElement("div");
  tagLabel.id = "iframe-tag-label";
  tagLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 2px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000001;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    font-weight: 500;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹æ ‡ç­¾
  var selectedLabel = document.createElement("div");
  selectedLabel.id = "iframe-selected-label";
  selectedLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 3px 8px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 3px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000002;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);\n    font-weight: 600;\n  ";
  overlay.appendChild(highlightBox);
  overlay.appendChild(selectedBox);
  overlay.appendChild(tagLabel);
  overlay.appendChild(selectedLabel);
  document.body.appendChild(overlay);

  // å­˜å‚¨å½“å‰é€‰ä¸­çš„å…ƒç´ 
  var selectedElement = null;
  var highlightEnabled = false;

  // æ›´æ–°é€‰ä¸­å…ƒç´ çš„é«˜äº®æ˜¾ç¤º
  function updateSelectedHighlight(element) {
    console.log("updateSelectedHighlight called with:", element);
    if (!element) {
      selectedBox.style.display = "none";
      selectedLabel.style.display = "none";
      selectedElement = null;
      console.log("Cleared selected highlight");
      return;
    }
    selectedElement = element;
    var rect = element.getBoundingClientRect();
    console.log("Selected element rect:", rect);

    // æ›´æ–°é€‰ä¸­é«˜äº®æ¡†ä½ç½®
    selectedBox.style.display = "block";
    selectedBox.style.left = "".concat(rect.left - 2, "px");
    selectedBox.style.top = "".concat(rect.top - 2, "px");
    selectedBox.style.width = "".concat(rect.width + 4, "px");
    selectedBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°é€‰ä¸­æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    selectedLabel.style.display = "block";
    selectedLabel.textContent = "\u2713 <".concat(element.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 28;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 5) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    var labelWidth = selectedLabel.offsetWidth || 100; // é¢„ä¼°å®½åº¦
    if (labelLeft + labelWidth > window.innerWidth - 10) {
      labelLeft = window.innerWidth - labelWidth - 10;
    }
    selectedLabel.style.left = "".concat(Math.max(5, labelLeft), "px");
    selectedLabel.style.top = "".concat(labelTop, "px");
    console.log("Selected highlight positioned at:", {
      left: selectedBox.style.left,
      top: selectedBox.style.top,
      width: selectedBox.style.width,
      height: selectedBox.style.height
    });
  }
  function getElementSelector(element) {
    if (!(element instanceof Element)) throw new Error('Argument must be a DOM element');
    var segments = [];
    var current = element;
    while (current !== document.documentElement) {
      var selector = '';
      // ä¼˜å…ˆæ£€æŸ¥å”¯ä¸€ID
      if (current.id && document.querySelectorAll("#".concat(current.id)).length === 1) {
        segments.unshift("#".concat(current.id));
        break; // IDå”¯ä¸€ï¼Œæ— éœ€ç»§ç»­å‘ä¸Š
      }

      // ç”Ÿæˆç±»åé€‰æ‹©å™¨ï¼ˆå–ç¬¬ä¸€ä¸ªæœ‰æ•ˆç±»åï¼‰
      var classes = Array.from(current.classList).filter(function (c) {
        return !c.startsWith('js-');
      });
      var className = classes.length > 0 ? ".".concat(classes[0]) : '';

      // ç”Ÿæˆä½ç½®ç´¢å¼•ï¼ˆnth-childï¼‰
      var tag = current.tagName.toLowerCase();
      if (!className) {
        var siblings = Array.from(current.parentNode.children);
        var index = siblings.findIndex(function (el) {
          return el === current;
        }) + 1;
        selector = "".concat(tag, ":nth-child(").concat(index, ")");
      } else {
        selector = className;
      }
      segments.unshift(selector);
      current = current.parentElement;
    }

    // å¤„ç†æ ¹å…ƒç´ 
    if (current === document.documentElement) {
      segments.unshift('html');
    }
    return segments.join(' > ');
  }

  // è·å–å…ƒç´ æ–‡æœ¬å†…å®¹
  function getElementText(element) {
    var _element$textContent;
    if (element.tagName === "INPUT") {
      return element.value || element.placeholder || "";
    }
    if (element.tagName === "TEXTAREA") {
      return element.value || element.placeholder || "";
    }
    var text = ((_element$textContent = element.textContent) === null || _element$textContent === void 0 ? void 0 : _element$textContent.trim()) || "";
    return text.length > 50 ? text.substring(0, 50) + "..." : text;
  }

  // è·å–å…ƒç´ å±æ€§ä¿¡æ¯
  function getElementAttributes(element) {
    var attrs = {};
    for (var i = 0; i < element.attributes.length; i++) {
      var attr = element.attributes[i];
      attrs[attr.name] = attr.value;
    }
    return attrs;
  }

  // é¼ æ ‡æ‚¬åœäº‹ä»¶å¤„ç†
  function handleMouseOver(e) {
    if (!highlightEnabled) return;
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…é«˜äº® html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // å¦‚æœæ˜¯å·²é€‰ä¸­çš„å…ƒç´ ï¼Œä¸æ˜¾ç¤ºæ‚¬åœé«˜äº®
    if (target === selectedElement) {
      highlightBox.style.display = "none";
      tagLabel.style.display = "none";
      return;
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);

    // æ›´æ–°æ‚¬åœé«˜äº®æ¡†ä½ç½®
    highlightBox.style.display = "block";
    highlightBox.style.left = "".concat(rect.left - 2, "px");
    highlightBox.style.top = "".concat(rect.top - 2, "px");
    highlightBox.style.width = "".concat(rect.width + 4, "px");
    highlightBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    tagLabel.style.display = "block";
    tagLabel.textContent = "<".concat(target.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 22;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 0) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    if (labelLeft + tagLabel.offsetWidth > window.innerWidth) {
      labelLeft = window.innerWidth - tagLabel.offsetWidth - 5;
    }
    tagLabel.style.left = "".concat(Math.max(0, labelLeft), "px");
    tagLabel.style.top = "".concat(labelTop, "px");

    // å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // é¼ æ ‡ç¦»å¼€äº‹ä»¶å¤„ç†
  function handleMouseOut(e) {
    if (!highlightEnabled) return;
    var relatedTarget = e.relatedTarget;

    // å¦‚æœé¼ æ ‡ç§»åŠ¨åˆ°é«˜äº®ç›¸å…³å…ƒç´ ä¸Šï¼Œä¸éšè—é«˜äº®
    if (relatedTarget && (relatedTarget === highlightBox || relatedTarget === tagLabel || relatedTarget === overlay || relatedTarget === selectedBox || relatedTarget === selectedLabel)) {
      return;
    }
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: null,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç‚¹å‡»äº‹ä»¶å¤„ç†
  function handleClick(e) {
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…å¤„ç† html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // æ£€æŸ¥æ˜¯å¦æ˜¯äº¤äº’å…ƒç´ ï¼Œè¿™äº›å…ƒç´ éœ€è¦ä¿ç•™é»˜è®¤è¡Œä¸º
    var isInteractiveElement = ['input', 'textarea', 'select', 'button', 'a'].includes(target.tagName.toLowerCase());

    // å¦‚æœé«˜äº®åŠŸèƒ½å¯ç”¨ï¼Œå¯¹äºéäº¤äº’å…ƒç´ é˜»æ­¢é»˜è®¤è¡Œä¸ºå’Œäº‹ä»¶ä¼ æ’­
    if (highlightEnabled) {
      e.preventDefault();
      e.stopPropagation();
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);
    console.log("Element clicked:", {
      tagName: target.tagName,
      selector: selector,
      rect: rect
    });

    // ç«‹å³æ›´æ–°é€‰ä¸­é«˜äº®
    updateSelectedHighlight(target);

    // éšè—æ‚¬åœé«˜äº®ï¼Œå› ä¸ºç°åœ¨æ˜¯é€‰ä¸­çŠ¶æ€
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-click",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç›‘å¬æ¥è‡ªçˆ¶çª—å£çš„æ¶ˆæ¯
  function handleParentMessage(event) {
    console.log("Received message from parent:", event.data);
    if (event.data.type === "iframe-highlight-toggle") {
      var enabled = event.data.enabled;
      console.log("Highlight toggle:", enabled);
      if (enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "enable-iframe-highlight") {
      console.log("Enable iframe highlight");
      enableHighlight();
    } else if (event.data.type === "disable-iframe-highlight") {
      console.log("Disable iframe highlight");
      disableHighlight();
    } else if (event.data.type === "toggle-iframe-highlight") {
      var _enabled = event.data.enabled !== undefined ? event.data.enabled : !highlightEnabled;
      console.log("Toggle iframe highlight to:", _enabled);
      if (_enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "update-selected-element") {
      var selector = event.data.selector;
      console.log("Update selected element with selector:", selector);
      if (selector) {
        try {
          var element = document.querySelector(selector);
          console.log("Found element by selector:", element);
          updateSelectedHighlight(element);
        } catch (error) {
          console.warn("Failed to select element:", error);
          updateSelectedHighlight(null);
        }
      } else {
        updateSelectedHighlight(null);
      }
    } else if (event.data.type === "clear-selected-element") {
      console.log("Clear selected element");
      updateSelectedHighlight(null);
    }
  }

  // å¯ç”¨é«˜äº®åŠŸèƒ½
  function enableHighlight() {
    console.log("Enabling highlight");
    document.addEventListener("mouseover", handleMouseOver, true);
    document.addEventListener("mouseout", handleMouseOut, true);
    document.addEventListener("click", handleClick, true);
    highlightEnabled = true;
    overlay.style.display = "block";
  }

  // ç¦ç”¨é«˜äº®åŠŸèƒ½
  function disableHighlight() {
    console.log("Disabling highlight");
    highlightEnabled = false;
    // ä¿æŒäº‹ä»¶ç›‘å¬å™¨ï¼Œä½†é€šè¿‡ highlightEnabled å˜é‡æ§åˆ¶è¡Œä¸º
    // è¿™æ ·å¯ä»¥ä¿ç•™é€‰ä¸­çŠ¶æ€çš„æ˜¾ç¤º
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    // ä¸éšè— selectedBox å’Œ selectedLabelï¼Œä¿ç•™é€‰ä¸­çŠ¶æ€
  }

  // å®Œå…¨ç¦ç”¨é«˜äº®åŠŸèƒ½ï¼ˆç§»é™¤æ‰€æœ‰ç›‘å¬å™¨ï¼‰
  function fullyDisableHighlight() {
    console.log("Fully disabling highlight");
    highlightEnabled = false;
    document.removeEventListener("mouseover", handleMouseOver, true);
    document.removeEventListener("mouseout", handleMouseOut, true);
    document.removeEventListener("click", handleClick, true);
    overlay.style.display = "none";
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    selectedBox.style.display = "none";
    selectedLabel.style.display = "none";
  }

  // æ·»åŠ äº‹ä»¶ç›‘å¬
  enableHighlight();
  window.addEventListener("message", handleParentMessage);

  // æš´éœ²å…¨å±€å‡½æ•°ä¾›å¤–éƒ¨è°ƒç”¨
  window.__iframeHighlightControl = {
    enable: enableHighlight,
    disable: disableHighlight,
    fullyDisable: fullyDisableHighlight,
    isEnabled: function isEnabled() {
      return highlightEnabled;
    },
    getSelectedElement: function getSelectedElement() {
      return selectedElement;
    },
    updateSelected: updateSelectedHighlight,
    // é€šè¿‡æ¶ˆæ¯å‘é€å¼€å…³æ§åˆ¶
    sendToggleMessage: function sendToggleMessage(enabled) {
      window.parent.postMessage({
        type: 'iframe-highlight-status',
        enabled: enabled || highlightEnabled,
        source: 'iframe-highlight-injector'
      }, '*');
    }
  };

  // é€šçŸ¥çˆ¶çª—å£è„šæœ¬å·²åŠ è½½
  try {
    window.parent.postMessage({
      type: "iframe-highlight-ready",
      data: {
        url: window.location.href,
        userAgent: navigator.userAgent,
        timestamp: Date.now()
      },
      source: "iframe-highlight-injector"
    }, "*");
  } catch (error) {
    console.warn("æ— æ³•å‘é€å°±ç»ªæ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
  }

  // æ¸…ç†å‡½æ•°
  window.__iframeHighlightCleanup = function () {
    fullyDisableHighlight();
    window.removeEventListener("message", handleParentMessage);
    if (overlay.parentElement) {
      overlay.parentElement.removeChild(overlay);
    }
    delete window.__iframeHighlightInitialized;
    delete window.__iframeHighlightCleanup;
  };
})();

</script>

<script>
/**
 * Iframe å…ƒç´ é«˜äº®æ³¨å…¥è„šæœ¬
 * éœ€è¦åœ¨ç›®æ ‡ç½‘ç«™ä¸­å¼•å…¥æ­¤è„šæœ¬æ¥æ”¯æŒè·¨åŸŸ iframe é«˜äº®åŠŸèƒ½
 *
 * ä½¿ç”¨æ–¹æ³•ï¼š
 * 1. å°†æ­¤è„šæœ¬æ·»åŠ åˆ°ç›®æ ‡ç½‘ç«™çš„ HTML ä¸­
 * 2. æˆ–é€šè¿‡æµè§ˆå™¨æ‰©å±•ã€ç”¨æˆ·è„šæœ¬ç­‰æ–¹å¼æ³¨å…¥
 */

(function () {
  "use strict";

  // æ£€æŸ¥æ˜¯å¦åœ¨ iframe ä¸­
  if (window.self === window.top) {
    return; // ä¸åœ¨ iframe ä¸­ï¼Œä¸æ‰§è¡Œ
  }

  // æ£€æŸ¥æ˜¯å¦å·²ç»åˆå§‹åŒ–è¿‡
  if (window.__iframeHighlightInitialized) {
    return;
  }
  window.__iframeHighlightInitialized = true;
  console.log("Iframe é«˜äº®è„šæœ¬å·²åŠ è½½");

  // åˆ›å»ºé«˜äº®è¦†ç›–å±‚
  var overlay = document.createElement("div");
  overlay.id = "iframe-highlight-overlay";
  overlay.style.cssText = "\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    pointer-events: none;\n    z-index: 999999;\n    overflow: hidden;\n  ";

  // åˆ›å»ºæ‚¬åœé«˜äº®æ¡†ï¼ˆè™šçº¿è¾¹æ¡†ï¼‰
  var highlightBox = document.createElement("div");
  highlightBox.id = "iframe-highlight-box";
  highlightBox.style.cssText = "\n    position: absolute;\n    border: 2px dashed #007AFF;\n    background: rgba(0, 122, 255, 0.08);\n    pointer-events: none;\n    display: none;\n    transition: all 0.1s ease;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);\n    border-radius: 2px;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹çš„å¸¸é©»é«˜äº®æ¡†ï¼ˆå®çº¿è¾¹æ¡†ï¼‰
  var selectedBox = document.createElement("div");
  selectedBox.id = "iframe-selected-box";
  selectedBox.style.cssText = "\n    position: absolute;\n    border: 2px solid #007AFF;\n    pointer-events: none;\n    display: none;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 107, 53, 0.4);\n    border-radius: 2px;\n    z-index: 1000000;\n  ";

  // åˆ›å»ºæ‚¬åœæ ‡ç­¾æ˜¾ç¤º
  var tagLabel = document.createElement("div");
  tagLabel.id = "iframe-tag-label";
  tagLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 2px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000001;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    font-weight: 500;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹æ ‡ç­¾
  var selectedLabel = document.createElement("div");
  selectedLabel.id = "iframe-selected-label";
  selectedLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 3px 8px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 3px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000002;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);\n    font-weight: 600;\n  ";
  overlay.appendChild(highlightBox);
  overlay.appendChild(selectedBox);
  overlay.appendChild(tagLabel);
  overlay.appendChild(selectedLabel);
  document.body.appendChild(overlay);

  // å­˜å‚¨å½“å‰é€‰ä¸­çš„å…ƒç´ 
  var selectedElement = null;
  var highlightEnabled = false;

  // æ›´æ–°é€‰ä¸­å…ƒç´ çš„é«˜äº®æ˜¾ç¤º
  function updateSelectedHighlight(element) {
    console.log("updateSelectedHighlight called with:", element);
    if (!element) {
      selectedBox.style.display = "none";
      selectedLabel.style.display = "none";
      selectedElement = null;
      console.log("Cleared selected highlight");
      return;
    }
    selectedElement = element;
    var rect = element.getBoundingClientRect();
    console.log("Selected element rect:", rect);

    // æ›´æ–°é€‰ä¸­é«˜äº®æ¡†ä½ç½®
    selectedBox.style.display = "block";
    selectedBox.style.left = "".concat(rect.left - 2, "px");
    selectedBox.style.top = "".concat(rect.top - 2, "px");
    selectedBox.style.width = "".concat(rect.width + 4, "px");
    selectedBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°é€‰ä¸­æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    selectedLabel.style.display = "block";
    selectedLabel.textContent = "\u2713 <".concat(element.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 28;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 5) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    var labelWidth = selectedLabel.offsetWidth || 100; // é¢„ä¼°å®½åº¦
    if (labelLeft + labelWidth > window.innerWidth - 10) {
      labelLeft = window.innerWidth - labelWidth - 10;
    }
    selectedLabel.style.left = "".concat(Math.max(5, labelLeft), "px");
    selectedLabel.style.top = "".concat(labelTop, "px");
    console.log("Selected highlight positioned at:", {
      left: selectedBox.style.left,
      top: selectedBox.style.top,
      width: selectedBox.style.width,
      height: selectedBox.style.height
    });
  }
  function getElementSelector(element) {
    if (!(element instanceof Element)) throw new Error('Argument must be a DOM element');
    var segments = [];
    var current = element;
    while (current !== document.documentElement) {
      var selector = '';
      // ä¼˜å…ˆæ£€æŸ¥å”¯ä¸€ID
      if (current.id && document.querySelectorAll("#".concat(current.id)).length === 1) {
        segments.unshift("#".concat(current.id));
        break; // IDå”¯ä¸€ï¼Œæ— éœ€ç»§ç»­å‘ä¸Š
      }

      // ç”Ÿæˆç±»åé€‰æ‹©å™¨ï¼ˆå–ç¬¬ä¸€ä¸ªæœ‰æ•ˆç±»åï¼‰
      var classes = Array.from(current.classList).filter(function (c) {
        return !c.startsWith('js-');
      });
      var className = classes.length > 0 ? ".".concat(classes[0]) : '';

      // ç”Ÿæˆä½ç½®ç´¢å¼•ï¼ˆnth-childï¼‰
      var tag = current.tagName.toLowerCase();
      if (!className) {
        var siblings = Array.from(current.parentNode.children);
        var index = siblings.findIndex(function (el) {
          return el === current;
        }) + 1;
        selector = "".concat(tag, ":nth-child(").concat(index, ")");
      } else {
        selector = className;
      }
      segments.unshift(selector);
      current = current.parentElement;
    }

    // å¤„ç†æ ¹å…ƒç´ 
    if (current === document.documentElement) {
      segments.unshift('html');
    }
    return segments.join(' > ');
  }

  // è·å–å…ƒç´ æ–‡æœ¬å†…å®¹
  function getElementText(element) {
    var _element$textContent;
    if (element.tagName === "INPUT") {
      return element.value || element.placeholder || "";
    }
    if (element.tagName === "TEXTAREA") {
      return element.value || element.placeholder || "";
    }
    var text = ((_element$textContent = element.textContent) === null || _element$textContent === void 0 ? void 0 : _element$textContent.trim()) || "";
    return text.length > 50 ? text.substring(0, 50) + "..." : text;
  }

  // è·å–å…ƒç´ å±æ€§ä¿¡æ¯
  function getElementAttributes(element) {
    var attrs = {};
    for (var i = 0; i < element.attributes.length; i++) {
      var attr = element.attributes[i];
      attrs[attr.name] = attr.value;
    }
    return attrs;
  }

  // é¼ æ ‡æ‚¬åœäº‹ä»¶å¤„ç†
  function handleMouseOver(e) {
    if (!highlightEnabled) return;
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…é«˜äº® html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // å¦‚æœæ˜¯å·²é€‰ä¸­çš„å…ƒç´ ï¼Œä¸æ˜¾ç¤ºæ‚¬åœé«˜äº®
    if (target === selectedElement) {
      highlightBox.style.display = "none";
      tagLabel.style.display = "none";
      return;
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);

    // æ›´æ–°æ‚¬åœé«˜äº®æ¡†ä½ç½®
    highlightBox.style.display = "block";
    highlightBox.style.left = "".concat(rect.left - 2, "px");
    highlightBox.style.top = "".concat(rect.top - 2, "px");
    highlightBox.style.width = "".concat(rect.width + 4, "px");
    highlightBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    tagLabel.style.display = "block";
    tagLabel.textContent = "<".concat(target.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 22;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 0) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    if (labelLeft + tagLabel.offsetWidth > window.innerWidth) {
      labelLeft = window.innerWidth - tagLabel.offsetWidth - 5;
    }
    tagLabel.style.left = "".concat(Math.max(0, labelLeft), "px");
    tagLabel.style.top = "".concat(labelTop, "px");

    // å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // é¼ æ ‡ç¦»å¼€äº‹ä»¶å¤„ç†
  function handleMouseOut(e) {
    if (!highlightEnabled) return;
    var relatedTarget = e.relatedTarget;

    // å¦‚æœé¼ æ ‡ç§»åŠ¨åˆ°é«˜äº®ç›¸å…³å…ƒç´ ä¸Šï¼Œä¸éšè—é«˜äº®
    if (relatedTarget && (relatedTarget === highlightBox || relatedTarget === tagLabel || relatedTarget === overlay || relatedTarget === selectedBox || relatedTarget === selectedLabel)) {
      return;
    }
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: null,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç‚¹å‡»äº‹ä»¶å¤„ç†
  function handleClick(e) {
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…å¤„ç† html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // æ£€æŸ¥æ˜¯å¦æ˜¯äº¤äº’å…ƒç´ ï¼Œè¿™äº›å…ƒç´ éœ€è¦ä¿ç•™é»˜è®¤è¡Œä¸º
    var isInteractiveElement = ['input', 'textarea', 'select', 'button', 'a'].includes(target.tagName.toLowerCase());

    // å¦‚æœé«˜äº®åŠŸèƒ½å¯ç”¨ï¼Œå¯¹äºéäº¤äº’å…ƒç´ é˜»æ­¢é»˜è®¤è¡Œä¸ºå’Œäº‹ä»¶ä¼ æ’­
    if (highlightEnabled) {
      e.preventDefault();
      e.stopPropagation();
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);
    console.log("Element clicked:", {
      tagName: target.tagName,
      selector: selector,
      rect: rect
    });

    // ç«‹å³æ›´æ–°é€‰ä¸­é«˜äº®
    updateSelectedHighlight(target);

    // éšè—æ‚¬åœé«˜äº®ï¼Œå› ä¸ºç°åœ¨æ˜¯é€‰ä¸­çŠ¶æ€
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-click",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç›‘å¬æ¥è‡ªçˆ¶çª—å£çš„æ¶ˆæ¯
  function handleParentMessage(event) {
    console.log("Received message from parent:", event.data);
    if (event.data.type === "iframe-highlight-toggle") {
      var enabled = event.data.enabled;
      console.log("Highlight toggle:", enabled);
      if (enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "enable-iframe-highlight") {
      console.log("Enable iframe highlight");
      enableHighlight();
    } else if (event.data.type === "disable-iframe-highlight") {
      console.log("Disable iframe highlight");
      disableHighlight();
    } else if (event.data.type === "toggle-iframe-highlight") {
      var _enabled = event.data.enabled !== undefined ? event.data.enabled : !highlightEnabled;
      console.log("Toggle iframe highlight to:", _enabled);
      if (_enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "update-selected-element") {
      var selector = event.data.selector;
      console.log("Update selected element with selector:", selector);
      if (selector) {
        try {
          var element = document.querySelector(selector);
          console.log("Found element by selector:", element);
          updateSelectedHighlight(element);
        } catch (error) {
          console.warn("Failed to select element:", error);
          updateSelectedHighlight(null);
        }
      } else {
        updateSelectedHighlight(null);
      }
    } else if (event.data.type === "clear-selected-element") {
      console.log("Clear selected element");
      updateSelectedHighlight(null);
    }
  }

  // å¯ç”¨é«˜äº®åŠŸèƒ½
  function enableHighlight() {
    console.log("Enabling highlight");
    document.addEventListener("mouseover", handleMouseOver, true);
    document.addEventListener("mouseout", handleMouseOut, true);
    document.addEventListener("click", handleClick, true);
    highlightEnabled = true;
    overlay.style.display = "block";
  }

  // ç¦ç”¨é«˜äº®åŠŸèƒ½
  function disableHighlight() {
    console.log("Disabling highlight");
    highlightEnabled = false;
    // ä¿æŒäº‹ä»¶ç›‘å¬å™¨ï¼Œä½†é€šè¿‡ highlightEnabled å˜é‡æ§åˆ¶è¡Œä¸º
    // è¿™æ ·å¯ä»¥ä¿ç•™é€‰ä¸­çŠ¶æ€çš„æ˜¾ç¤º
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    // ä¸éšè— selectedBox å’Œ selectedLabelï¼Œä¿ç•™é€‰ä¸­çŠ¶æ€
  }

  // å®Œå…¨ç¦ç”¨é«˜äº®åŠŸèƒ½ï¼ˆç§»é™¤æ‰€æœ‰ç›‘å¬å™¨ï¼‰
  function fullyDisableHighlight() {
    console.log("Fully disabling highlight");
    highlightEnabled = false;
    document.removeEventListener("mouseover", handleMouseOver, true);
    document.removeEventListener("mouseout", handleMouseOut, true);
    document.removeEventListener("click", handleClick, true);
    overlay.style.display = "none";
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    selectedBox.style.display = "none";
    selectedLabel.style.display = "none";
  }

  // æ·»åŠ äº‹ä»¶ç›‘å¬
  enableHighlight();
  window.addEventListener("message", handleParentMessage);

  // æš´éœ²å…¨å±€å‡½æ•°ä¾›å¤–éƒ¨è°ƒç”¨
  window.__iframeHighlightControl = {
    enable: enableHighlight,
    disable: disableHighlight,
    fullyDisable: fullyDisableHighlight,
    isEnabled: function isEnabled() {
      return highlightEnabled;
    },
    getSelectedElement: function getSelectedElement() {
      return selectedElement;
    },
    updateSelected: updateSelectedHighlight,
    // é€šè¿‡æ¶ˆæ¯å‘é€å¼€å…³æ§åˆ¶
    sendToggleMessage: function sendToggleMessage(enabled) {
      window.parent.postMessage({
        type: 'iframe-highlight-status',
        enabled: enabled || highlightEnabled,
        source: 'iframe-highlight-injector'
      }, '*');
    }
  };

  // é€šçŸ¥çˆ¶çª—å£è„šæœ¬å·²åŠ è½½
  try {
    window.parent.postMessage({
      type: "iframe-highlight-ready",
      data: {
        url: window.location.href,
        userAgent: navigator.userAgent,
        timestamp: Date.now()
      },
      source: "iframe-highlight-injector"
    }, "*");
  } catch (error) {
    console.warn("æ— æ³•å‘é€å°±ç»ªæ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
  }

  // æ¸…ç†å‡½æ•°
  window.__iframeHighlightCleanup = function () {
    fullyDisableHighlight();
    window.removeEventListener("message", handleParentMessage);
    if (overlay.parentElement) {
      overlay.parentElement.removeChild(overlay);
    }
    delete window.__iframeHighlightInitialized;
    delete window.__iframeHighlightCleanup;
  };
})();

</script>

<script>
/**
 * Iframe å…ƒç´ é«˜äº®æ³¨å…¥è„šæœ¬
 * éœ€è¦åœ¨ç›®æ ‡ç½‘ç«™ä¸­å¼•å…¥æ­¤è„šæœ¬æ¥æ”¯æŒè·¨åŸŸ iframe é«˜äº®åŠŸèƒ½
 *
 * ä½¿ç”¨æ–¹æ³•ï¼š
 * 1. å°†æ­¤è„šæœ¬æ·»åŠ åˆ°ç›®æ ‡ç½‘ç«™çš„ HTML ä¸­
 * 2. æˆ–é€šè¿‡æµè§ˆå™¨æ‰©å±•ã€ç”¨æˆ·è„šæœ¬ç­‰æ–¹å¼æ³¨å…¥
 */

(function () {
  "use strict";

  // æ£€æŸ¥æ˜¯å¦åœ¨ iframe ä¸­
  if (window.self === window.top) {
    return; // ä¸åœ¨ iframe ä¸­ï¼Œä¸æ‰§è¡Œ
  }

  // æ£€æŸ¥æ˜¯å¦å·²ç»åˆå§‹åŒ–è¿‡
  if (window.__iframeHighlightInitialized) {
    return;
  }
  window.__iframeHighlightInitialized = true;
  console.log("Iframe é«˜äº®è„šæœ¬å·²åŠ è½½");

  // åˆ›å»ºé«˜äº®è¦†ç›–å±‚
  var overlay = document.createElement("div");
  overlay.id = "iframe-highlight-overlay";
  overlay.style.cssText = "\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    pointer-events: none;\n    z-index: 999999;\n    overflow: hidden;\n  ";

  // åˆ›å»ºæ‚¬åœé«˜äº®æ¡†ï¼ˆè™šçº¿è¾¹æ¡†ï¼‰
  var highlightBox = document.createElement("div");
  highlightBox.id = "iframe-highlight-box";
  highlightBox.style.cssText = "\n    position: absolute;\n    border: 2px dashed #007AFF;\n    background: rgba(0, 122, 255, 0.08);\n    pointer-events: none;\n    display: none;\n    transition: all 0.1s ease;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);\n    border-radius: 2px;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹çš„å¸¸é©»é«˜äº®æ¡†ï¼ˆå®çº¿è¾¹æ¡†ï¼‰
  var selectedBox = document.createElement("div");
  selectedBox.id = "iframe-selected-box";
  selectedBox.style.cssText = "\n    position: absolute;\n    border: 2px solid #007AFF;\n    pointer-events: none;\n    display: none;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 107, 53, 0.4);\n    border-radius: 2px;\n    z-index: 1000000;\n  ";

  // åˆ›å»ºæ‚¬åœæ ‡ç­¾æ˜¾ç¤º
  var tagLabel = document.createElement("div");
  tagLabel.id = "iframe-tag-label";
  tagLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 2px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000001;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    font-weight: 500;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹æ ‡ç­¾
  var selectedLabel = document.createElement("div");
  selectedLabel.id = "iframe-selected-label";
  selectedLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 3px 8px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 3px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000002;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);\n    font-weight: 600;\n  ";
  overlay.appendChild(highlightBox);
  overlay.appendChild(selectedBox);
  overlay.appendChild(tagLabel);
  overlay.appendChild(selectedLabel);
  document.body.appendChild(overlay);

  // å­˜å‚¨å½“å‰é€‰ä¸­çš„å…ƒç´ 
  var selectedElement = null;
  var highlightEnabled = false;

  // æ›´æ–°é€‰ä¸­å…ƒç´ çš„é«˜äº®æ˜¾ç¤º
  function updateSelectedHighlight(element) {
    console.log("updateSelectedHighlight called with:", element);
    if (!element) {
      selectedBox.style.display = "none";
      selectedLabel.style.display = "none";
      selectedElement = null;
      console.log("Cleared selected highlight");
      return;
    }
    selectedElement = element;
    var rect = element.getBoundingClientRect();
    console.log("Selected element rect:", rect);

    // æ›´æ–°é€‰ä¸­é«˜äº®æ¡†ä½ç½®
    selectedBox.style.display = "block";
    selectedBox.style.left = "".concat(rect.left - 2, "px");
    selectedBox.style.top = "".concat(rect.top - 2, "px");
    selectedBox.style.width = "".concat(rect.width + 4, "px");
    selectedBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°é€‰ä¸­æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    selectedLabel.style.display = "block";
    selectedLabel.textContent = "\u2713 <".concat(element.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 28;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 5) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    var labelWidth = selectedLabel.offsetWidth || 100; // é¢„ä¼°å®½åº¦
    if (labelLeft + labelWidth > window.innerWidth - 10) {
      labelLeft = window.innerWidth - labelWidth - 10;
    }
    selectedLabel.style.left = "".concat(Math.max(5, labelLeft), "px");
    selectedLabel.style.top = "".concat(labelTop, "px");
    console.log("Selected highlight positioned at:", {
      left: selectedBox.style.left,
      top: selectedBox.style.top,
      width: selectedBox.style.width,
      height: selectedBox.style.height
    });
  }
  function getElementSelector(element) {
    if (!(element instanceof Element)) throw new Error('Argument must be a DOM element');
    var segments = [];
    var current = element;
    while (current !== document.documentElement) {
      var selector = '';
      // ä¼˜å…ˆæ£€æŸ¥å”¯ä¸€ID
      if (current.id && document.querySelectorAll("#".concat(current.id)).length === 1) {
        segments.unshift("#".concat(current.id));
        break; // IDå”¯ä¸€ï¼Œæ— éœ€ç»§ç»­å‘ä¸Š
      }

      // ç”Ÿæˆç±»åé€‰æ‹©å™¨ï¼ˆå–ç¬¬ä¸€ä¸ªæœ‰æ•ˆç±»åï¼‰
      var classes = Array.from(current.classList).filter(function (c) {
        return !c.startsWith('js-');
      });
      var className = classes.length > 0 ? ".".concat(classes[0]) : '';

      // ç”Ÿæˆä½ç½®ç´¢å¼•ï¼ˆnth-childï¼‰
      var tag = current.tagName.toLowerCase();
      if (!className) {
        var siblings = Array.from(current.parentNode.children);
        var index = siblings.findIndex(function (el) {
          return el === current;
        }) + 1;
        selector = "".concat(tag, ":nth-child(").concat(index, ")");
      } else {
        selector = className;
      }
      segments.unshift(selector);
      current = current.parentElement;
    }

    // å¤„ç†æ ¹å…ƒç´ 
    if (current === document.documentElement) {
      segments.unshift('html');
    }
    return segments.join(' > ');
  }

  // è·å–å…ƒç´ æ–‡æœ¬å†…å®¹
  function getElementText(element) {
    var _element$textContent;
    if (element.tagName === "INPUT") {
      return element.value || element.placeholder || "";
    }
    if (element.tagName === "TEXTAREA") {
      return element.value || element.placeholder || "";
    }
    var text = ((_element$textContent = element.textContent) === null || _element$textContent === void 0 ? void 0 : _element$textContent.trim()) || "";
    return text.length > 50 ? text.substring(0, 50) + "..." : text;
  }

  // è·å–å…ƒç´ å±æ€§ä¿¡æ¯
  function getElementAttributes(element) {
    var attrs = {};
    for (var i = 0; i < element.attributes.length; i++) {
      var attr = element.attributes[i];
      attrs[attr.name] = attr.value;
    }
    return attrs;
  }

  // é¼ æ ‡æ‚¬åœäº‹ä»¶å¤„ç†
  function handleMouseOver(e) {
    if (!highlightEnabled) return;
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…é«˜äº® html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // å¦‚æœæ˜¯å·²é€‰ä¸­çš„å…ƒç´ ï¼Œä¸æ˜¾ç¤ºæ‚¬åœé«˜äº®
    if (target === selectedElement) {
      highlightBox.style.display = "none";
      tagLabel.style.display = "none";
      return;
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);

    // æ›´æ–°æ‚¬åœé«˜äº®æ¡†ä½ç½®
    highlightBox.style.display = "block";
    highlightBox.style.left = "".concat(rect.left - 2, "px");
    highlightBox.style.top = "".concat(rect.top - 2, "px");
    highlightBox.style.width = "".concat(rect.width + 4, "px");
    highlightBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    tagLabel.style.display = "block";
    tagLabel.textContent = "<".concat(target.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 22;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 0) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    if (labelLeft + tagLabel.offsetWidth > window.innerWidth) {
      labelLeft = window.innerWidth - tagLabel.offsetWidth - 5;
    }
    tagLabel.style.left = "".concat(Math.max(0, labelLeft), "px");
    tagLabel.style.top = "".concat(labelTop, "px");

    // å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // é¼ æ ‡ç¦»å¼€äº‹ä»¶å¤„ç†
  function handleMouseOut(e) {
    if (!highlightEnabled) return;
    var relatedTarget = e.relatedTarget;

    // å¦‚æœé¼ æ ‡ç§»åŠ¨åˆ°é«˜äº®ç›¸å…³å…ƒç´ ä¸Šï¼Œä¸éšè—é«˜äº®
    if (relatedTarget && (relatedTarget === highlightBox || relatedTarget === tagLabel || relatedTarget === overlay || relatedTarget === selectedBox || relatedTarget === selectedLabel)) {
      return;
    }
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: null,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç‚¹å‡»äº‹ä»¶å¤„ç†
  function handleClick(e) {
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…å¤„ç† html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // æ£€æŸ¥æ˜¯å¦æ˜¯äº¤äº’å…ƒç´ ï¼Œè¿™äº›å…ƒç´ éœ€è¦ä¿ç•™é»˜è®¤è¡Œä¸º
    var isInteractiveElement = ['input', 'textarea', 'select', 'button', 'a'].includes(target.tagName.toLowerCase());

    // å¦‚æœé«˜äº®åŠŸèƒ½å¯ç”¨ï¼Œå¯¹äºéäº¤äº’å…ƒç´ é˜»æ­¢é»˜è®¤è¡Œä¸ºå’Œäº‹ä»¶ä¼ æ’­
    if (highlightEnabled) {
      e.preventDefault();
      e.stopPropagation();
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);
    console.log("Element clicked:", {
      tagName: target.tagName,
      selector: selector,
      rect: rect
    });

    // ç«‹å³æ›´æ–°é€‰ä¸­é«˜äº®
    updateSelectedHighlight(target);

    // éšè—æ‚¬åœé«˜äº®ï¼Œå› ä¸ºç°åœ¨æ˜¯é€‰ä¸­çŠ¶æ€
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-click",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç›‘å¬æ¥è‡ªçˆ¶çª—å£çš„æ¶ˆæ¯
  function handleParentMessage(event) {
    console.log("Received message from parent:", event.data);
    if (event.data.type === "iframe-highlight-toggle") {
      var enabled = event.data.enabled;
      console.log("Highlight toggle:", enabled);
      if (enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "enable-iframe-highlight") {
      console.log("Enable iframe highlight");
      enableHighlight();
    } else if (event.data.type === "disable-iframe-highlight") {
      console.log("Disable iframe highlight");
      disableHighlight();
    } else if (event.data.type === "toggle-iframe-highlight") {
      var _enabled = event.data.enabled !== undefined ? event.data.enabled : !highlightEnabled;
      console.log("Toggle iframe highlight to:", _enabled);
      if (_enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "update-selected-element") {
      var selector = event.data.selector;
      console.log("Update selected element with selector:", selector);
      if (selector) {
        try {
          var element = document.querySelector(selector);
          console.log("Found element by selector:", element);
          updateSelectedHighlight(element);
        } catch (error) {
          console.warn("Failed to select element:", error);
          updateSelectedHighlight(null);
        }
      } else {
        updateSelectedHighlight(null);
      }
    } else if (event.data.type === "clear-selected-element") {
      console.log("Clear selected element");
      updateSelectedHighlight(null);
    }
  }

  // å¯ç”¨é«˜äº®åŠŸèƒ½
  function enableHighlight() {
    console.log("Enabling highlight");
    document.addEventListener("mouseover", handleMouseOver, true);
    document.addEventListener("mouseout", handleMouseOut, true);
    document.addEventListener("click", handleClick, true);
    highlightEnabled = true;
    overlay.style.display = "block";
  }

  // ç¦ç”¨é«˜äº®åŠŸèƒ½
  function disableHighlight() {
    console.log("Disabling highlight");
    highlightEnabled = false;
    // ä¿æŒäº‹ä»¶ç›‘å¬å™¨ï¼Œä½†é€šè¿‡ highlightEnabled å˜é‡æ§åˆ¶è¡Œä¸º
    // è¿™æ ·å¯ä»¥ä¿ç•™é€‰ä¸­çŠ¶æ€çš„æ˜¾ç¤º
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    // ä¸éšè— selectedBox å’Œ selectedLabelï¼Œä¿ç•™é€‰ä¸­çŠ¶æ€
  }

  // å®Œå…¨ç¦ç”¨é«˜äº®åŠŸèƒ½ï¼ˆç§»é™¤æ‰€æœ‰ç›‘å¬å™¨ï¼‰
  function fullyDisableHighlight() {
    console.log("Fully disabling highlight");
    highlightEnabled = false;
    document.removeEventListener("mouseover", handleMouseOver, true);
    document.removeEventListener("mouseout", handleMouseOut, true);
    document.removeEventListener("click", handleClick, true);
    overlay.style.display = "none";
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    selectedBox.style.display = "none";
    selectedLabel.style.display = "none";
  }

  // æ·»åŠ äº‹ä»¶ç›‘å¬
  enableHighlight();
  window.addEventListener("message", handleParentMessage);

  // æš´éœ²å…¨å±€å‡½æ•°ä¾›å¤–éƒ¨è°ƒç”¨
  window.__iframeHighlightControl = {
    enable: enableHighlight,
    disable: disableHighlight,
    fullyDisable: fullyDisableHighlight,
    isEnabled: function isEnabled() {
      return highlightEnabled;
    },
    getSelectedElement: function getSelectedElement() {
      return selectedElement;
    },
    updateSelected: updateSelectedHighlight,
    // é€šè¿‡æ¶ˆæ¯å‘é€å¼€å…³æ§åˆ¶
    sendToggleMessage: function sendToggleMessage(enabled) {
      window.parent.postMessage({
        type: 'iframe-highlight-status',
        enabled: enabled || highlightEnabled,
        source: 'iframe-highlight-injector'
      }, '*');
    }
  };

  // é€šçŸ¥çˆ¶çª—å£è„šæœ¬å·²åŠ è½½
  try {
    window.parent.postMessage({
      type: "iframe-highlight-ready",
      data: {
        url: window.location.href,
        userAgent: navigator.userAgent,
        timestamp: Date.now()
      },
      source: "iframe-highlight-injector"
    }, "*");
  } catch (error) {
    console.warn("æ— æ³•å‘é€å°±ç»ªæ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
  }

  // æ¸…ç†å‡½æ•°
  window.__iframeHighlightCleanup = function () {
    fullyDisableHighlight();
    window.removeEventListener("message", handleParentMessage);
    if (overlay.parentElement) {
      overlay.parentElement.removeChild(overlay);
    }
    delete window.__iframeHighlightInitialized;
    delete window.__iframeHighlightCleanup;
  };
})();

</script>

<script>
/**
 * Iframe å…ƒç´ é«˜äº®æ³¨å…¥è„šæœ¬
 * éœ€è¦åœ¨ç›®æ ‡ç½‘ç«™ä¸­å¼•å…¥æ­¤è„šæœ¬æ¥æ”¯æŒè·¨åŸŸ iframe é«˜äº®åŠŸèƒ½
 *
 * ä½¿ç”¨æ–¹æ³•ï¼š
 * 1. å°†æ­¤è„šæœ¬æ·»åŠ åˆ°ç›®æ ‡ç½‘ç«™çš„ HTML ä¸­
 * 2. æˆ–é€šè¿‡æµè§ˆå™¨æ‰©å±•ã€ç”¨æˆ·è„šæœ¬ç­‰æ–¹å¼æ³¨å…¥
 */

(function () {
  "use strict";

  // æ£€æŸ¥æ˜¯å¦åœ¨ iframe ä¸­
  if (window.self === window.top) {
    return; // ä¸åœ¨ iframe ä¸­ï¼Œä¸æ‰§è¡Œ
  }

  // æ£€æŸ¥æ˜¯å¦å·²ç»åˆå§‹åŒ–è¿‡
  if (window.__iframeHighlightInitialized) {
    return;
  }
  window.__iframeHighlightInitialized = true;
  console.log("Iframe é«˜äº®è„šæœ¬å·²åŠ è½½");

  // åˆ›å»ºé«˜äº®è¦†ç›–å±‚
  var overlay = document.createElement("div");
  overlay.id = "iframe-highlight-overlay";
  overlay.style.cssText = "\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    pointer-events: none;\n    z-index: 999999;\n    overflow: hidden;\n  ";

  // åˆ›å»ºæ‚¬åœé«˜äº®æ¡†ï¼ˆè™šçº¿è¾¹æ¡†ï¼‰
  var highlightBox = document.createElement("div");
  highlightBox.id = "iframe-highlight-box";
  highlightBox.style.cssText = "\n    position: absolute;\n    border: 2px dashed #007AFF;\n    background: rgba(0, 122, 255, 0.08);\n    pointer-events: none;\n    display: none;\n    transition: all 0.1s ease;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);\n    border-radius: 2px;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹çš„å¸¸é©»é«˜äº®æ¡†ï¼ˆå®çº¿è¾¹æ¡†ï¼‰
  var selectedBox = document.createElement("div");
  selectedBox.id = "iframe-selected-box";
  selectedBox.style.cssText = "\n    position: absolute;\n    border: 2px solid #007AFF;\n    pointer-events: none;\n    display: none;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 107, 53, 0.4);\n    border-radius: 2px;\n    z-index: 1000000;\n  ";

  // åˆ›å»ºæ‚¬åœæ ‡ç­¾æ˜¾ç¤º
  var tagLabel = document.createElement("div");
  tagLabel.id = "iframe-tag-label";
  tagLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 2px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000001;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    font-weight: 500;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹æ ‡ç­¾
  var selectedLabel = document.createElement("div");
  selectedLabel.id = "iframe-selected-label";
  selectedLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 3px 8px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 3px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000002;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);\n    font-weight: 600;\n  ";
  overlay.appendChild(highlightBox);
  overlay.appendChild(selectedBox);
  overlay.appendChild(tagLabel);
  overlay.appendChild(selectedLabel);
  document.body.appendChild(overlay);

  // å­˜å‚¨å½“å‰é€‰ä¸­çš„å…ƒç´ 
  var selectedElement = null;
  var highlightEnabled = false;

  // æ›´æ–°é€‰ä¸­å…ƒç´ çš„é«˜äº®æ˜¾ç¤º
  function updateSelectedHighlight(element) {
    console.log("updateSelectedHighlight called with:", element);
    if (!element) {
      selectedBox.style.display = "none";
      selectedLabel.style.display = "none";
      selectedElement = null;
      console.log("Cleared selected highlight");
      return;
    }
    selectedElement = element;
    var rect = element.getBoundingClientRect();
    console.log("Selected element rect:", rect);

    // æ›´æ–°é€‰ä¸­é«˜äº®æ¡†ä½ç½®
    selectedBox.style.display = "block";
    selectedBox.style.left = "".concat(rect.left - 2, "px");
    selectedBox.style.top = "".concat(rect.top - 2, "px");
    selectedBox.style.width = "".concat(rect.width + 4, "px");
    selectedBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°é€‰ä¸­æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    selectedLabel.style.display = "block";
    selectedLabel.textContent = "\u2713 <".concat(element.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 28;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 5) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    var labelWidth = selectedLabel.offsetWidth || 100; // é¢„ä¼°å®½åº¦
    if (labelLeft + labelWidth > window.innerWidth - 10) {
      labelLeft = window.innerWidth - labelWidth - 10;
    }
    selectedLabel.style.left = "".concat(Math.max(5, labelLeft), "px");
    selectedLabel.style.top = "".concat(labelTop, "px");
    console.log("Selected highlight positioned at:", {
      left: selectedBox.style.left,
      top: selectedBox.style.top,
      width: selectedBox.style.width,
      height: selectedBox.style.height
    });
  }
  function getElementSelector(element) {
    if (!(element instanceof Element)) throw new Error('Argument must be a DOM element');
    var segments = [];
    var current = element;
    while (current !== document.documentElement) {
      var selector = '';
      // ä¼˜å…ˆæ£€æŸ¥å”¯ä¸€ID
      if (current.id && document.querySelectorAll("#".concat(current.id)).length === 1) {
        segments.unshift("#".concat(current.id));
        break; // IDå”¯ä¸€ï¼Œæ— éœ€ç»§ç»­å‘ä¸Š
      }

      // ç”Ÿæˆç±»åé€‰æ‹©å™¨ï¼ˆå–ç¬¬ä¸€ä¸ªæœ‰æ•ˆç±»åï¼‰
      var classes = Array.from(current.classList).filter(function (c) {
        return !c.startsWith('js-');
      });
      var className = classes.length > 0 ? ".".concat(classes[0]) : '';

      // ç”Ÿæˆä½ç½®ç´¢å¼•ï¼ˆnth-childï¼‰
      var tag = current.tagName.toLowerCase();
      if (!className) {
        var siblings = Array.from(current.parentNode.children);
        var index = siblings.findIndex(function (el) {
          return el === current;
        }) + 1;
        selector = "".concat(tag, ":nth-child(").concat(index, ")");
      } else {
        selector = className;
      }
      segments.unshift(selector);
      current = current.parentElement;
    }

    // å¤„ç†æ ¹å…ƒç´ 
    if (current === document.documentElement) {
      segments.unshift('html');
    }
    return segments.join(' > ');
  }

  // è·å–å…ƒç´ æ–‡æœ¬å†…å®¹
  function getElementText(element) {
    var _element$textContent;
    if (element.tagName === "INPUT") {
      return element.value || element.placeholder || "";
    }
    if (element.tagName === "TEXTAREA") {
      return element.value || element.placeholder || "";
    }
    var text = ((_element$textContent = element.textContent) === null || _element$textContent === void 0 ? void 0 : _element$textContent.trim()) || "";
    return text.length > 50 ? text.substring(0, 50) + "..." : text;
  }

  // è·å–å…ƒç´ å±æ€§ä¿¡æ¯
  function getElementAttributes(element) {
    var attrs = {};
    for (var i = 0; i < element.attributes.length; i++) {
      var attr = element.attributes[i];
      attrs[attr.name] = attr.value;
    }
    return attrs;
  }

  // é¼ æ ‡æ‚¬åœäº‹ä»¶å¤„ç†
  function handleMouseOver(e) {
    if (!highlightEnabled) return;
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…é«˜äº® html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // å¦‚æœæ˜¯å·²é€‰ä¸­çš„å…ƒç´ ï¼Œä¸æ˜¾ç¤ºæ‚¬åœé«˜äº®
    if (target === selectedElement) {
      highlightBox.style.display = "none";
      tagLabel.style.display = "none";
      return;
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);

    // æ›´æ–°æ‚¬åœé«˜äº®æ¡†ä½ç½®
    highlightBox.style.display = "block";
    highlightBox.style.left = "".concat(rect.left - 2, "px");
    highlightBox.style.top = "".concat(rect.top - 2, "px");
    highlightBox.style.width = "".concat(rect.width + 4, "px");
    highlightBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    tagLabel.style.display = "block";
    tagLabel.textContent = "<".concat(target.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 22;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 0) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    if (labelLeft + tagLabel.offsetWidth > window.innerWidth) {
      labelLeft = window.innerWidth - tagLabel.offsetWidth - 5;
    }
    tagLabel.style.left = "".concat(Math.max(0, labelLeft), "px");
    tagLabel.style.top = "".concat(labelTop, "px");

    // å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // é¼ æ ‡ç¦»å¼€äº‹ä»¶å¤„ç†
  function handleMouseOut(e) {
    if (!highlightEnabled) return;
    var relatedTarget = e.relatedTarget;

    // å¦‚æœé¼ æ ‡ç§»åŠ¨åˆ°é«˜äº®ç›¸å…³å…ƒç´ ä¸Šï¼Œä¸éšè—é«˜äº®
    if (relatedTarget && (relatedTarget === highlightBox || relatedTarget === tagLabel || relatedTarget === overlay || relatedTarget === selectedBox || relatedTarget === selectedLabel)) {
      return;
    }
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: null,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç‚¹å‡»äº‹ä»¶å¤„ç†
  function handleClick(e) {
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…å¤„ç† html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // æ£€æŸ¥æ˜¯å¦æ˜¯äº¤äº’å…ƒç´ ï¼Œè¿™äº›å…ƒç´ éœ€è¦ä¿ç•™é»˜è®¤è¡Œä¸º
    var isInteractiveElement = ['input', 'textarea', 'select', 'button', 'a'].includes(target.tagName.toLowerCase());

    // å¦‚æœé«˜äº®åŠŸèƒ½å¯ç”¨ï¼Œå¯¹äºéäº¤äº’å…ƒç´ é˜»æ­¢é»˜è®¤è¡Œä¸ºå’Œäº‹ä»¶ä¼ æ’­
    if (highlightEnabled) {
      e.preventDefault();
      e.stopPropagation();
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);
    console.log("Element clicked:", {
      tagName: target.tagName,
      selector: selector,
      rect: rect
    });

    // ç«‹å³æ›´æ–°é€‰ä¸­é«˜äº®
    updateSelectedHighlight(target);

    // éšè—æ‚¬åœé«˜äº®ï¼Œå› ä¸ºç°åœ¨æ˜¯é€‰ä¸­çŠ¶æ€
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-click",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç›‘å¬æ¥è‡ªçˆ¶çª—å£çš„æ¶ˆæ¯
  function handleParentMessage(event) {
    console.log("Received message from parent:", event.data);
    if (event.data.type === "iframe-highlight-toggle") {
      var enabled = event.data.enabled;
      console.log("Highlight toggle:", enabled);
      if (enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "enable-iframe-highlight") {
      console.log("Enable iframe highlight");
      enableHighlight();
    } else if (event.data.type === "disable-iframe-highlight") {
      console.log("Disable iframe highlight");
      disableHighlight();
    } else if (event.data.type === "toggle-iframe-highlight") {
      var _enabled = event.data.enabled !== undefined ? event.data.enabled : !highlightEnabled;
      console.log("Toggle iframe highlight to:", _enabled);
      if (_enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "update-selected-element") {
      var selector = event.data.selector;
      console.log("Update selected element with selector:", selector);
      if (selector) {
        try {
          var element = document.querySelector(selector);
          console.log("Found element by selector:", element);
          updateSelectedHighlight(element);
        } catch (error) {
          console.warn("Failed to select element:", error);
          updateSelectedHighlight(null);
        }
      } else {
        updateSelectedHighlight(null);
      }
    } else if (event.data.type === "clear-selected-element") {
      console.log("Clear selected element");
      updateSelectedHighlight(null);
    }
  }

  // å¯ç”¨é«˜äº®åŠŸèƒ½
  function enableHighlight() {
    console.log("Enabling highlight");
    document.addEventListener("mouseover", handleMouseOver, true);
    document.addEventListener("mouseout", handleMouseOut, true);
    document.addEventListener("click", handleClick, true);
    highlightEnabled = true;
    overlay.style.display = "block";
  }

  // ç¦ç”¨é«˜äº®åŠŸèƒ½
  function disableHighlight() {
    console.log("Disabling highlight");
    highlightEnabled = false;
    // ä¿æŒäº‹ä»¶ç›‘å¬å™¨ï¼Œä½†é€šè¿‡ highlightEnabled å˜é‡æ§åˆ¶è¡Œä¸º
    // è¿™æ ·å¯ä»¥ä¿ç•™é€‰ä¸­çŠ¶æ€çš„æ˜¾ç¤º
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    // ä¸éšè— selectedBox å’Œ selectedLabelï¼Œä¿ç•™é€‰ä¸­çŠ¶æ€
  }

  // å®Œå…¨ç¦ç”¨é«˜äº®åŠŸèƒ½ï¼ˆç§»é™¤æ‰€æœ‰ç›‘å¬å™¨ï¼‰
  function fullyDisableHighlight() {
    console.log("Fully disabling highlight");
    highlightEnabled = false;
    document.removeEventListener("mouseover", handleMouseOver, true);
    document.removeEventListener("mouseout", handleMouseOut, true);
    document.removeEventListener("click", handleClick, true);
    overlay.style.display = "none";
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    selectedBox.style.display = "none";
    selectedLabel.style.display = "none";
  }

  // æ·»åŠ äº‹ä»¶ç›‘å¬
  enableHighlight();
  window.addEventListener("message", handleParentMessage);

  // æš´éœ²å…¨å±€å‡½æ•°ä¾›å¤–éƒ¨è°ƒç”¨
  window.__iframeHighlightControl = {
    enable: enableHighlight,
    disable: disableHighlight,
    fullyDisable: fullyDisableHighlight,
    isEnabled: function isEnabled() {
      return highlightEnabled;
    },
    getSelectedElement: function getSelectedElement() {
      return selectedElement;
    },
    updateSelected: updateSelectedHighlight,
    // é€šè¿‡æ¶ˆæ¯å‘é€å¼€å…³æ§åˆ¶
    sendToggleMessage: function sendToggleMessage(enabled) {
      window.parent.postMessage({
        type: 'iframe-highlight-status',
        enabled: enabled || highlightEnabled,
        source: 'iframe-highlight-injector'
      }, '*');
    }
  };

  // é€šçŸ¥çˆ¶çª—å£è„šæœ¬å·²åŠ è½½
  try {
    window.parent.postMessage({
      type: "iframe-highlight-ready",
      data: {
        url: window.location.href,
        userAgent: navigator.userAgent,
        timestamp: Date.now()
      },
      source: "iframe-highlight-injector"
    }, "*");
  } catch (error) {
    console.warn("æ— æ³•å‘é€å°±ç»ªæ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
  }

  // æ¸…ç†å‡½æ•°
  window.__iframeHighlightCleanup = function () {
    fullyDisableHighlight();
    window.removeEventListener("message", handleParentMessage);
    if (overlay.parentElement) {
      overlay.parentElement.removeChild(overlay);
    }
    delete window.__iframeHighlightInitialized;
    delete window.__iframeHighlightCleanup;
  };
})();

</script>

<script>
/**
 * Iframe å…ƒç´ é«˜äº®æ³¨å…¥è„šæœ¬
 * éœ€è¦åœ¨ç›®æ ‡ç½‘ç«™ä¸­å¼•å…¥æ­¤è„šæœ¬æ¥æ”¯æŒè·¨åŸŸ iframe é«˜äº®åŠŸèƒ½
 *
 * ä½¿ç”¨æ–¹æ³•ï¼š
 * 1. å°†æ­¤è„šæœ¬æ·»åŠ åˆ°ç›®æ ‡ç½‘ç«™çš„ HTML ä¸­
 * 2. æˆ–é€šè¿‡æµè§ˆå™¨æ‰©å±•ã€ç”¨æˆ·è„šæœ¬ç­‰æ–¹å¼æ³¨å…¥
 */

(function () {
  "use strict";

  // æ£€æŸ¥æ˜¯å¦åœ¨ iframe ä¸­
  if (window.self === window.top) {
    return; // ä¸åœ¨ iframe ä¸­ï¼Œä¸æ‰§è¡Œ
  }

  // æ£€æŸ¥æ˜¯å¦å·²ç»åˆå§‹åŒ–è¿‡
  if (window.__iframeHighlightInitialized) {
    return;
  }
  window.__iframeHighlightInitialized = true;
  console.log("Iframe é«˜äº®è„šæœ¬å·²åŠ è½½");

  // åˆ›å»ºé«˜äº®è¦†ç›–å±‚
  var overlay = document.createElement("div");
  overlay.id = "iframe-highlight-overlay";
  overlay.style.cssText = "\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    pointer-events: none;\n    z-index: 999999;\n    overflow: hidden;\n  ";

  // åˆ›å»ºæ‚¬åœé«˜äº®æ¡†ï¼ˆè™šçº¿è¾¹æ¡†ï¼‰
  var highlightBox = document.createElement("div");
  highlightBox.id = "iframe-highlight-box";
  highlightBox.style.cssText = "\n    position: absolute;\n    border: 2px dashed #007AFF;\n    background: rgba(0, 122, 255, 0.08);\n    pointer-events: none;\n    display: none;\n    transition: all 0.1s ease;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);\n    border-radius: 2px;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹çš„å¸¸é©»é«˜äº®æ¡†ï¼ˆå®çº¿è¾¹æ¡†ï¼‰
  var selectedBox = document.createElement("div");
  selectedBox.id = "iframe-selected-box";
  selectedBox.style.cssText = "\n    position: absolute;\n    border: 2px solid #007AFF;\n    pointer-events: none;\n    display: none;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 107, 53, 0.4);\n    border-radius: 2px;\n    z-index: 1000000;\n  ";

  // åˆ›å»ºæ‚¬åœæ ‡ç­¾æ˜¾ç¤º
  var tagLabel = document.createElement("div");
  tagLabel.id = "iframe-tag-label";
  tagLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 2px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000001;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    font-weight: 500;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹æ ‡ç­¾
  var selectedLabel = document.createElement("div");
  selectedLabel.id = "iframe-selected-label";
  selectedLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 3px 8px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 3px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000002;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);\n    font-weight: 600;\n  ";
  overlay.appendChild(highlightBox);
  overlay.appendChild(selectedBox);
  overlay.appendChild(tagLabel);
  overlay.appendChild(selectedLabel);
  document.body.appendChild(overlay);

  // å­˜å‚¨å½“å‰é€‰ä¸­çš„å…ƒç´ 
  var selectedElement = null;
  var highlightEnabled = false;

  // æ›´æ–°é€‰ä¸­å…ƒç´ çš„é«˜äº®æ˜¾ç¤º
  function updateSelectedHighlight(element) {
    console.log("updateSelectedHighlight called with:", element);
    if (!element) {
      selectedBox.style.display = "none";
      selectedLabel.style.display = "none";
      selectedElement = null;
      console.log("Cleared selected highlight");
      return;
    }
    selectedElement = element;
    var rect = element.getBoundingClientRect();
    console.log("Selected element rect:", rect);

    // æ›´æ–°é€‰ä¸­é«˜äº®æ¡†ä½ç½®
    selectedBox.style.display = "block";
    selectedBox.style.left = "".concat(rect.left - 2, "px");
    selectedBox.style.top = "".concat(rect.top - 2, "px");
    selectedBox.style.width = "".concat(rect.width + 4, "px");
    selectedBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°é€‰ä¸­æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    selectedLabel.style.display = "block";
    selectedLabel.textContent = "\u2713 <".concat(element.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 28;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 5) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    var labelWidth = selectedLabel.offsetWidth || 100; // é¢„ä¼°å®½åº¦
    if (labelLeft + labelWidth > window.innerWidth - 10) {
      labelLeft = window.innerWidth - labelWidth - 10;
    }
    selectedLabel.style.left = "".concat(Math.max(5, labelLeft), "px");
    selectedLabel.style.top = "".concat(labelTop, "px");
    console.log("Selected highlight positioned at:", {
      left: selectedBox.style.left,
      top: selectedBox.style.top,
      width: selectedBox.style.width,
      height: selectedBox.style.height
    });
  }
  function getElementSelector(element) {
    if (!(element instanceof Element)) throw new Error('Argument must be a DOM element');
    var segments = [];
    var current = element;
    while (current !== document.documentElement) {
      var selector = '';
      // ä¼˜å…ˆæ£€æŸ¥å”¯ä¸€ID
      if (current.id && document.querySelectorAll("#".concat(current.id)).length === 1) {
        segments.unshift("#".concat(current.id));
        break; // IDå”¯ä¸€ï¼Œæ— éœ€ç»§ç»­å‘ä¸Š
      }

      // ç”Ÿæˆç±»åé€‰æ‹©å™¨ï¼ˆå–ç¬¬ä¸€ä¸ªæœ‰æ•ˆç±»åï¼‰
      var classes = Array.from(current.classList).filter(function (c) {
        return !c.startsWith('js-');
      });
      var className = classes.length > 0 ? ".".concat(classes[0]) : '';

      // ç”Ÿæˆä½ç½®ç´¢å¼•ï¼ˆnth-childï¼‰
      var tag = current.tagName.toLowerCase();
      if (!className) {
        var siblings = Array.from(current.parentNode.children);
        var index = siblings.findIndex(function (el) {
          return el === current;
        }) + 1;
        selector = "".concat(tag, ":nth-child(").concat(index, ")");
      } else {
        selector = className;
      }
      segments.unshift(selector);
      current = current.parentElement;
    }

    // å¤„ç†æ ¹å…ƒç´ 
    if (current === document.documentElement) {
      segments.unshift('html');
    }
    return segments.join(' > ');
  }

  // è·å–å…ƒç´ æ–‡æœ¬å†…å®¹
  function getElementText(element) {
    var _element$textContent;
    if (element.tagName === "INPUT") {
      return element.value || element.placeholder || "";
    }
    if (element.tagName === "TEXTAREA") {
      return element.value || element.placeholder || "";
    }
    var text = ((_element$textContent = element.textContent) === null || _element$textContent === void 0 ? void 0 : _element$textContent.trim()) || "";
    return text.length > 50 ? text.substring(0, 50) + "..." : text;
  }

  // è·å–å…ƒç´ å±æ€§ä¿¡æ¯
  function getElementAttributes(element) {
    var attrs = {};
    for (var i = 0; i < element.attributes.length; i++) {
      var attr = element.attributes[i];
      attrs[attr.name] = attr.value;
    }
    return attrs;
  }

  // é¼ æ ‡æ‚¬åœäº‹ä»¶å¤„ç†
  function handleMouseOver(e) {
    if (!highlightEnabled) return;
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…é«˜äº® html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // å¦‚æœæ˜¯å·²é€‰ä¸­çš„å…ƒç´ ï¼Œä¸æ˜¾ç¤ºæ‚¬åœé«˜äº®
    if (target === selectedElement) {
      highlightBox.style.display = "none";
      tagLabel.style.display = "none";
      return;
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);

    // æ›´æ–°æ‚¬åœé«˜äº®æ¡†ä½ç½®
    highlightBox.style.display = "block";
    highlightBox.style.left = "".concat(rect.left - 2, "px");
    highlightBox.style.top = "".concat(rect.top - 2, "px");
    highlightBox.style.width = "".concat(rect.width + 4, "px");
    highlightBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    tagLabel.style.display = "block";
    tagLabel.textContent = "<".concat(target.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 22;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 0) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    if (labelLeft + tagLabel.offsetWidth > window.innerWidth) {
      labelLeft = window.innerWidth - tagLabel.offsetWidth - 5;
    }
    tagLabel.style.left = "".concat(Math.max(0, labelLeft), "px");
    tagLabel.style.top = "".concat(labelTop, "px");

    // å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // é¼ æ ‡ç¦»å¼€äº‹ä»¶å¤„ç†
  function handleMouseOut(e) {
    if (!highlightEnabled) return;
    var relatedTarget = e.relatedTarget;

    // å¦‚æœé¼ æ ‡ç§»åŠ¨åˆ°é«˜äº®ç›¸å…³å…ƒç´ ä¸Šï¼Œä¸éšè—é«˜äº®
    if (relatedTarget && (relatedTarget === highlightBox || relatedTarget === tagLabel || relatedTarget === overlay || relatedTarget === selectedBox || relatedTarget === selectedLabel)) {
      return;
    }
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: null,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç‚¹å‡»äº‹ä»¶å¤„ç†
  function handleClick(e) {
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…å¤„ç† html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // æ£€æŸ¥æ˜¯å¦æ˜¯äº¤äº’å…ƒç´ ï¼Œè¿™äº›å…ƒç´ éœ€è¦ä¿ç•™é»˜è®¤è¡Œä¸º
    var isInteractiveElement = ['input', 'textarea', 'select', 'button', 'a'].includes(target.tagName.toLowerCase());

    // å¦‚æœé«˜äº®åŠŸèƒ½å¯ç”¨ï¼Œå¯¹äºéäº¤äº’å…ƒç´ é˜»æ­¢é»˜è®¤è¡Œä¸ºå’Œäº‹ä»¶ä¼ æ’­
    if (highlightEnabled) {
      e.preventDefault();
      e.stopPropagation();
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);
    console.log("Element clicked:", {
      tagName: target.tagName,
      selector: selector,
      rect: rect
    });

    // ç«‹å³æ›´æ–°é€‰ä¸­é«˜äº®
    updateSelectedHighlight(target);

    // éšè—æ‚¬åœé«˜äº®ï¼Œå› ä¸ºç°åœ¨æ˜¯é€‰ä¸­çŠ¶æ€
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-click",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç›‘å¬æ¥è‡ªçˆ¶çª—å£çš„æ¶ˆæ¯
  function handleParentMessage(event) {
    console.log("Received message from parent:", event.data);
    if (event.data.type === "iframe-highlight-toggle") {
      var enabled = event.data.enabled;
      console.log("Highlight toggle:", enabled);
      if (enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "enable-iframe-highlight") {
      console.log("Enable iframe highlight");
      enableHighlight();
    } else if (event.data.type === "disable-iframe-highlight") {
      console.log("Disable iframe highlight");
      disableHighlight();
    } else if (event.data.type === "toggle-iframe-highlight") {
      var _enabled = event.data.enabled !== undefined ? event.data.enabled : !highlightEnabled;
      console.log("Toggle iframe highlight to:", _enabled);
      if (_enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "update-selected-element") {
      var selector = event.data.selector;
      console.log("Update selected element with selector:", selector);
      if (selector) {
        try {
          var element = document.querySelector(selector);
          console.log("Found element by selector:", element);
          updateSelectedHighlight(element);
        } catch (error) {
          console.warn("Failed to select element:", error);
          updateSelectedHighlight(null);
        }
      } else {
        updateSelectedHighlight(null);
      }
    } else if (event.data.type === "clear-selected-element") {
      console.log("Clear selected element");
      updateSelectedHighlight(null);
    }
  }

  // å¯ç”¨é«˜äº®åŠŸèƒ½
  function enableHighlight() {
    console.log("Enabling highlight");
    document.addEventListener("mouseover", handleMouseOver, true);
    document.addEventListener("mouseout", handleMouseOut, true);
    document.addEventListener("click", handleClick, true);
    highlightEnabled = true;
    overlay.style.display = "block";
  }

  // ç¦ç”¨é«˜äº®åŠŸèƒ½
  function disableHighlight() {
    console.log("Disabling highlight");
    highlightEnabled = false;
    // ä¿æŒäº‹ä»¶ç›‘å¬å™¨ï¼Œä½†é€šè¿‡ highlightEnabled å˜é‡æ§åˆ¶è¡Œä¸º
    // è¿™æ ·å¯ä»¥ä¿ç•™é€‰ä¸­çŠ¶æ€çš„æ˜¾ç¤º
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    // ä¸éšè— selectedBox å’Œ selectedLabelï¼Œä¿ç•™é€‰ä¸­çŠ¶æ€
  }

  // å®Œå…¨ç¦ç”¨é«˜äº®åŠŸèƒ½ï¼ˆç§»é™¤æ‰€æœ‰ç›‘å¬å™¨ï¼‰
  function fullyDisableHighlight() {
    console.log("Fully disabling highlight");
    highlightEnabled = false;
    document.removeEventListener("mouseover", handleMouseOver, true);
    document.removeEventListener("mouseout", handleMouseOut, true);
    document.removeEventListener("click", handleClick, true);
    overlay.style.display = "none";
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    selectedBox.style.display = "none";
    selectedLabel.style.display = "none";
  }

  // æ·»åŠ äº‹ä»¶ç›‘å¬
  enableHighlight();
  window.addEventListener("message", handleParentMessage);

  // æš´éœ²å…¨å±€å‡½æ•°ä¾›å¤–éƒ¨è°ƒç”¨
  window.__iframeHighlightControl = {
    enable: enableHighlight,
    disable: disableHighlight,
    fullyDisable: fullyDisableHighlight,
    isEnabled: function isEnabled() {
      return highlightEnabled;
    },
    getSelectedElement: function getSelectedElement() {
      return selectedElement;
    },
    updateSelected: updateSelectedHighlight,
    // é€šè¿‡æ¶ˆæ¯å‘é€å¼€å…³æ§åˆ¶
    sendToggleMessage: function sendToggleMessage(enabled) {
      window.parent.postMessage({
        type: 'iframe-highlight-status',
        enabled: enabled || highlightEnabled,
        source: 'iframe-highlight-injector'
      }, '*');
    }
  };

  // é€šçŸ¥çˆ¶çª—å£è„šæœ¬å·²åŠ è½½
  try {
    window.parent.postMessage({
      type: "iframe-highlight-ready",
      data: {
        url: window.location.href,
        userAgent: navigator.userAgent,
        timestamp: Date.now()
      },
      source: "iframe-highlight-injector"
    }, "*");
  } catch (error) {
    console.warn("æ— æ³•å‘é€å°±ç»ªæ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
  }

  // æ¸…ç†å‡½æ•°
  window.__iframeHighlightCleanup = function () {
    fullyDisableHighlight();
    window.removeEventListener("message", handleParentMessage);
    if (overlay.parentElement) {
      overlay.parentElement.removeChild(overlay);
    }
    delete window.__iframeHighlightInitialized;
    delete window.__iframeHighlightCleanup;
  };
})();

</script>

<script>
/**
 * Iframe å…ƒç´ é«˜äº®æ³¨å…¥è„šæœ¬
 * éœ€è¦åœ¨ç›®æ ‡ç½‘ç«™ä¸­å¼•å…¥æ­¤è„šæœ¬æ¥æ”¯æŒè·¨åŸŸ iframe é«˜äº®åŠŸèƒ½
 *
 * ä½¿ç”¨æ–¹æ³•ï¼š
 * 1. å°†æ­¤è„šæœ¬æ·»åŠ åˆ°ç›®æ ‡ç½‘ç«™çš„ HTML ä¸­
 * 2. æˆ–é€šè¿‡æµè§ˆå™¨æ‰©å±•ã€ç”¨æˆ·è„šæœ¬ç­‰æ–¹å¼æ³¨å…¥
 */

(function () {
  "use strict";

  // æ£€æŸ¥æ˜¯å¦åœ¨ iframe ä¸­
  if (window.self === window.top) {
    return; // ä¸åœ¨ iframe ä¸­ï¼Œä¸æ‰§è¡Œ
  }

  // æ£€æŸ¥æ˜¯å¦å·²ç»åˆå§‹åŒ–è¿‡
  if (window.__iframeHighlightInitialized) {
    return;
  }
  window.__iframeHighlightInitialized = true;
  console.log("Iframe é«˜äº®è„šæœ¬å·²åŠ è½½");

  // åˆ›å»ºé«˜äº®è¦†ç›–å±‚
  var overlay = document.createElement("div");
  overlay.id = "iframe-highlight-overlay";
  overlay.style.cssText = "\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    pointer-events: none;\n    z-index: 999999;\n    overflow: hidden;\n  ";

  // åˆ›å»ºæ‚¬åœé«˜äº®æ¡†ï¼ˆè™šçº¿è¾¹æ¡†ï¼‰
  var highlightBox = document.createElement("div");
  highlightBox.id = "iframe-highlight-box";
  highlightBox.style.cssText = "\n    position: absolute;\n    border: 2px dashed #007AFF;\n    background: rgba(0, 122, 255, 0.08);\n    pointer-events: none;\n    display: none;\n    transition: all 0.1s ease;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);\n    border-radius: 2px;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹çš„å¸¸é©»é«˜äº®æ¡†ï¼ˆå®çº¿è¾¹æ¡†ï¼‰
  var selectedBox = document.createElement("div");
  selectedBox.id = "iframe-selected-box";
  selectedBox.style.cssText = "\n    position: absolute;\n    border: 2px solid #007AFF;\n    pointer-events: none;\n    display: none;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 107, 53, 0.4);\n    border-radius: 2px;\n    z-index: 1000000;\n  ";

  // åˆ›å»ºæ‚¬åœæ ‡ç­¾æ˜¾ç¤º
  var tagLabel = document.createElement("div");
  tagLabel.id = "iframe-tag-label";
  tagLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 2px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000001;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    font-weight: 500;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹æ ‡ç­¾
  var selectedLabel = document.createElement("div");
  selectedLabel.id = "iframe-selected-label";
  selectedLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 3px 8px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 3px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000002;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);\n    font-weight: 600;\n  ";
  overlay.appendChild(highlightBox);
  overlay.appendChild(selectedBox);
  overlay.appendChild(tagLabel);
  overlay.appendChild(selectedLabel);
  document.body.appendChild(overlay);

  // å­˜å‚¨å½“å‰é€‰ä¸­çš„å…ƒç´ 
  var selectedElement = null;
  var highlightEnabled = false;

  // æ›´æ–°é€‰ä¸­å…ƒç´ çš„é«˜äº®æ˜¾ç¤º
  function updateSelectedHighlight(element) {
    console.log("updateSelectedHighlight called with:", element);
    if (!element) {
      selectedBox.style.display = "none";
      selectedLabel.style.display = "none";
      selectedElement = null;
      console.log("Cleared selected highlight");
      return;
    }
    selectedElement = element;
    var rect = element.getBoundingClientRect();
    console.log("Selected element rect:", rect);

    // æ›´æ–°é€‰ä¸­é«˜äº®æ¡†ä½ç½®
    selectedBox.style.display = "block";
    selectedBox.style.left = "".concat(rect.left - 2, "px");
    selectedBox.style.top = "".concat(rect.top - 2, "px");
    selectedBox.style.width = "".concat(rect.width + 4, "px");
    selectedBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°é€‰ä¸­æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    selectedLabel.style.display = "block";
    selectedLabel.textContent = "\u2713 <".concat(element.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 28;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 5) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    var labelWidth = selectedLabel.offsetWidth || 100; // é¢„ä¼°å®½åº¦
    if (labelLeft + labelWidth > window.innerWidth - 10) {
      labelLeft = window.innerWidth - labelWidth - 10;
    }
    selectedLabel.style.left = "".concat(Math.max(5, labelLeft), "px");
    selectedLabel.style.top = "".concat(labelTop, "px");
    console.log("Selected highlight positioned at:", {
      left: selectedBox.style.left,
      top: selectedBox.style.top,
      width: selectedBox.style.width,
      height: selectedBox.style.height
    });
  }
  function getElementSelector(element) {
    if (!(element instanceof Element)) throw new Error('Argument must be a DOM element');
    var segments = [];
    var current = element;
    while (current !== document.documentElement) {
      var selector = '';
      // ä¼˜å…ˆæ£€æŸ¥å”¯ä¸€ID
      if (current.id && document.querySelectorAll("#".concat(current.id)).length === 1) {
        segments.unshift("#".concat(current.id));
        break; // IDå”¯ä¸€ï¼Œæ— éœ€ç»§ç»­å‘ä¸Š
      }

      // ç”Ÿæˆç±»åé€‰æ‹©å™¨ï¼ˆå–ç¬¬ä¸€ä¸ªæœ‰æ•ˆç±»åï¼‰
      var classes = Array.from(current.classList).filter(function (c) {
        return !c.startsWith('js-');
      });
      var className = classes.length > 0 ? ".".concat(classes[0]) : '';

      // ç”Ÿæˆä½ç½®ç´¢å¼•ï¼ˆnth-childï¼‰
      var tag = current.tagName.toLowerCase();
      if (!className) {
        var siblings = Array.from(current.parentNode.children);
        var index = siblings.findIndex(function (el) {
          return el === current;
        }) + 1;
        selector = "".concat(tag, ":nth-child(").concat(index, ")");
      } else {
        selector = className;
      }
      segments.unshift(selector);
      current = current.parentElement;
    }

    // å¤„ç†æ ¹å…ƒç´ 
    if (current === document.documentElement) {
      segments.unshift('html');
    }
    return segments.join(' > ');
  }

  // è·å–å…ƒç´ æ–‡æœ¬å†…å®¹
  function getElementText(element) {
    var _element$textContent;
    if (element.tagName === "INPUT") {
      return element.value || element.placeholder || "";
    }
    if (element.tagName === "TEXTAREA") {
      return element.value || element.placeholder || "";
    }
    var text = ((_element$textContent = element.textContent) === null || _element$textContent === void 0 ? void 0 : _element$textContent.trim()) || "";
    return text.length > 50 ? text.substring(0, 50) + "..." : text;
  }

  // è·å–å…ƒç´ å±æ€§ä¿¡æ¯
  function getElementAttributes(element) {
    var attrs = {};
    for (var i = 0; i < element.attributes.length; i++) {
      var attr = element.attributes[i];
      attrs[attr.name] = attr.value;
    }
    return attrs;
  }

  // é¼ æ ‡æ‚¬åœäº‹ä»¶å¤„ç†
  function handleMouseOver(e) {
    if (!highlightEnabled) return;
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…é«˜äº® html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // å¦‚æœæ˜¯å·²é€‰ä¸­çš„å…ƒç´ ï¼Œä¸æ˜¾ç¤ºæ‚¬åœé«˜äº®
    if (target === selectedElement) {
      highlightBox.style.display = "none";
      tagLabel.style.display = "none";
      return;
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);

    // æ›´æ–°æ‚¬åœé«˜äº®æ¡†ä½ç½®
    highlightBox.style.display = "block";
    highlightBox.style.left = "".concat(rect.left - 2, "px");
    highlightBox.style.top = "".concat(rect.top - 2, "px");
    highlightBox.style.width = "".concat(rect.width + 4, "px");
    highlightBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    tagLabel.style.display = "block";
    tagLabel.textContent = "<".concat(target.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 22;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 0) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    if (labelLeft + tagLabel.offsetWidth > window.innerWidth) {
      labelLeft = window.innerWidth - tagLabel.offsetWidth - 5;
    }
    tagLabel.style.left = "".concat(Math.max(0, labelLeft), "px");
    tagLabel.style.top = "".concat(labelTop, "px");

    // å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // é¼ æ ‡ç¦»å¼€äº‹ä»¶å¤„ç†
  function handleMouseOut(e) {
    if (!highlightEnabled) return;
    var relatedTarget = e.relatedTarget;

    // å¦‚æœé¼ æ ‡ç§»åŠ¨åˆ°é«˜äº®ç›¸å…³å…ƒç´ ä¸Šï¼Œä¸éšè—é«˜äº®
    if (relatedTarget && (relatedTarget === highlightBox || relatedTarget === tagLabel || relatedTarget === overlay || relatedTarget === selectedBox || relatedTarget === selectedLabel)) {
      return;
    }
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: null,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç‚¹å‡»äº‹ä»¶å¤„ç†
  function handleClick(e) {
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…å¤„ç† html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // æ£€æŸ¥æ˜¯å¦æ˜¯äº¤äº’å…ƒç´ ï¼Œè¿™äº›å…ƒç´ éœ€è¦ä¿ç•™é»˜è®¤è¡Œä¸º
    var isInteractiveElement = ['input', 'textarea', 'select', 'button', 'a'].includes(target.tagName.toLowerCase());

    // å¦‚æœé«˜äº®åŠŸèƒ½å¯ç”¨ï¼Œå¯¹äºéäº¤äº’å…ƒç´ é˜»æ­¢é»˜è®¤è¡Œä¸ºå’Œäº‹ä»¶ä¼ æ’­
    if (highlightEnabled) {
      e.preventDefault();
      e.stopPropagation();
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);
    console.log("Element clicked:", {
      tagName: target.tagName,
      selector: selector,
      rect: rect
    });

    // ç«‹å³æ›´æ–°é€‰ä¸­é«˜äº®
    updateSelectedHighlight(target);

    // éšè—æ‚¬åœé«˜äº®ï¼Œå› ä¸ºç°åœ¨æ˜¯é€‰ä¸­çŠ¶æ€
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-click",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç›‘å¬æ¥è‡ªçˆ¶çª—å£çš„æ¶ˆæ¯
  function handleParentMessage(event) {
    console.log("Received message from parent:", event.data);
    if (event.data.type === "iframe-highlight-toggle") {
      var enabled = event.data.enabled;
      console.log("Highlight toggle:", enabled);
      if (enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "enable-iframe-highlight") {
      console.log("Enable iframe highlight");
      enableHighlight();
    } else if (event.data.type === "disable-iframe-highlight") {
      console.log("Disable iframe highlight");
      disableHighlight();
    } else if (event.data.type === "toggle-iframe-highlight") {
      var _enabled = event.data.enabled !== undefined ? event.data.enabled : !highlightEnabled;
      console.log("Toggle iframe highlight to:", _enabled);
      if (_enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "update-selected-element") {
      var selector = event.data.selector;
      console.log("Update selected element with selector:", selector);
      if (selector) {
        try {
          var element = document.querySelector(selector);
          console.log("Found element by selector:", element);
          updateSelectedHighlight(element);
        } catch (error) {
          console.warn("Failed to select element:", error);
          updateSelectedHighlight(null);
        }
      } else {
        updateSelectedHighlight(null);
      }
    } else if (event.data.type === "clear-selected-element") {
      console.log("Clear selected element");
      updateSelectedHighlight(null);
    }
  }

  // å¯ç”¨é«˜äº®åŠŸèƒ½
  function enableHighlight() {
    console.log("Enabling highlight");
    document.addEventListener("mouseover", handleMouseOver, true);
    document.addEventListener("mouseout", handleMouseOut, true);
    document.addEventListener("click", handleClick, true);
    highlightEnabled = true;
    overlay.style.display = "block";
  }

  // ç¦ç”¨é«˜äº®åŠŸèƒ½
  function disableHighlight() {
    console.log("Disabling highlight");
    highlightEnabled = false;
    // ä¿æŒäº‹ä»¶ç›‘å¬å™¨ï¼Œä½†é€šè¿‡ highlightEnabled å˜é‡æ§åˆ¶è¡Œä¸º
    // è¿™æ ·å¯ä»¥ä¿ç•™é€‰ä¸­çŠ¶æ€çš„æ˜¾ç¤º
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    // ä¸éšè— selectedBox å’Œ selectedLabelï¼Œä¿ç•™é€‰ä¸­çŠ¶æ€
  }

  // å®Œå…¨ç¦ç”¨é«˜äº®åŠŸèƒ½ï¼ˆç§»é™¤æ‰€æœ‰ç›‘å¬å™¨ï¼‰
  function fullyDisableHighlight() {
    console.log("Fully disabling highlight");
    highlightEnabled = false;
    document.removeEventListener("mouseover", handleMouseOver, true);
    document.removeEventListener("mouseout", handleMouseOut, true);
    document.removeEventListener("click", handleClick, true);
    overlay.style.display = "none";
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    selectedBox.style.display = "none";
    selectedLabel.style.display = "none";
  }

  // æ·»åŠ äº‹ä»¶ç›‘å¬
  enableHighlight();
  window.addEventListener("message", handleParentMessage);

  // æš´éœ²å…¨å±€å‡½æ•°ä¾›å¤–éƒ¨è°ƒç”¨
  window.__iframeHighlightControl = {
    enable: enableHighlight,
    disable: disableHighlight,
    fullyDisable: fullyDisableHighlight,
    isEnabled: function isEnabled() {
      return highlightEnabled;
    },
    getSelectedElement: function getSelectedElement() {
      return selectedElement;
    },
    updateSelected: updateSelectedHighlight,
    // é€šè¿‡æ¶ˆæ¯å‘é€å¼€å…³æ§åˆ¶
    sendToggleMessage: function sendToggleMessage(enabled) {
      window.parent.postMessage({
        type: 'iframe-highlight-status',
        enabled: enabled || highlightEnabled,
        source: 'iframe-highlight-injector'
      }, '*');
    }
  };

  // é€šçŸ¥çˆ¶çª—å£è„šæœ¬å·²åŠ è½½
  try {
    window.parent.postMessage({
      type: "iframe-highlight-ready",
      data: {
        url: window.location.href,
        userAgent: navigator.userAgent,
        timestamp: Date.now()
      },
      source: "iframe-highlight-injector"
    }, "*");
  } catch (error) {
    console.warn("æ— æ³•å‘é€å°±ç»ªæ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
  }

  // æ¸…ç†å‡½æ•°
  window.__iframeHighlightCleanup = function () {
    fullyDisableHighlight();
    window.removeEventListener("message", handleParentMessage);
    if (overlay.parentElement) {
      overlay.parentElement.removeChild(overlay);
    }
    delete window.__iframeHighlightInitialized;
    delete window.__iframeHighlightCleanup;
  };
})();

</script>

<script>
/**
 * Iframe å…ƒç´ é«˜äº®æ³¨å…¥è„šæœ¬
 * éœ€è¦åœ¨ç›®æ ‡ç½‘ç«™ä¸­å¼•å…¥æ­¤è„šæœ¬æ¥æ”¯æŒè·¨åŸŸ iframe é«˜äº®åŠŸèƒ½
 *
 * ä½¿ç”¨æ–¹æ³•ï¼š
 * 1. å°†æ­¤è„šæœ¬æ·»åŠ åˆ°ç›®æ ‡ç½‘ç«™çš„ HTML ä¸­
 * 2. æˆ–é€šè¿‡æµè§ˆå™¨æ‰©å±•ã€ç”¨æˆ·è„šæœ¬ç­‰æ–¹å¼æ³¨å…¥
 */

(function () {
  "use strict";

  // æ£€æŸ¥æ˜¯å¦åœ¨ iframe ä¸­
  if (window.self === window.top) {
    return; // ä¸åœ¨ iframe ä¸­ï¼Œä¸æ‰§è¡Œ
  }

  // æ£€æŸ¥æ˜¯å¦å·²ç»åˆå§‹åŒ–è¿‡
  if (window.__iframeHighlightInitialized) {
    return;
  }
  window.__iframeHighlightInitialized = true;
  console.log("Iframe é«˜äº®è„šæœ¬å·²åŠ è½½");

  // åˆ›å»ºé«˜äº®è¦†ç›–å±‚
  var overlay = document.createElement("div");
  overlay.id = "iframe-highlight-overlay";
  overlay.style.cssText = "\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    pointer-events: none;\n    z-index: 999999;\n    overflow: hidden;\n  ";

  // åˆ›å»ºæ‚¬åœé«˜äº®æ¡†ï¼ˆè™šçº¿è¾¹æ¡†ï¼‰
  var highlightBox = document.createElement("div");
  highlightBox.id = "iframe-highlight-box";
  highlightBox.style.cssText = "\n    position: absolute;\n    border: 2px dashed #007AFF;\n    background: rgba(0, 122, 255, 0.08);\n    pointer-events: none;\n    display: none;\n    transition: all 0.1s ease;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);\n    border-radius: 2px;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹çš„å¸¸é©»é«˜äº®æ¡†ï¼ˆå®çº¿è¾¹æ¡†ï¼‰
  var selectedBox = document.createElement("div");
  selectedBox.id = "iframe-selected-box";
  selectedBox.style.cssText = "\n    position: absolute;\n    border: 2px solid #007AFF;\n    pointer-events: none;\n    display: none;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 107, 53, 0.4);\n    border-radius: 2px;\n    z-index: 1000000;\n  ";

  // åˆ›å»ºæ‚¬åœæ ‡ç­¾æ˜¾ç¤º
  var tagLabel = document.createElement("div");
  tagLabel.id = "iframe-tag-label";
  tagLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 2px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000001;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    font-weight: 500;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹æ ‡ç­¾
  var selectedLabel = document.createElement("div");
  selectedLabel.id = "iframe-selected-label";
  selectedLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 3px 8px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 3px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000002;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);\n    font-weight: 600;\n  ";
  overlay.appendChild(highlightBox);
  overlay.appendChild(selectedBox);
  overlay.appendChild(tagLabel);
  overlay.appendChild(selectedLabel);
  document.body.appendChild(overlay);

  // å­˜å‚¨å½“å‰é€‰ä¸­çš„å…ƒç´ 
  var selectedElement = null;
  var highlightEnabled = false;

  // æ›´æ–°é€‰ä¸­å…ƒç´ çš„é«˜äº®æ˜¾ç¤º
  function updateSelectedHighlight(element) {
    console.log("updateSelectedHighlight called with:", element);
    if (!element) {
      selectedBox.style.display = "none";
      selectedLabel.style.display = "none";
      selectedElement = null;
      console.log("Cleared selected highlight");
      return;
    }
    selectedElement = element;
    var rect = element.getBoundingClientRect();
    console.log("Selected element rect:", rect);

    // æ›´æ–°é€‰ä¸­é«˜äº®æ¡†ä½ç½®
    selectedBox.style.display = "block";
    selectedBox.style.left = "".concat(rect.left - 2, "px");
    selectedBox.style.top = "".concat(rect.top - 2, "px");
    selectedBox.style.width = "".concat(rect.width + 4, "px");
    selectedBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°é€‰ä¸­æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    selectedLabel.style.display = "block";
    selectedLabel.textContent = "\u2713 <".concat(element.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 28;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 5) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    var labelWidth = selectedLabel.offsetWidth || 100; // é¢„ä¼°å®½åº¦
    if (labelLeft + labelWidth > window.innerWidth - 10) {
      labelLeft = window.innerWidth - labelWidth - 10;
    }
    selectedLabel.style.left = "".concat(Math.max(5, labelLeft), "px");
    selectedLabel.style.top = "".concat(labelTop, "px");
    console.log("Selected highlight positioned at:", {
      left: selectedBox.style.left,
      top: selectedBox.style.top,
      width: selectedBox.style.width,
      height: selectedBox.style.height
    });
  }
  function getElementSelector(element) {
    if (!(element instanceof Element)) throw new Error('Argument must be a DOM element');
    var segments = [];
    var current = element;
    while (current !== document.documentElement) {
      var selector = '';
      // ä¼˜å…ˆæ£€æŸ¥å”¯ä¸€ID
      if (current.id && document.querySelectorAll("#".concat(current.id)).length === 1) {
        segments.unshift("#".concat(current.id));
        break; // IDå”¯ä¸€ï¼Œæ— éœ€ç»§ç»­å‘ä¸Š
      }

      // ç”Ÿæˆç±»åé€‰æ‹©å™¨ï¼ˆå–ç¬¬ä¸€ä¸ªæœ‰æ•ˆç±»åï¼‰
      var classes = Array.from(current.classList).filter(function (c) {
        return !c.startsWith('js-');
      });
      var className = classes.length > 0 ? ".".concat(classes[0]) : '';

      // ç”Ÿæˆä½ç½®ç´¢å¼•ï¼ˆnth-childï¼‰
      var tag = current.tagName.toLowerCase();
      if (!className) {
        var siblings = Array.from(current.parentNode.children);
        var index = siblings.findIndex(function (el) {
          return el === current;
        }) + 1;
        selector = "".concat(tag, ":nth-child(").concat(index, ")");
      } else {
        selector = className;
      }
      segments.unshift(selector);
      current = current.parentElement;
    }

    // å¤„ç†æ ¹å…ƒç´ 
    if (current === document.documentElement) {
      segments.unshift('html');
    }
    return segments.join(' > ');
  }

  // è·å–å…ƒç´ æ–‡æœ¬å†…å®¹
  function getElementText(element) {
    var _element$textContent;
    if (element.tagName === "INPUT") {
      return element.value || element.placeholder || "";
    }
    if (element.tagName === "TEXTAREA") {
      return element.value || element.placeholder || "";
    }
    var text = ((_element$textContent = element.textContent) === null || _element$textContent === void 0 ? void 0 : _element$textContent.trim()) || "";
    return text.length > 50 ? text.substring(0, 50) + "..." : text;
  }

  // è·å–å…ƒç´ å±æ€§ä¿¡æ¯
  function getElementAttributes(element) {
    var attrs = {};
    for (var i = 0; i < element.attributes.length; i++) {
      var attr = element.attributes[i];
      attrs[attr.name] = attr.value;
    }
    return attrs;
  }

  // é¼ æ ‡æ‚¬åœäº‹ä»¶å¤„ç†
  function handleMouseOver(e) {
    if (!highlightEnabled) return;
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…é«˜äº® html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // å¦‚æœæ˜¯å·²é€‰ä¸­çš„å…ƒç´ ï¼Œä¸æ˜¾ç¤ºæ‚¬åœé«˜äº®
    if (target === selectedElement) {
      highlightBox.style.display = "none";
      tagLabel.style.display = "none";
      return;
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);

    // æ›´æ–°æ‚¬åœé«˜äº®æ¡†ä½ç½®
    highlightBox.style.display = "block";
    highlightBox.style.left = "".concat(rect.left - 2, "px");
    highlightBox.style.top = "".concat(rect.top - 2, "px");
    highlightBox.style.width = "".concat(rect.width + 4, "px");
    highlightBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    tagLabel.style.display = "block";
    tagLabel.textContent = "<".concat(target.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 22;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 0) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    if (labelLeft + tagLabel.offsetWidth > window.innerWidth) {
      labelLeft = window.innerWidth - tagLabel.offsetWidth - 5;
    }
    tagLabel.style.left = "".concat(Math.max(0, labelLeft), "px");
    tagLabel.style.top = "".concat(labelTop, "px");

    // å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // é¼ æ ‡ç¦»å¼€äº‹ä»¶å¤„ç†
  function handleMouseOut(e) {
    if (!highlightEnabled) return;
    var relatedTarget = e.relatedTarget;

    // å¦‚æœé¼ æ ‡ç§»åŠ¨åˆ°é«˜äº®ç›¸å…³å…ƒç´ ä¸Šï¼Œä¸éšè—é«˜äº®
    if (relatedTarget && (relatedTarget === highlightBox || relatedTarget === tagLabel || relatedTarget === overlay || relatedTarget === selectedBox || relatedTarget === selectedLabel)) {
      return;
    }
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: null,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç‚¹å‡»äº‹ä»¶å¤„ç†
  function handleClick(e) {
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…å¤„ç† html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // æ£€æŸ¥æ˜¯å¦æ˜¯äº¤äº’å…ƒç´ ï¼Œè¿™äº›å…ƒç´ éœ€è¦ä¿ç•™é»˜è®¤è¡Œä¸º
    var isInteractiveElement = ['input', 'textarea', 'select', 'button', 'a'].includes(target.tagName.toLowerCase());

    // å¦‚æœé«˜äº®åŠŸèƒ½å¯ç”¨ï¼Œå¯¹äºéäº¤äº’å…ƒç´ é˜»æ­¢é»˜è®¤è¡Œä¸ºå’Œäº‹ä»¶ä¼ æ’­
    if (highlightEnabled) {
      e.preventDefault();
      e.stopPropagation();
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);
    console.log("Element clicked:", {
      tagName: target.tagName,
      selector: selector,
      rect: rect
    });

    // ç«‹å³æ›´æ–°é€‰ä¸­é«˜äº®
    updateSelectedHighlight(target);

    // éšè—æ‚¬åœé«˜äº®ï¼Œå› ä¸ºç°åœ¨æ˜¯é€‰ä¸­çŠ¶æ€
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-click",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç›‘å¬æ¥è‡ªçˆ¶çª—å£çš„æ¶ˆæ¯
  function handleParentMessage(event) {
    console.log("Received message from parent:", event.data);
    if (event.data.type === "iframe-highlight-toggle") {
      var enabled = event.data.enabled;
      console.log("Highlight toggle:", enabled);
      if (enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "enable-iframe-highlight") {
      console.log("Enable iframe highlight");
      enableHighlight();
    } else if (event.data.type === "disable-iframe-highlight") {
      console.log("Disable iframe highlight");
      disableHighlight();
    } else if (event.data.type === "toggle-iframe-highlight") {
      var _enabled = event.data.enabled !== undefined ? event.data.enabled : !highlightEnabled;
      console.log("Toggle iframe highlight to:", _enabled);
      if (_enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "update-selected-element") {
      var selector = event.data.selector;
      console.log("Update selected element with selector:", selector);
      if (selector) {
        try {
          var element = document.querySelector(selector);
          console.log("Found element by selector:", element);
          updateSelectedHighlight(element);
        } catch (error) {
          console.warn("Failed to select element:", error);
          updateSelectedHighlight(null);
        }
      } else {
        updateSelectedHighlight(null);
      }
    } else if (event.data.type === "clear-selected-element") {
      console.log("Clear selected element");
      updateSelectedHighlight(null);
    }
  }

  // å¯ç”¨é«˜äº®åŠŸèƒ½
  function enableHighlight() {
    console.log("Enabling highlight");
    document.addEventListener("mouseover", handleMouseOver, true);
    document.addEventListener("mouseout", handleMouseOut, true);
    document.addEventListener("click", handleClick, true);
    highlightEnabled = true;
    overlay.style.display = "block";
  }

  // ç¦ç”¨é«˜äº®åŠŸèƒ½
  function disableHighlight() {
    console.log("Disabling highlight");
    highlightEnabled = false;
    // ä¿æŒäº‹ä»¶ç›‘å¬å™¨ï¼Œä½†é€šè¿‡ highlightEnabled å˜é‡æ§åˆ¶è¡Œä¸º
    // è¿™æ ·å¯ä»¥ä¿ç•™é€‰ä¸­çŠ¶æ€çš„æ˜¾ç¤º
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    // ä¸éšè— selectedBox å’Œ selectedLabelï¼Œä¿ç•™é€‰ä¸­çŠ¶æ€
  }

  // å®Œå…¨ç¦ç”¨é«˜äº®åŠŸèƒ½ï¼ˆç§»é™¤æ‰€æœ‰ç›‘å¬å™¨ï¼‰
  function fullyDisableHighlight() {
    console.log("Fully disabling highlight");
    highlightEnabled = false;
    document.removeEventListener("mouseover", handleMouseOver, true);
    document.removeEventListener("mouseout", handleMouseOut, true);
    document.removeEventListener("click", handleClick, true);
    overlay.style.display = "none";
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    selectedBox.style.display = "none";
    selectedLabel.style.display = "none";
  }

  // æ·»åŠ äº‹ä»¶ç›‘å¬
  enableHighlight();
  window.addEventListener("message", handleParentMessage);

  // æš´éœ²å…¨å±€å‡½æ•°ä¾›å¤–éƒ¨è°ƒç”¨
  window.__iframeHighlightControl = {
    enable: enableHighlight,
    disable: disableHighlight,
    fullyDisable: fullyDisableHighlight,
    isEnabled: function isEnabled() {
      return highlightEnabled;
    },
    getSelectedElement: function getSelectedElement() {
      return selectedElement;
    },
    updateSelected: updateSelectedHighlight,
    // é€šè¿‡æ¶ˆæ¯å‘é€å¼€å…³æ§åˆ¶
    sendToggleMessage: function sendToggleMessage(enabled) {
      window.parent.postMessage({
        type: 'iframe-highlight-status',
        enabled: enabled || highlightEnabled,
        source: 'iframe-highlight-injector'
      }, '*');
    }
  };

  // é€šçŸ¥çˆ¶çª—å£è„šæœ¬å·²åŠ è½½
  try {
    window.parent.postMessage({
      type: "iframe-highlight-ready",
      data: {
        url: window.location.href,
        userAgent: navigator.userAgent,
        timestamp: Date.now()
      },
      source: "iframe-highlight-injector"
    }, "*");
  } catch (error) {
    console.warn("æ— æ³•å‘é€å°±ç»ªæ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
  }

  // æ¸…ç†å‡½æ•°
  window.__iframeHighlightCleanup = function () {
    fullyDisableHighlight();
    window.removeEventListener("message", handleParentMessage);
    if (overlay.parentElement) {
      overlay.parentElement.removeChild(overlay);
    }
    delete window.__iframeHighlightInitialized;
    delete window.__iframeHighlightCleanup;
  };
})();

</script>

<script>
/**
 * Iframe å…ƒç´ é«˜äº®æ³¨å…¥è„šæœ¬
 * éœ€è¦åœ¨ç›®æ ‡ç½‘ç«™ä¸­å¼•å…¥æ­¤è„šæœ¬æ¥æ”¯æŒè·¨åŸŸ iframe é«˜äº®åŠŸèƒ½
 *
 * ä½¿ç”¨æ–¹æ³•ï¼š
 * 1. å°†æ­¤è„šæœ¬æ·»åŠ åˆ°ç›®æ ‡ç½‘ç«™çš„ HTML ä¸­
 * 2. æˆ–é€šè¿‡æµè§ˆå™¨æ‰©å±•ã€ç”¨æˆ·è„šæœ¬ç­‰æ–¹å¼æ³¨å…¥
 */

(function () {
  "use strict";

  // æ£€æŸ¥æ˜¯å¦åœ¨ iframe ä¸­
  if (window.self === window.top) {
    return; // ä¸åœ¨ iframe ä¸­ï¼Œä¸æ‰§è¡Œ
  }

  // æ£€æŸ¥æ˜¯å¦å·²ç»åˆå§‹åŒ–è¿‡
  if (window.__iframeHighlightInitialized) {
    return;
  }
  window.__iframeHighlightInitialized = true;
  console.log("Iframe é«˜äº®è„šæœ¬å·²åŠ è½½");

  // åˆ›å»ºé«˜äº®è¦†ç›–å±‚
  var overlay = document.createElement("div");
  overlay.id = "iframe-highlight-overlay";
  overlay.style.cssText = "\n    position: fixed;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100vh;\n    pointer-events: none;\n    z-index: 999999;\n    overflow: hidden;\n  ";

  // åˆ›å»ºæ‚¬åœé«˜äº®æ¡†ï¼ˆè™šçº¿è¾¹æ¡†ï¼‰
  var highlightBox = document.createElement("div");
  highlightBox.id = "iframe-highlight-box";
  highlightBox.style.cssText = "\n    position: absolute;\n    border: 2px dashed #007AFF;\n    background: rgba(0, 122, 255, 0.08);\n    pointer-events: none;\n    display: none;\n    transition: all 0.1s ease;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.8);\n    border-radius: 2px;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹çš„å¸¸é©»é«˜äº®æ¡†ï¼ˆå®çº¿è¾¹æ¡†ï¼‰
  var selectedBox = document.createElement("div");
  selectedBox.id = "iframe-selected-box";
  selectedBox.style.cssText = "\n    position: absolute;\n    border: 2px solid #007AFF;\n    pointer-events: none;\n    display: none;\n    box-shadow: 0 0 0 1px rgba(255, 255, 255, 0.9), 0 0 8px rgba(255, 107, 53, 0.4);\n    border-radius: 2px;\n    z-index: 1000000;\n  ";

  // åˆ›å»ºæ‚¬åœæ ‡ç­¾æ˜¾ç¤º
  var tagLabel = document.createElement("div");
  tagLabel.id = "iframe-tag-label";
  tagLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 2px 6px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 2px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000001;\n    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.3);\n    font-weight: 500;\n  ";

  // åˆ›å»ºé€‰ä¸­èŠ‚ç‚¹æ ‡ç­¾
  var selectedLabel = document.createElement("div");
  selectedLabel.id = "iframe-selected-label";
  selectedLabel.style.cssText = "\n    position: absolute;\n    background: #007AFF;\n    color: white;\n    padding: 3px 8px;\n    font-size: 11px;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n    border-radius: 3px;\n    pointer-events: none;\n    display: none;\n    white-space: nowrap;\n    z-index: 1000002;\n    box-shadow: 0 2px 6px rgba(0, 0, 0, 0.4);\n    font-weight: 600;\n  ";
  overlay.appendChild(highlightBox);
  overlay.appendChild(selectedBox);
  overlay.appendChild(tagLabel);
  overlay.appendChild(selectedLabel);
  document.body.appendChild(overlay);

  // å­˜å‚¨å½“å‰é€‰ä¸­çš„å…ƒç´ 
  var selectedElement = null;
  var highlightEnabled = false;

  // æ›´æ–°é€‰ä¸­å…ƒç´ çš„é«˜äº®æ˜¾ç¤º
  function updateSelectedHighlight(element) {
    console.log("updateSelectedHighlight called with:", element);
    if (!element) {
      selectedBox.style.display = "none";
      selectedLabel.style.display = "none";
      selectedElement = null;
      console.log("Cleared selected highlight");
      return;
    }
    selectedElement = element;
    var rect = element.getBoundingClientRect();
    console.log("Selected element rect:", rect);

    // æ›´æ–°é€‰ä¸­é«˜äº®æ¡†ä½ç½®
    selectedBox.style.display = "block";
    selectedBox.style.left = "".concat(rect.left - 2, "px");
    selectedBox.style.top = "".concat(rect.top - 2, "px");
    selectedBox.style.width = "".concat(rect.width + 4, "px");
    selectedBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°é€‰ä¸­æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    selectedLabel.style.display = "block";
    selectedLabel.textContent = "\u2713 <".concat(element.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 28;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 5) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    var labelWidth = selectedLabel.offsetWidth || 100; // é¢„ä¼°å®½åº¦
    if (labelLeft + labelWidth > window.innerWidth - 10) {
      labelLeft = window.innerWidth - labelWidth - 10;
    }
    selectedLabel.style.left = "".concat(Math.max(5, labelLeft), "px");
    selectedLabel.style.top = "".concat(labelTop, "px");
    console.log("Selected highlight positioned at:", {
      left: selectedBox.style.left,
      top: selectedBox.style.top,
      width: selectedBox.style.width,
      height: selectedBox.style.height
    });
  }
  function getElementSelector(element) {
    if (!(element instanceof Element)) throw new Error('Argument must be a DOM element');
    var segments = [];
    var current = element;
    while (current !== document.documentElement) {
      var selector = '';
      // ä¼˜å…ˆæ£€æŸ¥å”¯ä¸€ID
      if (current.id && document.querySelectorAll("#".concat(current.id)).length === 1) {
        segments.unshift("#".concat(current.id));
        break; // IDå”¯ä¸€ï¼Œæ— éœ€ç»§ç»­å‘ä¸Š
      }

      // ç”Ÿæˆç±»åé€‰æ‹©å™¨ï¼ˆå–ç¬¬ä¸€ä¸ªæœ‰æ•ˆç±»åï¼‰
      var classes = Array.from(current.classList).filter(function (c) {
        return !c.startsWith('js-');
      });
      var className = classes.length > 0 ? ".".concat(classes[0]) : '';

      // ç”Ÿæˆä½ç½®ç´¢å¼•ï¼ˆnth-childï¼‰
      var tag = current.tagName.toLowerCase();
      if (!className) {
        var siblings = Array.from(current.parentNode.children);
        var index = siblings.findIndex(function (el) {
          return el === current;
        }) + 1;
        selector = "".concat(tag, ":nth-child(").concat(index, ")");
      } else {
        selector = className;
      }
      segments.unshift(selector);
      current = current.parentElement;
    }

    // å¤„ç†æ ¹å…ƒç´ 
    if (current === document.documentElement) {
      segments.unshift('html');
    }
    return segments.join(' > ');
  }

  // è·å–å…ƒç´ æ–‡æœ¬å†…å®¹
  function getElementText(element) {
    var _element$textContent;
    if (element.tagName === "INPUT") {
      return element.value || element.placeholder || "";
    }
    if (element.tagName === "TEXTAREA") {
      return element.value || element.placeholder || "";
    }
    var text = ((_element$textContent = element.textContent) === null || _element$textContent === void 0 ? void 0 : _element$textContent.trim()) || "";
    return text.length > 50 ? text.substring(0, 50) + "..." : text;
  }

  // è·å–å…ƒç´ å±æ€§ä¿¡æ¯
  function getElementAttributes(element) {
    var attrs = {};
    for (var i = 0; i < element.attributes.length; i++) {
      var attr = element.attributes[i];
      attrs[attr.name] = attr.value;
    }
    return attrs;
  }

  // é¼ æ ‡æ‚¬åœäº‹ä»¶å¤„ç†
  function handleMouseOver(e) {
    if (!highlightEnabled) return;
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…é«˜äº® html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // å¦‚æœæ˜¯å·²é€‰ä¸­çš„å…ƒç´ ï¼Œä¸æ˜¾ç¤ºæ‚¬åœé«˜äº®
    if (target === selectedElement) {
      highlightBox.style.display = "none";
      tagLabel.style.display = "none";
      return;
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);

    // æ›´æ–°æ‚¬åœé«˜äº®æ¡†ä½ç½®
    highlightBox.style.display = "block";
    highlightBox.style.left = "".concat(rect.left - 2, "px");
    highlightBox.style.top = "".concat(rect.top - 2, "px");
    highlightBox.style.width = "".concat(rect.width + 4, "px");
    highlightBox.style.height = "".concat(rect.height + 4, "px");

    // æ›´æ–°æ ‡ç­¾ä½ç½®å’Œå†…å®¹
    tagLabel.style.display = "block";
    tagLabel.textContent = "<".concat(target.tagName.toLowerCase(), ">");

    // è®¡ç®—æ ‡ç­¾ä½ç½®ï¼Œç¡®ä¿ä¸è¶…å‡ºè§†çª—
    var labelTop = rect.top - 22;
    var labelLeft = rect.left;

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºé¡¶éƒ¨ï¼Œæ˜¾ç¤ºåœ¨å…ƒç´ ä¸‹æ–¹
    if (labelTop < 0) {
      labelTop = rect.bottom + 5;
    }

    // å¦‚æœæ ‡ç­¾ä¼šè¶…å‡ºå³ä¾§ï¼Œå‘å·¦è°ƒæ•´
    if (labelLeft + tagLabel.offsetWidth > window.innerWidth) {
      labelLeft = window.innerWidth - tagLabel.offsetWidth - 5;
    }
    tagLabel.style.left = "".concat(Math.max(0, labelLeft), "px");
    tagLabel.style.top = "".concat(labelTop, "px");

    // å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // é¼ æ ‡ç¦»å¼€äº‹ä»¶å¤„ç†
  function handleMouseOut(e) {
    if (!highlightEnabled) return;
    var relatedTarget = e.relatedTarget;

    // å¦‚æœé¼ æ ‡ç§»åŠ¨åˆ°é«˜äº®ç›¸å…³å…ƒç´ ä¸Šï¼Œä¸éšè—é«˜äº®
    if (relatedTarget && (relatedTarget === highlightBox || relatedTarget === tagLabel || relatedTarget === overlay || relatedTarget === selectedBox || relatedTarget === selectedLabel)) {
      return;
    }
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    try {
      window.parent.postMessage({
        type: "iframe-element-hover",
        data: null,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç‚¹å‡»äº‹ä»¶å¤„ç†
  function handleClick(e) {
    var target = e.target;
    if (!target || target === overlay || target === highlightBox || target === tagLabel || target === selectedBox || target === selectedLabel) {
      return;
    }

    // é¿å…å¤„ç† html å’Œ body å…ƒç´ 
    if (target === document.documentElement || target === document.body) {
      return;
    }

    // æ£€æŸ¥æ˜¯å¦æ˜¯äº¤äº’å…ƒç´ ï¼Œè¿™äº›å…ƒç´ éœ€è¦ä¿ç•™é»˜è®¤è¡Œä¸º
    var isInteractiveElement = ['input', 'textarea', 'select', 'button', 'a'].includes(target.tagName.toLowerCase());

    // å¦‚æœé«˜äº®åŠŸèƒ½å¯ç”¨ï¼Œå¯¹äºéäº¤äº’å…ƒç´ é˜»æ­¢é»˜è®¤è¡Œä¸ºå’Œäº‹ä»¶ä¼ æ’­
    if (highlightEnabled) {
      e.preventDefault();
      e.stopPropagation();
    }
    var rect = target.getBoundingClientRect();
    var selector = getElementSelector(target);
    var text = getElementText(target);
    var attributes = getElementAttributes(target);
    console.log("Element clicked:", {
      tagName: target.tagName,
      selector: selector,
      rect: rect
    });

    // ç«‹å³æ›´æ–°é€‰ä¸­é«˜äº®
    updateSelectedHighlight(target);

    // éšè—æ‚¬åœé«˜äº®ï¼Œå› ä¸ºç°åœ¨æ˜¯é€‰ä¸­çŠ¶æ€
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    var elementInfo = {
      tagName: target.tagName.toLowerCase(),
      rect: {
        left: rect.left,
        top: rect.top,
        right: rect.right,
        bottom: rect.bottom,
        width: rect.width,
        height: rect.height,
        x: rect.x,
        y: rect.y
      },
      selector: selector,
      text: text,
      attributes: attributes,
      url: window.location.href,
      path: window.location.pathname,
      timestamp: Date.now()
    };
    try {
      window.parent.postMessage({
        type: "iframe-element-click",
        data: elementInfo,
        source: "iframe-highlight-injector"
      }, "*");
    } catch (error) {
      console.warn("æ— æ³•å‘é€æ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
    }
  }

  // ç›‘å¬æ¥è‡ªçˆ¶çª—å£çš„æ¶ˆæ¯
  function handleParentMessage(event) {
    console.log("Received message from parent:", event.data);
    if (event.data.type === "iframe-highlight-toggle") {
      var enabled = event.data.enabled;
      console.log("Highlight toggle:", enabled);
      if (enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "enable-iframe-highlight") {
      console.log("Enable iframe highlight");
      enableHighlight();
    } else if (event.data.type === "disable-iframe-highlight") {
      console.log("Disable iframe highlight");
      disableHighlight();
    } else if (event.data.type === "toggle-iframe-highlight") {
      var _enabled = event.data.enabled !== undefined ? event.data.enabled : !highlightEnabled;
      console.log("Toggle iframe highlight to:", _enabled);
      if (_enabled) {
        enableHighlight();
      } else {
        disableHighlight();
      }
    } else if (event.data.type === "update-selected-element") {
      var selector = event.data.selector;
      console.log("Update selected element with selector:", selector);
      if (selector) {
        try {
          var element = document.querySelector(selector);
          console.log("Found element by selector:", element);
          updateSelectedHighlight(element);
        } catch (error) {
          console.warn("Failed to select element:", error);
          updateSelectedHighlight(null);
        }
      } else {
        updateSelectedHighlight(null);
      }
    } else if (event.data.type === "clear-selected-element") {
      console.log("Clear selected element");
      updateSelectedHighlight(null);
    }
  }

  // å¯ç”¨é«˜äº®åŠŸèƒ½
  function enableHighlight() {
    console.log("Enabling highlight");
    document.addEventListener("mouseover", handleMouseOver, true);
    document.addEventListener("mouseout", handleMouseOut, true);
    document.addEventListener("click", handleClick, true);
    highlightEnabled = true;
    overlay.style.display = "block";
  }

  // ç¦ç”¨é«˜äº®åŠŸèƒ½
  function disableHighlight() {
    console.log("Disabling highlight");
    highlightEnabled = false;
    // ä¿æŒäº‹ä»¶ç›‘å¬å™¨ï¼Œä½†é€šè¿‡ highlightEnabled å˜é‡æ§åˆ¶è¡Œä¸º
    // è¿™æ ·å¯ä»¥ä¿ç•™é€‰ä¸­çŠ¶æ€çš„æ˜¾ç¤º
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    // ä¸éšè— selectedBox å’Œ selectedLabelï¼Œä¿ç•™é€‰ä¸­çŠ¶æ€
  }

  // å®Œå…¨ç¦ç”¨é«˜äº®åŠŸèƒ½ï¼ˆç§»é™¤æ‰€æœ‰ç›‘å¬å™¨ï¼‰
  function fullyDisableHighlight() {
    console.log("Fully disabling highlight");
    highlightEnabled = false;
    document.removeEventListener("mouseover", handleMouseOver, true);
    document.removeEventListener("mouseout", handleMouseOut, true);
    document.removeEventListener("click", handleClick, true);
    overlay.style.display = "none";
    highlightBox.style.display = "none";
    tagLabel.style.display = "none";
    selectedBox.style.display = "none";
    selectedLabel.style.display = "none";
  }

  // æ·»åŠ äº‹ä»¶ç›‘å¬
  enableHighlight();
  window.addEventListener("message", handleParentMessage);

  // æš´éœ²å…¨å±€å‡½æ•°ä¾›å¤–éƒ¨è°ƒç”¨
  window.__iframeHighlightControl = {
    enable: enableHighlight,
    disable: disableHighlight,
    fullyDisable: fullyDisableHighlight,
    isEnabled: function isEnabled() {
      return highlightEnabled;
    },
    getSelectedElement: function getSelectedElement() {
      return selectedElement;
    },
    updateSelected: updateSelectedHighlight,
    // é€šè¿‡æ¶ˆæ¯å‘é€å¼€å…³æ§åˆ¶
    sendToggleMessage: function sendToggleMessage(enabled) {
      window.parent.postMessage({
        type: 'iframe-highlight-status',
        enabled: enabled || highlightEnabled,
        source: 'iframe-highlight-injector'
      }, '*');
    }
  };

  // é€šçŸ¥çˆ¶çª—å£è„šæœ¬å·²åŠ è½½
  try {
    window.parent.postMessage({
      type: "iframe-highlight-ready",
      data: {
        url: window.location.href,
        userAgent: navigator.userAgent,
        timestamp: Date.now()
      },
      source: "iframe-highlight-injector"
    }, "*");
  } catch (error) {
    console.warn("æ— æ³•å‘é€å°±ç»ªæ¶ˆæ¯åˆ°çˆ¶çª—å£:", error);
  }

  // æ¸…ç†å‡½æ•°
  window.__iframeHighlightCleanup = function () {
    fullyDisableHighlight();
    window.removeEventListener("message", handleParentMessage);
    if (overlay.parentElement) {
      overlay.parentElement.removeChild(overlay);
    }
    delete window.__iframeHighlightInitialized;
    delete window.__iframeHighlightCleanup;
  };
})();

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
// å¤šèªè¨€ç³»çµ±
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const translations = {
    'zh-TW': {
        'page-title': 'ç”Ÿæ­»ä¹‹é–“ | Between Life and Death',
        'opening-fixed-title': 'ã€ä»Šç”Ÿèˆ‡æ°¸æ†ï¼Œç”¦é†’èˆ‡æ˜æ²‰ã€',
        'opening-fixed-sub': 'ç”Ÿæ­»â€§åªåœ¨ä¸€ç·šä¹‹å·®',
        'enter-hint': '[ é» æ“Š é€² å…¥ ]',
        'counter-label-1': 'ä½ é€²å…¥å¾Œï¼Œå…¨çƒå·²æœ‰',
        'counter-unit-1': 'äººæ­»äº¡',
        'counter-label-2': 'ä»Šæ—¥å…¨çƒç´„',
        'counter-unit-2': 'äººé›¢ä¸–',
        'counter-since': 'ï¼ˆæ¯ç§’ç´„ 1.8 äººãƒ»WHO å…¨çƒæ­»äº¡ç‡ä¼°ç®—ï¼‰',
        'portal-title': 'ç”Ÿ æ­» ä¹‹ é–“',
        'portal-subtitle-1': 'æ¯ä¸€å¤©ï¼Œå…¨çƒç´„æœ‰ 15 è¬äººé›¢é–‹é€™å€‹ä¸–ç•Œ',
        'portal-subtitle-2': 'ä»–å€‘ä¹‹ä¸­ï¼Œæœ‰å¤šå°‘äººé å‚™å¥½äº†ï¼Ÿ',
        'portal-subtitle-3': 'ä½ å‘¢ï¼Ÿ',
        'gate-title-1': 'THE TRIBULATION',
        'gate-subtitle-1': 'ä¸ƒ ç½ å¹´ æ™‚ é–“ è»¸',
        'gate-desc-1-1': '2019 ç˜Ÿç–« â†’ 2027 å¹è§’ç¯€',
        'gate-desc-1-2': 'å››é¦¬ã€ä¸ƒå°ã€ä¸ƒè™Ÿ',
        'gate-desc-1-3': 'å®è§€é è¨€èˆ‡ç¾å¯¦çš„å°ç…§',
        'gate-title-2': 'VITAL LIFE MONITOR',
        'gate-subtitle-2': 'ç”Ÿ æ­» è¨˜ éŒ„ å„€',
        'gate-desc-2-1': 'æ¯ä¸€æ¢æ–°èï¼Œéƒ½æ˜¯ä¸€å€‹å®Œæ•´äººç”Ÿçš„çµ‚çµ',
        'gate-desc-2-2': 'ä»Šå¤©çš„é ­æ¢ï¼Œæ˜å¤©å¯èƒ½æ˜¯ä½ ',
        'gate-desc-2-3': 'å€‹é«”æ­»äº¡äº‹ä»¶è¿½è¹¤',
        'gate-title-3': 'IF IT WERE YOU',
        'gate-subtitle-3': 'å¦‚ æœ æ˜¯ ä½ ',
        'gate-desc-3-1': 'çµ¦è‡ªå·± 3 åˆ†é˜',
        'gate-desc-3-2': 'èªçœŸæ€è€ƒä¸€å€‹ä½ ä¸€ç›´é€ƒé¿çš„å•é¡Œ',
        'gate-desc-3-3': 'éˆé­‚çš„å»è™•',
        'footer-quote-1': 'ã€Œäººè‹¥è³ºå¾—å…¨ä¸–ç•Œï¼Œè³ ä¸Šè‡ªå·±çš„ç”Ÿå‘½ï¼Œæœ‰ç”šéº¼ç›Šè™•å‘¢ï¼Ÿ',
        'footer-quote-2': 'äººé‚„èƒ½æ‹¿ç”šéº¼æ›ç”Ÿå‘½å‘¢ï¼Ÿã€',
        'footer-ref': 'â€” é¦¬å¤ªç¦éŸ³ 16:26'
    },
    'zh-CN': {
        'page-title': 'ç”Ÿæ­»ä¹‹é—´ | Between Life and Death',
        'opening-fixed-title': 'ã€ä»Šç”Ÿä¸æ°¸æ’ï¼Œè‹é†’ä¸æ˜æ²‰ã€',
        'opening-fixed-sub': 'ç”Ÿæ­»â€§åªåœ¨ä¸€çº¿ä¹‹å·®',
        'enter-hint': '[ ç‚¹ å‡» è¿› å…¥ ]',
        'counter-label-1': 'ä½ è¿›å…¥åï¼Œå…¨çƒå·²æœ‰',
        'counter-unit-1': 'äººæ­»äº¡',
        'counter-label-2': 'ä»Šæ—¥å…¨çƒçº¦',
        'counter-unit-2': 'äººç¦»ä¸–',
        'counter-since': 'ï¼ˆæ¯ç§’çº¦ 1.8 äººãƒ»WHO å…¨çƒæ­»äº¡ç‡ä¼°ç®—ï¼‰',
        'portal-title': 'ç”Ÿ æ­» ä¹‹ é—´',
        'portal-subtitle-1': 'æ¯ä¸€å¤©ï¼Œå…¨çƒçº¦æœ‰ 15 ä¸‡äººç¦»å¼€è¿™ä¸ªä¸–ç•Œ',
        'portal-subtitle-2': 'ä»–ä»¬ä¹‹ä¸­ï¼Œæœ‰å¤šå°‘äººé¢„å¤‡å¥½äº†ï¼Ÿ',
        'portal-subtitle-3': 'ä½ å‘¢ï¼Ÿ',
        'gate-title-1': 'THE TRIBULATION',
        'gate-subtitle-1': 'ä¸ƒ ç¾ å¹´ æ—¶ é—´ è½´',
        'gate-desc-1-1': '2019 ç˜Ÿç–« â†’ 2027 å¹è§’èŠ‚',
        'gate-desc-1-2': 'å››é©¬ã€ä¸ƒå°ã€ä¸ƒå·',
        'gate-desc-1-3': 'å®è§‚é¢„è¨€ä¸ç°å®çš„å¯¹ç…§',
        'gate-title-2': 'VITAL LIFE MONITOR',
        'gate-subtitle-2': 'ç”Ÿ æ­» è®° å½• ä»ª',
        'gate-desc-2-1': 'æ¯ä¸€æ¡æ–°é—»ï¼Œéƒ½æ˜¯ä¸€ä¸ªå®Œæ•´äººç”Ÿçš„ç»ˆç»“',
        'gate-desc-2-2': 'ä»Šå¤©çš„å¤´æ¡ï¼Œæ˜å¤©å¯èƒ½æ˜¯ä½ ',
        'gate-desc-2-3': 'ä¸ªä½“æ­»äº¡äº‹ä»¶è¿½è¸ª',
        'gate-title-3': 'IF IT WERE YOU',
        'gate-subtitle-3': 'å¦‚ æœ æ˜¯ ä½ ',
        'gate-desc-3-1': 'ç»™è‡ªå·± 3 åˆ†é’Ÿ',
        'gate-desc-3-2': 'è®¤çœŸæ€è€ƒä¸€ä¸ªä½ ä¸€ç›´é€ƒé¿çš„é—®é¢˜',
        'gate-desc-3-3': 'çµé­‚çš„å»å¤„',
        'footer-quote-1': 'ã€Œäººè‹¥èµšå¾—å…¨ä¸–ç•Œï¼Œèµ”ä¸Šè‡ªå·±çš„ç”Ÿå‘½ï¼Œæœ‰ä»€ä¹ˆç›Šå¤„å‘¢ï¼Ÿ',
        'footer-quote-2': 'äººè¿˜èƒ½æ‹¿ä»€ä¹ˆæ¢ç”Ÿå‘½å‘¢ï¼Ÿã€',
        'footer-ref': 'â€” é©¬å¤ªç¦éŸ³ 16:26'
    },
    'en': {
        'page-title': 'Between Life and Death',
        'opening-fixed-title': 'ã€ This Life & Eternity, Awake & Asleep ã€',
        'opening-fixed-sub': 'Life & Deathãƒ»Only a Thin Line Apart',
        'enter-hint': '[ C L I C K   T O   E N T E R ]',
        'counter-label-1': 'Since you entered,',
        'counter-unit-1': 'people died globally',
        'counter-label-2': 'Today, approximately',
        'counter-unit-2': 'people passed away',
        'counter-since': '(~1.8 per secondãƒ»WHO Global Mortality Est.)',
        'portal-title': 'BETWEEN LIFE & DEATH',
        'portal-subtitle-1': 'Every day, about 150,000 people leave this world',
        'portal-subtitle-2': 'How many of them were prepared?',
        'portal-subtitle-3': 'Are you?',
        'gate-title-1': 'THE TRIBULATION',
        'gate-subtitle-1': 'Seven-Year Timeline',
        'gate-desc-1-1': '2019 Plague â†’ 2027 Feast of Trumpets',
        'gate-desc-1-2': 'Four Horses, Seven Seals, Seven Trumpets',
        'gate-desc-1-3': 'Prophecy vs. Reality',
        'gate-title-2': 'VITAL LIFE MONITOR',
        'gate-subtitle-2': 'Life & Death Monitor',
        'gate-desc-2-1': 'Every news story marks the end of a life',
        'gate-desc-2-2': "Today's headline could be you tomorrow",
        'gate-desc-2-3': 'Individual Death Event Tracking',
        'gate-title-3': 'IF IT WERE YOU',
        'gate-subtitle-3': 'If It Were You',
        'gate-desc-3-1': 'Give yourself 3 minutes',
        'gate-desc-3-2': 'To seriously think about a question you\'ve been avoiding',
        'gate-desc-3-3': 'Where does your soul go?',
        'footer-quote-1': '"For what will it profit a man if he gains the whole world and forfeits his soul?',
        'footer-quote-2': 'Or what shall a man give in return for his soul?"',
        'footer-ref': 'â€” Matthew 16:26'
    }
};

function switchLanguage(lang) {
    document.querySelectorAll('.lang-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-lang') === lang) {
            btn.classList.add('active');
        }
    });
    localStorage.setItem('preferred-language', lang);
    document.title = translations[lang]['page-title'];
    document.documentElement.lang = lang === 'zh-TW' ? 'zh-HK' : lang === 'zh-CN' ? 'zh-CN' : 'en';
    document.querySelectorAll('[data-i18n]').forEach(el => {
        const key = el.getAttribute('data-i18n');
        if (translations[lang] && translations[lang][key]) {
            el.innerHTML = translations[lang][key];
        }
    });
}

window.addEventListener('DOMContentLoaded', () => {
    const savedLang = localStorage.getItem('preferred-language') || 'zh-TW';
    switchLanguage(savedLang);
});

</script>
</body>
</html>
